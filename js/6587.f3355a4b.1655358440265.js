"use strict";(self["webpackChunkpolkaswap_exchange_web"]=self["webpackChunkpolkaswap_exchange_web"]||[]).push([[6587],{6587:function(e,t,s){s.r(t),s.d(t,{default:function(){return m}});var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("router-view",e._g(e._b({},"router-view",Object.assign({},{parentLoading:e.loading},e.$attrs),!1),e.$listeners))},r=[],i=s(34563),o=s(70655),c=s(53545),n=s(8638),h=s(10909),u=s(63471),d=s(28335),l=s(74614),v=s(25108);let g=class extends((0,c.Wr)(n.tA.LoadingMixin,h.Z)){constructor(...e){super(...e),(0,i.Z)(this,"getEvmBalance",void 0),(0,i.Z)(this,"getEvmNetworkFee",void 0),(0,i.Z)(this,"updateEvmBlockNumber",void 0),(0,i.Z)(this,"getRegisteredAssets",void 0),(0,i.Z)(this,"updateRegisteredAssets",void 0),(0,i.Z)(this,"unwatchEthereum",void 0),(0,i.Z)(this,"blockHeadersSubscriber",void 0)}async created(){await this.withLoading((async()=>{await this.syncExternalAccountWithAppState(),await this.withParentLoading((async()=>{this.setEvmNetwork(d.Zc.externalNetwork),await this.onEvmNetworkTypeChange(),this.unwatchEthereum=await u.ZP.watchEthereum({onAccountChange:e=>{e.length?(this.switchExternalAccount(e[0]),this.updateExternalBalances()):this.disconnectExternalAccount()},onNetworkChange:e=>{this.onEvmNetworkTypeChange(e)},onDisconnect:()=>{this.disconnectExternalAccount()}}),this.subscribeToEvmBlockHeaders()}))}))}beforeDestroy(){"function"===typeof this.unwatchEthereum&&this.unwatchEthereum(),this.unsubscribeEvmBlockHeaders()}updateExternalBalances(){this.getEvmBalance(),this.updateRegisteredAssets()}async onEvmNetworkTypeChange(e){await Promise.all([this.setEvmNetworkType(e),this.getRegisteredAssets(),this.getEvmNetworkFee(),this.getEvmBalance()])}async subscribeToEvmBlockHeaders(){try{await this.unsubscribeEvmBlockHeaders();const e=await u.ZP.getEthersInstance();await this.updateEvmBlockNumber(),this.blockHeadersSubscriber=e.on("block",(e=>{this.updateEvmBlockNumber(e),this.updateExternalBalances(),this.getEvmNetworkFee()}))}catch(e){v.error(e)}}unsubscribeEvmBlockHeaders(){return new Promise(((e,t)=>{if(!this.blockHeadersSubscriber)return e();try{this.blockHeadersSubscriber.off("block"),e()}catch(s){t(s)}}))}};(0,o.__decorate)([l.aD.web3.getEvmBalance],g.prototype,"getEvmBalance",void 0),(0,o.__decorate)([l.aD.bridge.getEvmNetworkFee],g.prototype,"getEvmNetworkFee",void 0),(0,o.__decorate)([l.aD.bridge.updateEvmBlockNumber],g.prototype,"updateEvmBlockNumber",void 0),(0,o.__decorate)([l.aD.assets.getRegisteredAssets],g.prototype,"getRegisteredAssets",void 0),(0,o.__decorate)([l.aD.assets.updateRegisteredAssets],g.prototype,"updateRegisteredAssets",void 0),g=(0,o.__decorate)([c.wA],g);var w=g,b=w,p=s(1001),E=(0,p.Z)(b,a,r,!1,null,null,null),m=E.exports}}]);