"use strict";(self["webpackChunkpolkaswap_exchange_web"]=self["webpackChunkpolkaswap_exchange_web"]||[]).push([[7771],{47771:function(e,t,s){s.r(t),s.d(t,{default:function(){return x}});var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.parentLoading,expression:"parentLoading"}],staticClass:"rewards"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.parentLoading&&e.loading,expression:"!parentLoading && loading"}],staticClass:"rewards-content"},[s("gradient-box",{staticClass:"rewards-block",attrs:{symbol:e.gradientSymbol}},[s("div",{class:["rewards-box",e.libraryTheme]},[s("tokens-row",{attrs:{symbols:e.rewardTokenSymbols}}),e.claimingInProgressOrFinished?s("div",{staticClass:"rewards-claiming-text"},[e._v(" "+e._s(e.claimingStatusMessage)+" ")]):e._e(),e.isSoraAccountConnected?s("div",{staticClass:"rewards-amount"},[s("rewards-amount-header",{attrs:{items:e.rewardsByAssetsList}}),e.claimingInProgressOrFinished?e._e():[e.internalRewards?s("rewards-amount-table",{staticClass:"rewards-table",attrs:{item:e.internalRewards,theme:e.libraryTheme,disabled:!e.internalRewardsAvailable,"is-codec-string":""},model:{value:e.selectedInternalRewardsModel,callback:function(t){e.selectedInternalRewardsModel=t},expression:"selectedInternalRewardsModel"}}):e._e(),s("rewards-amount-table",{staticClass:"rewards-table",attrs:{item:e.vestedRewadsGroupItem,theme:e.libraryTheme,disabled:!e.vestedRewardsAvailable,"is-codec-string":""},model:{value:e.selectedVestedRewardsModel,callback:function(t){e.selectedVestedRewardsModel=t},expression:"selectedVestedRewardsModel"}}),s("rewards-amount-table",{staticClass:"rewards-table",attrs:{item:e.crowdloanRewardsGroupItem,theme:e.libraryTheme,"complex-group":"","is-codec-string":""},model:{value:e.selectedCrowdloanRewardsModel,callback:function(t){e.selectedCrowdloanRewardsModel=t},expression:"selectedCrowdloanRewardsModel"}}),s("rewards-amount-table",{staticClass:"rewards-table",attrs:{item:e.externalRewardsGroupItem,"show-table":!!e.externalRewards.length,theme:e.libraryTheme,"simple-group":""},model:{value:e.selectedExternalRewardsModel,callback:function(t){e.selectedExternalRewardsModel=t},expression:"selectedExternalRewardsModel"}},[s("div",{staticClass:"rewards-footer"},[s("s-divider"),e.isExternalAccountConnected?s("div",{staticClass:"rewards-account"},[s("span",[e._v(e._s(e.formatAddress(e.evmAddress,8)))]),s("span",[e._v(e._s(e.t("rewards.connected")))])]):s("s-button",{staticClass:"rewards-connect-button",attrs:{type:"tertiary"},on:{click:e.connectExternalAccountProcess}},[e._v(" "+e._s(e.t("rewards.action.connectExternalWallet"))+" ")]),e.externalRewardsHintText?s("div",{staticClass:"rewards-footer-hint"},[e._v(e._s(e.externalRewardsHintText))]):e._e()],1)]),e.fee&&e.isSoraAccountConnected&&e.rewardsAvailable&&!e.claimingInProgressOrFinished?s("info-line",e._b({class:["rewards-fee",e.libraryTheme],attrs:{"fiat-value":e.getFiatAmountByCodecString(e.fee),"is-formatted":""}},"info-line",e.feeInfo,!1)):e._e()]],2):e._e(),e.claimingInProgressOrFinished?s("div",{staticClass:"rewards-claiming-text--transaction"},[e._v(" "+e._s(e.transactionStatusMessage)+" ")]):e._e()],1)]),!e.claimingInProgressOrFinished&&e.hintText?s("div",{staticClass:"rewards-block rewards-hint"},[e._v(" "+e._s(e.hintText)+" ")]):e._e(),e.rewardsRecieved||e.loading?e._e():s("s-button",{staticClass:"rewards-block rewards-action-button s-typography-button--large",attrs:{type:"primary",loading:e.actionButtonLoading,disabled:e.actionButtonDisabled},on:{click:e.handleAction}},[e._v(" "+e._s(e.actionButtonText)+" ")])],1)])},r=[],i=s(34563),n=s(70655),d=s(53545),o=s(8638),c=s(36930),l=s(82753),w=s(63471),h=s(80710),u=s(16546),v=s(85530),p=s(74614),R=s(10909);let m=class extends((0,d.Wr)(o.tA.FormattedAmountMixin,R.Z,o.tA.TransactionMixin)){constructor(...e){super(...e),(0,i.Z)(this,"feeFetching",void 0),(0,i.Z)(this,"rewardsFetching",void 0),(0,i.Z)(this,"rewardsClaiming",void 0),(0,i.Z)(this,"transactionError",void 0),(0,i.Z)(this,"transactionStep",void 0),(0,i.Z)(this,"fee",void 0),(0,i.Z)(this,"rewardsRecieved",void 0),(0,i.Z)(this,"vestedRewards",void 0),(0,i.Z)(this,"crowdloanRewards",void 0),(0,i.Z)(this,"internalRewards",void 0),(0,i.Z)(this,"externalRewards",void 0),(0,i.Z)(this,"selectedVestedRewards",void 0),(0,i.Z)(this,"selectedInternalRewards",void 0),(0,i.Z)(this,"selectedExternalRewards",void 0),(0,i.Z)(this,"selectedCrowdloanRewards",void 0),(0,i.Z)(this,"xor",void 0),(0,i.Z)(this,"transactionStepsCount",void 0),(0,i.Z)(this,"externalRewardsAvailable",void 0),(0,i.Z)(this,"rewardsAvailable",void 0),(0,i.Z)(this,"internalRewardsAvailable",void 0),(0,i.Z)(this,"vestedRewardsAvailable",void 0),(0,i.Z)(this,"rewardsByAssetsList",void 0),(0,i.Z)(this,"libraryTheme",void 0),(0,i.Z)(this,"nodeIsConnected",void 0),(0,i.Z)(this,"reset",void 0),(0,i.Z)(this,"setSelectedRewards",void 0),(0,i.Z)(this,"getExternalRewards",void 0),(0,i.Z)(this,"claimRewards",void 0),(0,i.Z)(this,"subscribeOnRewards",void 0),(0,i.Z)(this,"unsubscribeFromRewards",void 0),(0,i.Z)(this,"unwatchEthereum",void 0)}async updateSubscriptions(e){e?this.loading||await this.subscribeOnRewards():await this.unsubscribeFromRewards()}destroyed(){this.reset()}async created(){await this.withApi((async()=>{await this.setEvmNetworkType(),await this.syncExternalAccountWithAppState(),await this.checkExternalRewards(),await this.subscribeOnRewards(),this.unwatchEthereum=await w.ZP.watchEthereum({onAccountChange:e=>{e.length?this.changeExternalAccountProcess({address:e[0]}):this.disconnectExternalAccountProcess()},onNetworkChange:e=>{this.setEvmNetworkType(e)},onDisconnect:()=>{this.disconnectExternalAccountProcess()}})}))}beforeDestroy(){this.unsubscribeFromRewards(),"function"===typeof this.unwatchEthereum&&this.unwatchEthereum()}get externalRewardsGroupItem(){return{type:this.t("rewards.groups.external"),limit:(0,o.fG)(this.externalRewards),rewards:this.externalRewards}}get vestedRewadsGroupItem(){const e=this.vestedRewards?.rewards??[],t=l.KnownAssets.get(l.KnownSymbols.PSWAP);return{type:this.t("rewards.groups.strategic"),title:this.t("rewards.claimableAmountDoneVesting"),limit:[{amount:c.FPNumber.fromCodecValue(this.vestedRewards?.limit??0,t.decimals).toCodecString(),asset:t}],total:{amount:c.FPNumber.fromCodecValue(this.vestedRewards?.total??0,t.decimals).toLocaleString(),asset:t},rewards:e}}get crowdloanRewardsGroupItem(){return{type:this.t("rewards.groups.crowdloan"),rewards:this.crowdloanRewards.map((e=>({...e,total:c.FPNumber.fromCodecValue(e.total??0,e.asset.decimals).toLocaleString()})))}}get selectedInternalRewardsModel(){return this.internalRewardsAvailable&&null!==this.selectedInternalRewards}set selectedInternalRewardsModel(e){const t=e?this.internalRewards:null;this.setSelectedRewards({selectedInternal:t})}get selectedExternalRewardsModel(){return 0!==this.selectedExternalRewards.length}set selectedExternalRewardsModel(e){const t=e?this.externalRewards:[];this.setSelectedRewards({selectedExternal:t})}get selectedVestedRewardsModel(){return this.vestedRewardsAvailable&&null!==this.selectedVestedRewards}set selectedVestedRewardsModel(e){const t=e?this.vestedRewards:null;this.setSelectedRewards({selectedVested:t})}get selectedCrowdloanRewardsModel(){return this.selectedCrowdloanRewards.map((e=>e.type))}set selectedCrowdloanRewardsModel(e){const t=this.crowdloanRewards.reduce(((t,s)=>(e.includes(s.type)&&t.push(s),t)),[]);this.setSelectedRewards({selectedCrowdloan:t})}get isInsufficientBalance(){return(0,v.LG)(this.xor,this.fee)}get feeInfo(){return{label:this.t("rewards.networkFee"),labelTooltip:this.t("rewards.networkFeeTooltip"),value:this.formatCodecNumber(this.fee),assetSymbol:l.KnownSymbols.XOR}}get claimingInProgressOrFinished(){return this.rewardsClaiming||this.transactionError||this.rewardsRecieved}get claimingStatusMessage(){return this.rewardsRecieved?this.t("rewards.claiming.success"):this.t("rewards.claiming.pending")}get transactionStatusMessage(){if(this.rewardsRecieved)return this.t("rewards.transactions.success");const e=this.tOrdinal(this.transactionStep),t=this.transactionError?"rewards.transactions.failed":"rewards.transactions.confimation";return this.t(t,{order:e,total:this.transactionStepsCount})}get rewardTokenSymbols(){return this.rewardsByAssetsList.map((e=>e.asset.symbol))}get gradientSymbol(){return 1===this.rewardTokenSymbols.length?this.rewardTokenSymbols[0]:""}get hintText(){if(!this.isSoraAccountConnected)return this.t("rewards.hint.connectAccounts");if(this.rewardsAvailable){const e=this.rewardTokenSymbols.join(` ${this.t("rewards.andText")} `),t=this.tc("transactionText",this.transactionStepsCount),s=this.transactionStepsCount>1?this.transactionStepsCount:"",a=this.transactionStepsCount>1?this.t("rewards.signing.accounts"):this.t("rewards.signing.extension");return this.t("rewards.hint.howToClaimRewards",{symbols:e,transactions:t,count:s,destination:a})}return""}get externalRewardsHintText(){return this.isExternalAccountConnected?this.externalRewardsAvailable?"":this.t("rewards.hint.connectAnotherAccount"):this.t("rewards.hint.connectExternalAccount")}get actionButtonText(){return this.actionButtonLoading?"":this.isSoraAccountConnected?this.transactionError?this.t("rewards.action.retry"):this.isInsufficientBalance?this.t("rewards.action.insufficientBalance",{tokenSymbol:l.KnownSymbols.XOR}):this.rewardsClaiming?this.externalRewardsAvailable&&1===this.transactionStep?this.t("rewards.action.pendingExternal"):this.externalRewardsAvailable&&2!==this.transactionStep?"":this.t("rewards.action.pendingInternal"):this.t("rewards.action.signAndClaim"):this.t("rewards.action.connectWallet")}get actionButtonLoading(){return this.rewardsFetching||this.feeFetching}get actionButtonDisabled(){return this.rewardsClaiming||this.isSoraAccountConnected&&(!this.rewardsAvailable||this.isInsufficientBalance)}async handleAction(){return this.isSoraAccountConnected?this.rewardsAvailable?await this.claimRewardsProcess():void 0:this.connectInternalWallet()}async checkExternalRewards(e=!1){this.isSoraAccountConnected&&await this.getRewardsProcess(e)}async getRewardsProcess(e=!1){await this.getExternalRewards(this.evmAddress),!this.rewardsAvailable&&e&&this.$notify({message:this.t("rewards.notification.empty"),title:""})}async connectExternalAccountProcess(){await this.connectExternalWallet(),await this.checkExternalRewards()}async disconnectExternalAccountProcess(){this.disconnectExternalAccount(),await this.checkExternalRewards()}async changeExternalAccountProcess(e){await this.changeExternalWallet(e),await this.checkExternalRewards()}async claimRewardsProcess(){const e=this.getWalletAddress(),t=this.evmAddress;if(e){if(t){const e=await w.ZP.checkAccountIsConnected(t);if(!e)return}await this.withNotifications((async()=>await this.claimRewards({internalAddress:e,externalAddress:t})))}}};(0,n.__decorate)([p.SB.rewards.feeFetching],m.prototype,"feeFetching",void 0),(0,n.__decorate)([p.SB.rewards.rewardsFetching],m.prototype,"rewardsFetching",void 0),(0,n.__decorate)([p.SB.rewards.rewardsClaiming],m.prototype,"rewardsClaiming",void 0),(0,n.__decorate)([p.SB.rewards.transactionError],m.prototype,"transactionError",void 0),(0,n.__decorate)([p.SB.rewards.transactionStep],m.prototype,"transactionStep",void 0),(0,n.__decorate)([p.SB.rewards.fee],m.prototype,"fee",void 0),(0,n.__decorate)([p.SB.rewards.rewardsRecieved],m.prototype,"rewardsRecieved",void 0),(0,n.__decorate)([p.SB.rewards.vestedRewards],m.prototype,"vestedRewards",void 0),(0,n.__decorate)([p.SB.rewards.crowdloanRewards],m.prototype,"crowdloanRewards",void 0),(0,n.__decorate)([p.SB.rewards.internalRewards],m.prototype,"internalRewards",void 0),(0,n.__decorate)([p.SB.rewards.externalRewards],m.prototype,"externalRewards",void 0),(0,n.__decorate)([p.SB.rewards.selectedVested],m.prototype,"selectedVestedRewards",void 0),(0,n.__decorate)([p.SB.rewards.selectedInternal],m.prototype,"selectedInternalRewards",void 0),(0,n.__decorate)([p.SB.rewards.selectedExternal],m.prototype,"selectedExternalRewards",void 0),(0,n.__decorate)([p.SB.rewards.selectedCrowdloan],m.prototype,"selectedCrowdloanRewards",void 0),(0,n.__decorate)([p.Yn.assets.xor],m.prototype,"xor",void 0),(0,n.__decorate)([p.Yn.rewards.transactionStepsCount],m.prototype,"transactionStepsCount",void 0),(0,n.__decorate)([p.Yn.rewards.externalRewardsAvailable],m.prototype,"externalRewardsAvailable",void 0),(0,n.__decorate)([p.Yn.rewards.rewardsAvailable],m.prototype,"rewardsAvailable",void 0),(0,n.__decorate)([p.Yn.rewards.internalRewardsAvailable],m.prototype,"internalRewardsAvailable",void 0),(0,n.__decorate)([p.Yn.rewards.vestedRewardsAvailable],m.prototype,"vestedRewardsAvailable",void 0),(0,n.__decorate)([p.Yn.rewards.rewardsByAssetsList],m.prototype,"rewardsByAssetsList",void 0),(0,n.__decorate)([p.Yn.libraryTheme],m.prototype,"libraryTheme",void 0),(0,n.__decorate)([p.Yn.settings.nodeIsConnected],m.prototype,"nodeIsConnected",void 0),(0,n.__decorate)([p.QF.rewards.reset],m.prototype,"reset",void 0),(0,n.__decorate)([p.aD.rewards.setSelectedRewards],m.prototype,"setSelectedRewards",void 0),(0,n.__decorate)([p.aD.rewards.getExternalRewards],m.prototype,"getExternalRewards",void 0),(0,n.__decorate)([p.aD.rewards.claimRewards],m.prototype,"claimRewards",void 0),(0,n.__decorate)([p.aD.rewards.subscribeOnRewards],m.prototype,"subscribeOnRewards",void 0),(0,n.__decorate)([p.aD.rewards.unsubscribeFromRewards],m.prototype,"unsubscribeFromRewards",void 0),(0,n.__decorate)([(0,d.RL)("isSoraAccountConnected"),(0,d.RL)("nodeIsConnected")],m.prototype,"updateSubscriptions",null),m=(0,n.__decorate)([(0,d.wA)({components:{GenericPageHeader:(0,h.kF)(u.z8.GenericPageHeader),GradientBox:(0,h.kF)(u.z8.GradientBox),TokensRow:(0,h.kF)(u.z8.TokensRow),RewardsAmountHeader:(0,h.kF)(u.z8.RewardsAmountHeader),RewardsAmountTable:(0,h.kF)(u.z8.RewardsAmountTable),InfoLine:o.wx.InfoLine}})],m);var g=m,b=g,_=s(1001),y=(0,_.Z)(b,a,r,!1,null,"3ac48077",null),x=y.exports}}]);