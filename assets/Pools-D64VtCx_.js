var R=Object.defineProperty;var F=(s,e,t)=>e in s?R(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var g=(s,e,t)=>F(s,typeof e!="symbol"?e+"":e,t);import{ab as C,ac as U,f as q,b as i,m as L,aJ as d,aI as T,hw as N,g as z,C as B,l as b,j as f,_ as h,n as E}from"./index-BHqySXo4.js";import{E as $}from"./ExplorePageMixin-CkKfV7ro.js";import"./ScrollableTableMixin-C9crfC47.js";const{IndexerType:_}=q,M=C`
  query SubqueryPoolsQuery($after: Cursor, $filter: PoolXYKFilter) {
    data: poolXYKs(after: $after, filter: $filter) {
      pageInfo {
        hasNextPage
        endCursor
      }
      edges {
        node {
          baseAssetId
          targetAssetId
          baseAssetReserves
          targetAssetReserves
          priceUSD
          liquidityUSD
          strategicBonusApy
        }
      }
    }
  }
`,O=C`
  query SubsquidPoolsQuery($after: String, $where: PoolXYKWhereInput) {
    data: poolXyksConnection(orderBy: id_ASC, after: $after, where: $where) {
      pageInfo {
        hasNextPage
        endCursor
      }
      edges {
        node {
          baseAsset {
            id
          }
          targetAsset {
            id
          }
          baseAssetReserves
          targetAssetReserves
          priceUSD
          strategicBonusApy
        }
      }
    }
  }
`,S=s=>{const e=new i.FPNumber(s.strategicBonusApy??0).mul(i.FPNumber.HUNDRED),t=new i.FPNumber(s.priceUSD??0),a="baseAssetId"in s?s.baseAssetId:s.baseAsset.id,r="targetAssetId"in s?s.targetAssetId:s.targetAsset.id;return{baseAssetId:a,targetAssetId:r,baseAssetReserves:s.baseAssetReserves,targetAssetReserves:s.targetAssetReserves,priceUSD:t,apy:e}},Q=s=>{const e={baseAssetReserves:{greaterThan:"0"},targetAssetReserves:{greaterThan:"0"}};return s.length&&(e.targetAssetId={in:s}),e},V=s=>{const e={baseAssetReserves_gt:"0",targetAssetReserves_gt:"0"};return s.length&&(e.targetAsset={id_in:s}),e};async function W(s){const e=(s==null?void 0:s.map(r=>r.address))??[],t=U();let a;switch(t.type){case _.SUBQUERY:{const o={filter:Q(e)};a=await t.services.explorer.fetchAllEntities(M,o,S);break}case _.SUBSQUID:{const o={where:V(e)};a=await t.services.explorer.fetchAllEntitiesConnection(O,o,S);break}}return a??[]}var Y=Object.defineProperty,j=Object.getOwnPropertyDescriptor,k=(s,e,t,a)=>{for(var r=a>1?void 0:a?j(e,t):e,o=s.length-1,n;o>=0;o--)(n=s[o])&&(r=(a?n(e,t,r):n(r))||r);return a&&r&&Y(e,t,r),r};let p=class extends L($){constructor(){super(...arguments);g(this,"accountLiquidity");g(this,"poolsData",[])}get items(){return[...this.poolsData.reduce((a,r)=>{const{baseAssetId:o,targetAssetId:n,priceUSD:m,apy:y}=r,l=this.getAsset(o),c=this.getAsset(n);if(!(l&&c))return a;const P=`${l.symbol}-${c.symbol}`,I=i.FPNumber.fromCodecValue(r.baseAssetReserves??0,l.decimals),v=i.FPNumber.fromCodecValue(r.targetAssetReserves??0,c.decimals),x=v.mul(m).mul(i.FPNumber.TWO),w=[{asset:l,balance:d(I)},{asset:c,balance:d(v)}],u=this.accountLiquidity.find(A=>A.firstAddress===l.address&&A.secondAddress===c.address),D=[{asset:l,balance:d(i.FPNumber.fromCodecValue((u==null?void 0:u.firstBalance)??0))},{asset:c,balance:d(i.FPNumber.fromCodecValue((u==null?void 0:u.secondBalance)??0))}];return a.push({name:P,baseAsset:l,targetAsset:c,priceUSD:m.toNumber(),priceUSDFormatted:m.toLocaleString(),apy:y.toNumber(),apyFormatted:d(y,!0),tvl:x.toNumber(),tvlFormatted:T(x),isAccountItem:!!u,accountTokens:D,poolTokens:w}),a},[])].sort((a,r)=>N({baseAsset:a.baseAsset,poolAsset:a.targetAsset},{baseAsset:r.baseAsset,poolAsset:r.targetAsset}))}get prefilteredItems(){return this.isAccountItemsOnly?this.items.filter(e=>e.isAccountItem):this.items}async updateExploreData(){await this.withLoading(async()=>{await this.withParentLoading(async()=>{this.poolsData=Object.freeze(await W(this.allowedAssets))})})}};k([z.pool.accountLiquidity],p.prototype,"accountLiquidity",2);p=k([B({components:{PairTokenLogo:b(f.PairTokenLogo),SortButton:b(f.SortButton),DataRowSkeleton:b(f.DataRowSkeleton),TokenLogo:h.TokenLogo,FormattedAmount:h.FormattedAmount,HistoryPagination:h.HistoryPagination}})],p);var X=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",[t("s-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingState,expression:"loadingState"}],ref:"table",staticClass:"explore-table",attrs:{data:e.tableItems,"highlight-current-row":!1,size:"small"}},[t("s-table-column",{attrs:{"min-width":"240",label:"#"},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"explore-table-item-index"},[t("span",{directives:[{name:"button",rawName:"v-button"}],class:["explore-table-item-index--head",{active:e.isDefaultSort}],on:{click:e.handleResetSort}},[e._v(" # ")])]),t("div",{staticClass:"explore-table-item-logo"},[t("s-icon",{staticClass:"explore-table-item-logo--head",attrs:{name:"various-bone-24",size:"14px"}})],1),t("div",{staticClass:"explore-table-item-info explore-table-item-info--head"},[t("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.t("nameText")))])])]},proxy:!0},{key:"default",fn:function({$index:a,row:r}){return[t("span",{staticClass:"explore-table-item-index explore-table-item-index--body"},[e._v(e._s(a+e.startIndex+1))]),t("pair-token-logo",{staticClass:"explore-table-item-logo",attrs:{"first-token":r.baseAsset,"second-token":r.targetAsset,size:"small"}}),t("div",{staticClass:"explore-table-item-info explore-table-item-info--body"},[t("div",{staticClass:"explore-table-item-name"},[e._v(e._s(r.baseAsset.symbol)+"-"+e._s(r.targetAsset.symbol))])])]}}])}),t("s-table-column",{attrs:{"min-width":"130","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("sort-button",{attrs:{name:"priceUSD",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[t("span",{staticClass:"explore-table__primary"},[e._v("Price")])])]},proxy:!0},{key:"default",fn:function({row:a}){return[t("formatted-amount",{staticClass:"explore-table-item-price",attrs:{"is-fiat-value":"","fiat-default-rounding":"","font-weight-rate":e.FontWeightRate.MEDIUM,value:a.priceUSDFormatted}})]}}])}),t("s-table-column",{attrs:{"min-width":"120","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("sort-button",{attrs:{name:"apy",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[t("span",{staticClass:"explore-table__primary"},[e._v("APY")])])]},proxy:!0},{key:"default",fn:function({row:a}){return[t("span",{staticClass:"explore-table__accent"},[e._v(e._s(a.apyFormatted))])]}}])}),e.isLoggedIn?t("s-table-column",{key:"logged",attrs:{"min-width":"140","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.t("balanceText")))])]},proxy:!0},{key:"default",fn:function({row:a}){return[t("div",{staticClass:"explore-table-item-tokens"},e._l(a.accountTokens,function({asset:r,balance:o},n){return t("div",{key:n,staticClass:"explore-table-cell"},[t("formatted-amount",{staticClass:"explore-table-item-token",attrs:{"value-can-be-hidden":"","font-size-rate":e.FontSizeRate.SMALL,value:o}}),t("token-logo",{staticClass:"explore-table-item-logo explore-table-item-logo--plain",attrs:{size:"small",token:r}})],1)}),0)]}}],null,!1,2195178740)}):e._e(),t("s-table-column",{attrs:{"min-width":"200","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("span",{staticClass:"explore-table__primary"},[e._v("Pool Tokens")])]},proxy:!0},{key:"default",fn:function({row:a}){return[t("div",{staticClass:"explore-table-item-tokens"},e._l(a.poolTokens,function({asset:r,balance:o},n){return t("div",{key:n,staticClass:"explore-table-cell"},[t("formatted-amount",{staticClass:"explore-table-item-token",attrs:{"font-size-rate":e.FontSizeRate.SMALL,value:o}}),t("token-logo",{staticClass:"explore-table-item-logo explore-table-item-logo--plain",attrs:{size:"small",token:r}})],1)}),0)]}}])}),t("s-table-column",{key:"tvl",attrs:{"min-width":"104","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("sort-button",{attrs:{name:"tvl",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[t("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.TranslationConsts.TVL))]),t("s-tooltip",{attrs:{"border-radius":"mini",content:e.t("tooltips.tvl")}},[t("s-icon",{attrs:{name:"info-16",size:"14px"}})],1)],1)]},proxy:!0},{key:"default",fn:function({row:a}){return[t("data-row-skeleton",{attrs:{loading:!e.pricesAvailable,rect:""}},[t("formatted-amount",{staticClass:"explore-table-item-price explore-table-item-amount",attrs:{"is-fiat-value":"","font-weight-rate":e.FontWeightRate.MEDIUM,value:a.tvlFormatted.amount}},[e._v(" "+e._s(a.tvlFormatted.suffix)+" ")])],1)]}}])})],1),t("history-pagination",{staticClass:"explore-table-pagination",attrs:{"current-page":e.currentPage,"page-amount":e.pageAmount,total:e.total,"last-page":e.lastPage,loading:e.loadingState},on:{"pagination-click":e.handlePaginationClick}})],1)},H=[],K=E(p,X,H,!1,null,null);const te=K.exports;export{te as default};
