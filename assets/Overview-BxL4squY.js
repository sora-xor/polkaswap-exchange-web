var _=Object.defineProperty;var D=(e,t,a)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var n=(e,t,a)=>D(e,typeof t!="symbol"?t+"":t,a);import{ab as f,ac as S,f as y,m as F,a5 as I,$ as W,hY as h,a4 as x,hI as N,i as A,g as M,W as R,C as L,_ as c,hJ as r,hK as l,n as z}from"./index-BHqySXo4.js";import{S as P}from"./StakingMixin-CnPsAVWR.js";const{IndexerType:b}=y,E=f`
  query NominatorsCountQuery {
    data: stakingStakers(orderBy: ID_DESC) {
      totalCount
    }
  }
`,T=f`
  query NominatorsCountQuery {
    data: stakingStakersConnection(orderBy: id_DESC) {
      totalCount
    }
  }
`;async function B(){var a,s;const e=S();let t;switch(e.type){case b.SUBQUERY:{t=(a=await e.services.explorer.fetchEntities(E))==null?void 0:a.totalCount;break}case b.SUBSQUID:{t=(s=await e.services.explorer.fetchEntitiesConnection(T))==null?void 0:s.totalCount;break}}return t}var V=Object.defineProperty,q=Object.getOwnPropertyDescriptor,g=(e,t,a,s)=>{for(var o=s>1?void 0:s?q(t,a):t,d=e.length-1,w;d>=0;d--)(w=e[d])&&(o=(s?w(t,a,o):w(o))||o);return s&&o&&V(t,a,o),o};let u=class extends F(I,P,W.LoadingMixin){constructor(){super(...arguments);n(this,"setTotalNominators");n(this,"totalNominators");n(this,"stakeDialogMode",h.ADD);n(this,"showStakeDialog",!1);n(this,"showClaimRewardsDialog",!1);n(this,"showPendingRewardsDialog",!1);n(this,"showValidatorsDialog",!1);n(this,"showControllerDialog",!1);n(this,"showWithdrawDialog",!1);n(this,"showAllWithdrawsDialog",!1)}get lockedFundsFormatted(){return this.lockedFunds.toLocaleString()}get unlockingFundsFormatted(){return this.unlockingFunds.toLocaleString()}get rewardedFundsFormatted(){return this.rewardedFunds.toLocaleString()}get showWithdrawCard(){var a;return!!((a=this.accountLedger)!=null&&a.unlocking.length)}get showNextWithdrawal(){return!!this.nextWithdrawalEra}getDropdownMenuItems(){return[{value:"pending-rewards",text:this.t("soraStaking.pendingRewardsDialog.title")},{value:"validators",text:this.t("soraStaking.info.validators")}]}get dropdownMenuItems(){return this.getDropdownMenuItems()}get stakeMoreText(){return this.lockedFunds.isZero()?this.t("soraStaking.newStake.title"):this.t("soraStaking.actions.more")}get withdrawButtonDisabled(){return this.withdrawableFunds.isZero()}handleClickDropdownMenu(){const a=this.$refs["dropdown-menu"];if(!a)return;const s=a.dropdown;s.visible?s.hide():s.show()}handleSelectDropdownMenuItem(a){switch(a){case"pending-rewards":this.showPendingRewardsDialog=!0;break;case"validators":this.showValidatorsDialog=!0;break;case"controller-account":this.showControllerDialog=!0;break}}stakeNew(){x.push({name:N.ValidatorsType})}stakeMore(){this.stakeDialogMode=h.ADD,this.showStakeDialog=!0}removeStake(){this.stakeDialogMode=h.REMOVE,this.showStakeDialog=!0}claimRewards(){this.showClaimRewardsDialog=!0}showRewards(){this.showClaimRewardsDialog=!1,this.showPendingRewardsDialog=!0}showAllWithdraws(){this.showWithdrawDialog=!1,this.showAllWithdrawsDialog=!0}handleWithdraw(){this.showWithdrawDialog=!0}handleStake(){this.showStakeDialog=!1}handleNominate(){this.showValidatorsDialog=!1}handleChangeController(){this.showControllerDialog=!1}async fetchNominatorsCount(){if(!this.activeEra)return;const a=await B();a!=null&&this.setTotalNominators(a)}created(){this.fetchNominatorsCount()}};g([A.staking.setTotalNominators],u.prototype,"setTotalNominators",2);g([M.staking.totalNominators],u.prototype,"totalNominators",2);g([R("currentEra")],u.prototype,"fetchNominatorsCount",1);u=g([L({components:{TokenLogo:c.TokenLogo,InfoLine:c.InfoLine,BackButton:r(l.BackButton),StakeDialog:r(l.StakeDialog),ClaimRewardsDialog:r(l.ClaimRewardsDialog),PendingRewardsDialog:r(l.PendingRewardsDialog),ValidatorsDialog:r(l.ValidatorsDialog),WithdrawDialog:r(l.WithdrawDialog),AllWithdrawsDialog:r(l.AllWithdrawsDialog),EraCountdown:r(l.EraCountdown),FormattedAmountWithFiatValue:c.FormattedAmountWithFiatValue}})],u);var O=function(){var s,o,d,w,m,k,p,v;var t=this,a=t._self._c;return t._self._setupProxy,a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.parentLoading,expression:"parentLoading"}],staticClass:"container"},[a("div",{staticClass:"header"},[a("back-button",{attrs:{page:t.StakingPageNames.Staking}}),t.stakingInitialized?a("s-button",{staticClass:"dropdown-menu-button",attrs:{type:"action",tooltip:t.t("headerMenu.settings")},on:{click:t.handleClickDropdownMenu}},[a("s-dropdown",{ref:"dropdown-menu",attrs:{"popper-class":"dropdown-menu",icon:"basic-more-vertical-24",type:"ellipsis",placement:"bottom-start"},on:{select:t.handleSelectDropdownMenuItem},scopedSlots:t._u([{key:"menu",fn:function(){return t._l(t.dropdownMenuItems,function({value:i,text:C}){return a("s-dropdown-item",{key:i,staticClass:"dropdown-menu__item",attrs:{"data-test-name":i,value:i}},[t._v(" "+t._s(C)+" ")])})},proxy:!0}],null,!1,3210154554)})],1):t._e()],1),a("div",{staticClass:"staking-logo-container"},[a("div",{staticClass:"staking-logo"},[a("token-logo",{staticClass:"token-logo",attrs:{token:t.stakingAsset,size:"large"}}),a("token-logo",{staticClass:"reward-token-logo",attrs:{token:t.rewardAsset,size:"medium"}})],1)]),a("h1",[t._v(t._s(t.t("soraStaking.overview.title")))]),t.stakingInitialized?t._e():a("p",[t._v(" "+t._s(t.t("soraStaking.overview.description"))+" ")]),t.isLoggedIn?[a("div",{staticClass:"additional-buttons"},[t.stakingInitialized?a("s-button",{staticClass:"additional-button s-typography-button--medium",on:{click:t.claimRewards}},[t._v(" "+t._s(t.t("soraStaking.actions.claim"))+" ")]):t._e(),t.stakingInitialized?a("s-button",{staticClass:"additional-button s-typography-button--medium",attrs:{disabled:t.lockedFunds.isZero()},on:{click:t.removeStake}},[t._v(" "+t._s(t.t("soraStaking.actions.remove"))+" ")]):t._e()],1),t.stakingInitialized?t._e():a("s-button",{staticClass:"action-button s-typography-button--medium",attrs:{type:"primary"},on:{click:t.stakeNew}},[t._v(" "+t._s(t.t("soraStaking.newStake.title"))+" ")]),t.stakingInitialized?a("s-button",{staticClass:"action-button s-typography-button--medium",attrs:{type:"primary"},on:{click:t.stakeMore}},[t._v(" "+t._s(t.stakeMoreText)+" ")]):t._e(),t.showWithdrawCard?a("s-card",{staticClass:"withdraw",attrs:{"border-radius":"medium",shadow:"always",size:"mini"}},[a("div",{staticClass:"withdraw-content"},[a("div",{staticClass:"withdraw-header"},[a("div",{staticClass:"withdraw-info"},[a("span",{staticClass:"withdraw-info-title"},[t._v(" "+t._s(t.t("soraStaking.withdraw.withdrawable"))+" ")]),a("formatted-amount-with-fiat-value",{staticClass:"withdraw-info-amount",attrs:{"asset-symbol":(s=t.stakingAsset)==null?void 0:s.symbol,"symbol-as-decimal":"","value-can-be-hidden":"",value:t.withdrawableFundsFormatted,"fiat-value":t.withdrawableFundsFiat}})],1),a("div",{staticClass:"withdraw-info"},[a("span",{staticClass:"withdraw-info-title"},[t._v(" "+t._s(t.t("soraStaking.info.unstaking"))+" ")]),a("formatted-amount-with-fiat-value",{staticClass:"withdraw-info-amount",attrs:{"asset-symbol":(o=t.stakingAsset)==null?void 0:o.symbol,"symbol-as-decimal":"","value-can-be-hidden":"",value:t.unlockingFundsFormatted,"fiat-value":t.unlockingFundsFiat}})],1),a("s-button",{staticClass:"withdraw-button",attrs:{disable:t.withdrawButtonDisabled,type:"primary",size:"small"},on:{click:t.handleWithdraw}},[t._v(" "+t._s(t.t("soraStaking.actions.withdraw"))+" ")])],1),t.showNextWithdrawal?a("div",{staticClass:"withdraw-footer"},[a("div",[a("span",[t._v(" "+t._s(t.t("soraStaking.withdraw.nextWithdrawal"))+": ")]),a("era-countdown",{staticClass:"countdown",attrs:{"target-era":t.nextWithdrawalEra}})],1),a("div",{directives:[{name:"button",rawName:"v-button"}],staticClass:"withdraw-see-all",on:{click:t.showAllWithdraws}},[t._v(" "+t._s(t.t("soraStaking.withdraw.seeAll"))+" ")])]):t._e()])]):t._e(),a("div",{staticClass:"info"},[t.stakingInitialized?a("info-line",{attrs:{label:t.t("soraStaking.info.stakingBalance"),value:t.lockedFundsFormatted,"asset-symbol":(d=t.stakingAsset)==null?void 0:d.symbol,"fiat-value":t.lockedFundsFiat}}):t._e(),t.stakingInitialized?a("info-line",{attrs:{label:t.t("soraStaking.info.rewarded"),value:t.rewardedFundsFormatted,"asset-symbol":(w=t.rewardAsset)==null?void 0:w.symbol,"fiat-value":t.rewardedFundsFiat}}):t._e(),t.stakingInitialized&&!t.showWithdrawCard?a("info-line",{attrs:{label:t.t("soraStaking.info.unstaking"),value:t.unlockingFundsFormatted,"asset-symbol":(m=t.stakingAsset)==null?void 0:m.symbol,"fiat-value":t.unlockingFundsFiat}}):t._e(),t.stakingInitialized&&!t.showWithdrawCard?a("info-line",{attrs:{label:t.t("soraStaking.withdraw.withdrawable"),value:t.withdrawableFundsFormatted,"asset-symbol":(k=t.stakingAsset)==null?void 0:k.symbol,"fiat-value":t.withdrawableFundsFiat}}):t._e(),t.stakingInitialized?t._e():a("info-line",{attrs:{label:t.t("soraStaking.info.totalLiquidityStaked"),value:t.totalStakedFormatted}}),t.stakingInitialized?t._e():a("info-line",{attrs:{label:t.TranslationConsts.APY,value:t.maxApy+"%"}}),a("info-line",{attrs:{label:t.t("soraStaking.info.rewardToken"),value:(p=t.rewardAsset)==null?void 0:p.symbol}}),t.unbondPeriod?a("info-line",{attrs:{label:t.t("soraStaking.info.unstakingPeriod"),value:t.unbondPeriodFormatted}}):t._e(),t.stakingInitialized?t._e():a("info-line",{attrs:{label:t.t("soraStaking.info.minimumStake"),value:t.minNominatorBondFormatted,"asset-symbol":(v=t.stakingAsset)==null?void 0:v.symbol,"is-formatted":""}}),t.totalNominators!==null?a("info-line",{attrs:{label:t.t("soraStaking.info.nominators"),value:`${t.totalNominators}`}}):t._e(),t.validators.length?a("info-line",{attrs:{label:t.t("soraStaking.info.validators"),value:`${t.validators.length}`}}):t._e()],1)]:a("s-button",{key:"disconnected",staticClass:"action-wallet s-typography-button--large action-button",attrs:{type:"primary"},on:{click:t.connectSoraWallet}},[t._v(" "+t._s(t.t("connectWalletText"))+" ")]),a("stake-dialog",{attrs:{mode:t.stakeDialogMode,visible:t.showStakeDialog,"parent-loading":t.parentLoading||t.loading},on:{"update:visible":function(i){t.showStakeDialog=i},confirm:t.handleStake}}),a("claim-rewards-dialog",{attrs:{visible:t.showClaimRewardsDialog,"parent-loading":t.parentLoading||t.loading},on:{"update:visible":function(i){t.showClaimRewardsDialog=i},"show-rewards":t.showRewards}}),a("withdraw-dialog",{attrs:{visible:t.showWithdrawDialog,"parent-loading":t.parentLoading||t.loading},on:{"update:visible":function(i){t.showWithdrawDialog=i},"show-all-withdraws":t.showAllWithdraws}}),a("all-withdraws-dialog",{attrs:{visible:t.showAllWithdrawsDialog,"parent-loading":t.parentLoading||t.loading},on:{"update:visible":function(i){t.showAllWithdrawsDialog=i}}}),a("pending-rewards-dialog",{attrs:{visible:t.showPendingRewardsDialog,"parent-loading":t.parentLoading||t.loading},on:{"update:visible":function(i){t.showPendingRewardsDialog=i}}}),a("validators-dialog",{attrs:{visible:t.showValidatorsDialog,"parent-loading":t.parentLoading||t.loading},on:{"update:visible":function(i){t.showValidatorsDialog=i},confirm:t.handleNominate}})],2)},Q=[],$=z(u,O,Q,!1,null,"66036091");const J=$.exports;export{J as default};
