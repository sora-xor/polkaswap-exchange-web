var f=Object.defineProperty;var g=(i,e,r)=>e in i?f(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r;var o=(i,e,r)=>g(i,typeof e!="symbol"?e+"":e,r);import{m as B,a5 as _,$ as b,r as k,ae as F,b as O,g as C,h as m,k as y,i as L,W as p,C as x,l as d,j as u,n as T}from"./index-BHqySXo4.js";import{C as w}from"./ConfirmDialogMixin-BYoYOPfg.js";import{F as v,C as h}from"./orderBook-BNMMkkrL.js";var I=Object.defineProperty,S=Object.getOwnPropertyDescriptor,a=(i,e,r,t)=>{for(var n=t>1?void 0:t?S(e,r):e,c=i.length-1,l;c>=0;c--)(l=i[c])&&(n=(t?l(e,r,n):l(n))||n);return t&&n&&I(e,r,n),n};let s=class extends B(w,_,b.LoadingMixin,b.TransactionMixin){constructor(){super(...arguments);o(this,"Filter",v);o(this,"Cancel",h);o(this,"userLimitOrders");o(this,"orderBookId");o(this,"nodeIsConnected");o(this,"subscribeToUserLimitOrders");o(this,"unsubscribeFromUserLimitOrders");o(this,"ordersToBeCancelled");o(this,"setOrdersToBeCancelled");o(this,"currentOrderBook");o(this,"currentFilter",v.open);o(this,"openOrdersLoading",!1)}async updateSubscription(){this.openOrdersLoading=!0,await this.subscribeToUserLimitOrders(),await k(2e3),this.openOrdersLoading=!1}get openOrdersText(){return this.t("orderBook.history.openOrders",{value:this.openOrdersCount})}get cancelText(){return this.hasSelectedForCancellation?this.t("orderBook.history.cancel",{value:`(${this.ordersToBeCancelled.length})`}):this.t("orderBook.history.cancel")}get cancelAllText(){return this.t("orderBook.history.cancelAll")}get hasSelectedForCancellation(){return this.ordersToBeCancelled.length>0}get isBookStopped(){return!this.currentOrderBook||this.currentOrderBook.status===F.OrderBookStatus.Stop}get openOrdersCount(){if(!this.isLoggedIn)return"";const e=this.userLimitOrders.length;return e>0?`(${e})`:""}get isCancelAllInactive(){return this.loading||this.isBookStopped||!this.userLimitOrders.length}get isCancelMultipleInactive(){return this.loading||this.isBookStopped||!this.hasSelectedForCancellation}switchFilter(e){this.currentFilter=e}openConfirmCancelDialog(){this.isBookStopped||this.userLimitOrders.length&&this.confirmOrExecute(this.cancelOrders)}async cancelOrders(e=h.all){if(this.loading||this.isBookStopped||!this.userLimitOrders.length)return;const r=e===h.multiple?this.ordersToBeCancelled:this.userLimitOrders;r.length&&await this.withNotifications(async()=>{const{orderBookId:{base:t,quote:n}}=r[0],c=r.map(l=>l.id);c.length>1?await O.api.orderBook.cancelLimitOrderBatch(t,n,c):await O.api.orderBook.cancelLimitOrder(t,n,c[0]),this.setOrdersToBeCancelled([])})}beforeDestroy(){this.unsubscribeFromUserLimitOrders()}};a([C.orderBook.userLimitOrders],s.prototype,"userLimitOrders",2);a([m.orderBook.orderBookId],s.prototype,"orderBookId",2);a([m.settings.nodeIsConnected],s.prototype,"nodeIsConnected",2);a([y.orderBook.subscribeToUserLimitOrders],s.prototype,"subscribeToUserLimitOrders",2);a([y.orderBook.unsubscribeFromUserLimitOrders],s.prototype,"unsubscribeFromUserLimitOrders",2);a([C.orderBook.ordersToBeCancelled],s.prototype,"ordersToBeCancelled",2);a([L.orderBook.setOrdersToBeCancelled],s.prototype,"setOrdersToBeCancelled",2);a([m.orderBook.currentOrderBook],s.prototype,"currentOrderBook",2);a([p("orderBookId",{immediate:!0}),p("soraAddress"),p("nodeIsConnected")],s.prototype,"updateSubscription",1);s=a([x({components:{BaseWidget:d(u.BaseWidget),AllOrders:d(u.AllOrders),OpenOrders:d(u.OpenOrders),CancelConfirm:d(u.CancelOrders)}})],s);var $=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("base-widget",e._b({staticClass:"order-history-widget s-flex-column",attrs:{extensive:"",delimeter:""},scopedSlots:e._u([{key:"title",fn:function(){return[r("div",{staticClass:"order-history-buttons order-history-buttons--filter-buttons"},[r("span",{directives:[{name:"button",rawName:"v-button"}],class:["order-history-button",{active:e.currentFilter===e.Filter.open}],on:{click:function(t){return e.switchFilter(e.Filter.open)}}},[e._v(" "+e._s(e.openOrdersText)+" ")]),r("span",{directives:[{name:"button",rawName:"v-button"}],class:["order-history-button",{active:e.currentFilter===e.Filter.all}],on:{click:function(t){return e.switchFilter(e.Filter.all)}}},[e._v(" "+e._s(e.t("orderBook.history.orderHistory"))+" ")]),r("span",{directives:[{name:"button",rawName:"v-button"}],class:["order-history-button",{active:e.currentFilter===e.Filter.executed}],on:{click:function(t){return e.switchFilter(e.Filter.executed)}}},[e._v(" "+e._s(e.t("orderBook.history.tradeHistory"))+" ")])]),e.isLoggedIn?r("div",{staticClass:"order-history-buttons order-history-buttons--cancel-buttons"},[r("span",{directives:[{name:"button",rawName:"v-button"}],class:["order-history-button","order-history-button--cancel",{inactive:e.isCancelMultipleInactive}],on:{click:function(t){return e.cancelOrders(e.Cancel.multiple)}}},[e._v(" "+e._s(e.cancelText)+" ")]),r("span",{directives:[{name:"button",rawName:"v-button"}],class:["order-history-button","order-history-button--cancel",{inactive:e.isCancelAllInactive}],on:{click:e.openConfirmCancelDialog}},[e._v(" "+e._s(e.cancelAllText)+" ")])]):e._e()]},proxy:!0}])},"base-widget",e.$attrs,!1),[e.isLoggedIn?r("div",{staticClass:"order-history-main s-flex-column"},[e.currentFilter===e.Filter.open?r("open-orders",{attrs:{"parent-loading":e.openOrdersLoading}}):r("all-orders",{attrs:{filter:e.currentFilter}})],1):r("div",{staticClass:"order-history-connect-account"},[r("div",{staticClass:"order-history-connect-account-button"},[r("h4",{staticClass:"h4"},[e._v(e._s(e.t("orderBook.history.connect")))]),r("s-button",{staticClass:"btn s-typography-button--medium",attrs:{type:"primary"},on:{click:e.connectSoraWallet}},[e._v(" "+e._s(e.t("connectWalletText"))+" ")])],1)]),r("cancel-confirm",{attrs:{visible:e.confirmDialogVisibility},on:{"update:visible":function(t){e.confirmDialogVisibility=t},confirm:e.cancelOrders}})],1)},A=[],D=T(s,$,A,!1,null,"683c6f3b");const P=D.exports;export{P as default};
