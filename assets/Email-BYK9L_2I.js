var c=Object.defineProperty;var f=(t,e,i)=>e in t?c(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var s=(t,e,i)=>f(t,typeof e!="symbol"?e+"":e,i);import{m as p,T as E,$ as _,aF as u,g,h as C,W as v,C as S,n as N}from"./index-BHqySXo4.js";var l={},b=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-*\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/;l.validate=function(t){if(!t||t.length>254)return!1;var e=b.test(t);if(!e)return!1;var i=t.split("@");if(i[0].length>64)return!1;var a=i[1].split(".");return!a.some(function(n){return n.length>63})};var x=Object.defineProperty,D=Object.getOwnPropertyDescriptor,m=(t,e,i,a)=>{for(var n=a>1?void 0:a?D(e,i):e,o=t.length-1,d;o>=0;o--)(d=t[o])&&(n=(a?d(e,i,n):d(n))||n);return a&&n&&x(e,i,n),n};const h=59;let r=class extends p(E,_.LoadingMixin){constructor(){super(...arguments);s(this,"authLogin");s(this,"isEuroBalanceEnough");s(this,"emailCountDown","");s(this,"prefilledEmail","");s(this,"unconfirmedEmail","");s(this,"emailSentFirstTime",!1);s(this,"emailResendCount",h);s(this,"firstName","");s(this,"lastName","");s(this,"email","");s(this,"emailSent",!1)}handleSmsCountChange(e){const i=e.toString().length>1?"":"0";this.emailCountDown=`00:${i}${e}`}handleSendEmail(){if(this.startEmailCountDown(),(this.isPrefilledEmailValid||this.isEmailMismatch)&&this.prefilledEmail!==this.email){this.authLogin.ChangeUnconfirmedEmail({Email:this.email}).catch(e=>{console.error("[SoraCard]: Error while changing email",e)}),this.unconfirmedEmail=this.email,this.emailSent=!0;return}if(!this.emailSentFirstTime&&!this.isPrefilledEmailValid){this.authLogin.UserMinimalRegistration({Email:this.email,FirstName:this.firstName,LastName:this.lastName}).catch(e=>{console.error("[SoraCard]: Error while email setup",e)}),this.unconfirmedEmail=this.email,this.emailSentFirstTime=!0;return}this.authLogin.SendVerificationEmail().catch(e=>{console.error("[SoraCard]: Error while resending email",e)}),this.emailSent=!0}get emailInputDescription(){return this.emailSent?this.t("card.emailInputAfterSendDesc"):this.t("card.emailInputBeforeSendDesc")}get computedClassEmail(){const e=["sora-card__email-input-description"];return this.emailSent&&e.push("sora-card__email-input-description--sent"),e.join(" ")}get buttonText(){return this.emailSent&&this.emailCountDown?this.t("card.resendInBtn",{value:this.emailCountDown}):this.t("card.sendEmailLinkBtn")}get sendBtnDisabled(){return this.emailSent?!0:this.isPrefilledEmailValid?!l.validate(this.email):this.firstName&&this.lastName?!l.validate(this.email):!0}get showNameInputs(){return this.prefilledEmail==="undefined"||!this.prefilledEmail}get isPrefilledEmailValid(){return this.prefilledEmail!=="undefined"||this.prefilledEmail?l.validate(this.prefilledEmail):!1}get isEmailMismatch(){return this.unconfirmedEmail?this.unconfirmedEmail!==this.email:!1}startEmailCountDown(){const e=setInterval(()=>{this.emailResendCount--,this.emailResendCount<0&&(this.emailSent=!1,this.emailResendCount=h,clearInterval(e))},1e3)}mounted(){this.prefilledEmail=localStorage.getItem("PW-Email")||"undefined",this.prefilledEmail!=="undefined"&&(this.email=this.prefilledEmail),this.authLogin&&this.authLogin.on("Verification-Email-Sent-Success",()=>{this.emailSent=!0}).on("Verification-Email-ReSent-Success",()=>{this.emailSent=!0}).on("Email-verified",()=>{this.unconfirmedEmail="",this.isEuroBalanceEnough?this.$emit("confirm",u.Kyc):this.$emit("confirm",u.Payment)})}};m([g.soraCard.authLogin],r.prototype,"authLogin",2);m([C.soraCard.isEuroBalanceEnough],r.prototype,"isEuroBalanceEnough",2);m([v("emailResendCount",{immediate:!0})],r.prototype,"handleSmsCountChange",1);r=m([S],r);var P=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("div",{staticClass:"sora-card"},[i("s-input",{attrs:{maxlength:"320",placeholder:e.t("card.emailPlaceholder"),disabled:e.loading,type:"email"},model:{value:e.email,callback:function(a){e.email=a},expression:"email"}}),i("p",{class:e.computedClassEmail},[e._v(e._s(e.emailInputDescription))]),e.emailSent?[i("s-icon",{attrs:{name:"basic-check-mark-24",size:"16px"}}),e.emailSent?i("p",{staticClass:"sora-card__email-input-description"},[e._v(e._s(e.t("card.emailSpamReminder")))]):e._e()]:e._e(),e.showNameInputs?i("div",[i("s-input",{staticClass:"sora-card__input-name",attrs:{maxlength:"50",placeholder:e.t("card.firstNamePlaceholder"),disabled:e.loading},model:{value:e.firstName,callback:function(a){e.firstName=a},expression:"firstName"}}),i("s-input",{attrs:{maxlength:"50",placeholder:e.t("card.lastNamePlaceholder"),disabled:e.loading},model:{value:e.lastName,callback:function(a){e.lastName=a},expression:"lastName"}}),i("p",{staticClass:"sora-card__name-input-description"},[e._v(e._s(e.t("card.personalNameInputDesc")))])],1):e._e(),i("s-button",{staticClass:"sora-card__btn s-typography-button--large",attrs:{type:"primary",disabled:e.sendBtnDisabled},on:{click:e.handleSendEmail}},[i("span",{staticClass:"text"},[e._v(" "+e._s(e.buttonText)+" ")])])],2)},w=[],I=N(r,P,w,!1,null,"8dace142");const R=I.exports;export{R as default};
