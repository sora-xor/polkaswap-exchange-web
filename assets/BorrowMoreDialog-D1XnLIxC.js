var y=Object.defineProperty;var F=(i,e,t)=>e in i?y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>F(i,typeof e!="symbol"?e+"":e,t);import{m as T,$ as c,X as B,Z as b,b as p,Y as _,hD as u,i1 as k,P as l,O as m,g as w,h as C,W as P,C as S,_ as g,l as d,j as f,i2 as L,i3 as O,R as V,n as N}from"./index-BHqySXo4.js";import{g as x}from"./util-CUc0-gKA.js";var M=Object.defineProperty,D=Object.getOwnPropertyDescriptor,s=(i,e,t,r)=>{for(var n=r>1?void 0:r?D(e,t):e,h=i.length-1,v;h>=0;h--)(v=i[h])&&(n=(r?v(e,t,n):v(n))||n);return r&&n&&M(e,t,n),n};let a=class extends T(c.TransactionMixin,c.DialogMixin,c.FormattedAmountMixin){constructor(){super(...arguments);o(this,"xorSymbol",B.symbol);o(this,"getLtvStatus",x);o(this,"debtInput");o(this,"vault");o(this,"debtAsset");o(this,"collateral");o(this,"prevLtv");o(this,"available");o(this,"maxSafeDebt");o(this,"maxLtv");o(this,"borrowTax");o(this,"percentFormat");o(this,"networkFees");o(this,"slippageTolerance");o(this,"accountXor");o(this,"borrowValue","")}async handleDialogVisibility(t){var r;await this.$nextTick(),this.borrowValue="",(r=this.debtInput)==null||r.focus()}get xorBalance(){var t,r;return this.getFPNumberFromCodec(((r=(t=this.accountXor)==null?void 0:t.balance)==null?void 0:r.transferable)??b)}get title(){return this.t("kensetsu.borrowMore")}get networkFee(){return this.networkFees[p.Operation.CreateVault]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isBorrowZero(){return _(this.borrowValue)}get borrowFp(){var t;return this.isBorrowZero?this.Zero:this.getFPNumber(this.borrowValue,(t=this.debtAsset)==null?void 0:t.decimals)}get debtAvailable(){var t;return((t=this.collateral)==null?void 0:t.riskParams.hardCap.sub(this.collateral.debtSupply))??this.Zero}get availableOrTotal(){return this.available.gt(this.debtAvailable)?this.debtAvailable:this.available}get isBorrowMoreThanAvailable(){return this.borrowFp.gt(this.availableOrTotal)}get disabled(){return this.loading||this.isInsufficientXorForFee||this.isBorrowZero||this.isBorrowMoreThanAvailable}get availableCodec(){return this.availableOrTotal.dp(p.FPNumber.DEFAULT_PRECISION).codec}get isMaxBorrowAvailable(){return this.shouldBalanceBeHidden||this.isBorrowZero?!0:!this.availableOrTotal.isFinity()||this.availableOrTotal.isLteZero()?!1:!this.borrowFp.isEqualTo(this.availableOrTotal)}get debtSymbol(){var t;return((t=this.debtAsset)==null?void 0:t.symbol)??""}get formattedPrevBorrow(){var t;return((t=this.vault)==null?void 0:t.debt.toLocaleString())??b}get nextBorrow(){var r;const t=(r=this.vault)==null?void 0:r.debt;return this.isBorrowZero?t:t==null?void 0:t.add(this.borrowValue)}get formattedNextBorrow(){var t;return((t=this.nextBorrow)==null?void 0:t.toLocaleString())??b}get formattedPrevLtv(){var t;return((t=this.prevLtv)==null?void 0:t.toLocaleString(2))??b}get ltvCoeff(){return this.nextBorrow?this.nextBorrow.div(this.maxSafeDebt):null}get ltv(){var t;return(t=this.ltvCoeff)!=null&&t.isFinity()?this.ltvCoeff.mul(u):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):b}get ltvText(){return k[x(this.ltvNumber)]}get borrowTaxPercent(){var t,r;return((r=(t=this.percentFormat)==null?void 0:t.format)==null?void 0:r.call(t,this.borrowTax))??`${this.borrowTax*u}%`}get formattedBorrowTax(){var t;return((t=this.borrowFp)==null?void 0:t.mul(this.borrowTax??0).toLocaleString())??b}get borrowValuePercent(){if(!this.borrowValue)return 0;const t=this.borrowFp.div(this.availableOrTotal).mul(u).toNumber(0);return t>u?u:t}handleMaxBorrowValue(){this.borrowValue=this.availableOrTotal.toString()}handleBorrowPercentChange(t){this.borrowValue=this.availableOrTotal.mul(t/u).toString()}get errorMessage(){let t="";return this.isInsufficientXorForFee?t=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isBorrowZero?t=this.t("kensetsu.error.enterBorrow"):this.isBorrowMoreThanAvailable&&(t=this.t("kensetsu.error.borrowMoreThanAvailable")),t}async handleBorrowMore(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{await this.withNotifications(async()=>{if(!(this.vault&&this.debtAsset))throw new Error("[api.kensetsu.borrow]: vault is null");await p.api.kensetsu.borrow(this.vault,this.borrowValue,this.debtAsset,this.slippageTolerance)}),this.$emit("confirm")}catch(t){console.error(t)}this.isVisible=!1}};s([V("debtInput")],a.prototype,"debtInput",2);s([l({type:Object,default:m})],a.prototype,"vault",2);s([l({type:Object,default:m})],a.prototype,"debtAsset",2);s([l({type:Object,default:m})],a.prototype,"collateral",2);s([l({type:Object,default:()=>p.FPNumber.ZERO})],a.prototype,"prevLtv",2);s([l({type:Object,default:()=>p.FPNumber.ZERO})],a.prototype,"available",2);s([l({type:Object,default:()=>p.FPNumber.ZERO})],a.prototype,"maxSafeDebt",2);s([l({type:Number,default:u})],a.prototype,"maxLtv",2);s([l({type:Number,default:0})],a.prototype,"borrowTax",2);s([w.settings.percentFormat],a.prototype,"percentFormat",2);s([w.wallet.settings.networkFees],a.prototype,"networkFees",2);s([w.settings.slippageTolerance],a.prototype,"slippageTolerance",2);s([C.assets.xor],a.prototype,"accountXor",2);s([P("visible")],a.prototype,"handleDialogVisibility",1);a=s([S({components:{DialogBase:g.DialogBase,InfoLine:g.InfoLine,TokenInput:d(f.TokenInput),ValueStatus:d(f.ValueStatusWrapper),PrevNextInfoLine:L(O.PrevNextInfoLine),SlippageTolerance:d(f.SlippageTolerance)}})],a);var A=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("dialog-base",{attrs:{title:e.title,visible:e.isVisible,tooltip:e.t("kensetsu.borrowMoreDescription")},on:{"update:visible":function(r){e.isVisible=r}}},[t("div",{staticClass:"borrow-more"},[t("token-input",{ref:"debtInput",staticClass:"borrow-more__debt-input borrow-more__token-input",attrs:{"with-slider":"","is-fiat-editable":"",title:e.title,"balance-text":e.t("kensetsu.available"),"is-max-available":e.isMaxBorrowAvailable,token:e.debtAsset,balance:e.availableCodec,"slider-value":e.borrowValuePercent,disabled:e.loading},on:{max:e.handleMaxBorrowValue,slide:e.handleBorrowPercentChange},model:{value:e.borrowValue,callback:function(r){e.borrowValue=r},expression:"borrowValue"}}),t("slippage-tolerance",{staticClass:"slippage-tolerance-settings borrow-more__slippage"}),t("prev-next-info-line",{attrs:{label:e.t("kensetsu.outstandingDebt"),tooltip:e.t("kensetsu.outstandingDebtDescription"),symbol:e.debtSymbol,prev:e.formattedPrevBorrow,next:e.formattedNextBorrow}}),t("prev-next-info-line",{attrs:{symbol:"%",label:e.t("kensetsu.ltv"),tooltip:e.t("kensetsu.ltvDescription"),prev:e.formattedPrevLtv,next:e.formattedLtv}},[e.ltv?t("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:e.ltvNumber,"get-status":e.getLtvStatus}},[e._v(" "+e._s(e.ltvText)+" ")]):e._e()],1),t("s-button",{staticClass:"s-typography-button--large action-button borrow-more__button",attrs:{type:"primary",disabled:e.disabled},on:{click:e.handleBorrowMore}},[e.disabled?[e._v(e._s(e.errorMessage))]:[e._v(e._s(e.title))]],2),t("info-line",{attrs:{label:e.t("kensetsu.borrowTax"),"label-tooltip":e.t("kensetsu.borrowTaxDescription",{value:e.borrowTaxPercent}),value:e.formattedBorrowTax,"asset-symbol":e.debtSymbol,"is-formatted":""}}),t("info-line",{attrs:{"is-formatted":"",label:e.t("networkFeeText"),"label-tooltip":e.t("networkFeeTooltipText"),value:e.networkFeeFormatted,"asset-symbol":e.xorSymbol,"fiat-value":e.getFiatAmountByCodecString(e.networkFee)}})],1)])},I=[],Z=N(a,A,I,!1,null,"4349994f");const $=Z.exports;export{$ as default};
