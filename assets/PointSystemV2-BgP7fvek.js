var D=Object.defineProperty;var U=(p,t,s)=>t in p?D(p,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[t]=s;var c=(p,t,s)=>U(p,typeof t!="symbol"?t+"":t,s);import{m as X,$ as x,a5 as I,f as E,X as j,aA as q,aB as z,hp as _,g as v,h as A,k as F,W as M,C as W,_ as P,l as b,j as y,n as $}from"./index-BHqySXo4.js";import{P as k,c as H,p as N}from"./pointSystem-DziW7hgO.js";import{b as K}from"./pointSystem-CudlRcaU.js";import"./consts-Bf-kzBRE.js";import"./tabs-Nr7W-OES.js";class Y{findLevel(t,s,e){const o=t.findIndex((C,l)=>{var i;const r=((i=t[l+1])==null?void 0:i.threshold)??1/0;return s>=C.threshold&&s<r}),n=o!==-1?o:t.length-1,a=t[n],u=t[n+1]??null,m=u?parseFloat((u.multiplier*e*k).toFixed(0)):null,f=s,h=u?u.threshold:null;return{levelCurrent:n+1,threshold:a.threshold,multiplier:a.multiplier,nextLevelRewardPoints:m,currentProgress:f,minimumAmountForNextLevel:h}}getEraCoefficient(t){return t===1?.5:1}calculateCategoryPoints(t){const s={},e={};return Object.entries(t).forEach(([o,n])=>{const a=H[o];if(!a)throw new Error(`Category "${o}" was not found.`);const{levelCurrent:u,threshold:m,multiplier:f,nextLevelRewardPoints:h,currentProgress:C,minimumAmountForNextLevel:l}=this.findLevel(a.levels,n,a.maxPercentage),r=parseFloat((f*a.maxPercentage*k).toFixed(0)),i={levelCurrent:u,threshold:m,points:r,nextLevelRewardPoints:h,currentProgress:C,minimumAmountForNextLevel:l,titleProgress:a.titleProgress,titleTask:a.titleTask,descriptionTask:a.descriptionTask,imageName:a.imageName};o==="firstTxAccount"?e[o]=i:s[o]=i}),{...s,...e}}}const w=new Y;var G=Object.defineProperty,J=Object.getOwnPropertyDescriptor,g=(p,t,s,e)=>{for(var o=e>1?void 0:e?J(t,s):t,n=p.length-1,a;n>=0;n--)(a=p[n])&&(o=(e?a(t,s,o):a(o))||o);return e&&o&&G(t,s,o),o};let d=class extends X(x.LoadingMixin,x.FormattedAmountMixin,I){constructor(){super(...arguments);c(this,"LogoSize",E.LogoSize);c(this,"referralRewards");c(this,"accountAssets");c(this,"accountLiquidity");c(this,"account");c(this,"getAsset");c(this,"getAccountReferralRewards");c(this,"subscribeOnList");c(this,"subscribeOnUpdates");c(this,"pointSystemCategory",N);c(this,"categoryPoints",this.pointSystemCategory.tasks);c(this,"pointsForCards",null)}updateSubscriptions(s){s&&this.withLoading(this.initData)}get totalPoints(){return this.pointsForCards?Object.values(this.pointsForCards).reduce((s,e)=>s+(e.points||0),0):0}getTotalLiquidityFiatValue(){let s=0;return this.accountLiquidity.forEach(e=>{var m,f;const o=this.getAsset(e.firstAddress),n=this.getAsset(e.secondAddress),a=parseFloat(((m=this.getFiatAmountByCodecString(e.firstBalance,o))==null?void 0:m.replace(",","."))||"0"),u=parseFloat(((f=this.getFiatAmountByCodecString(e.secondBalance,n))==null?void 0:f.replace(",","."))||"0");s+=a+u}),s}getCurrentFiatBalanceForToken(s){const e=this.getFiatBalance(this.accountAssets.find(n=>n.symbol===s))??"0";return parseFloat(e.replace(",","."))}getPointsForCategories(s){var C;const e=s.createdAt.timestamp??0,o=this.getTotalLiquidityFiatValue(),n=this.getCurrentFiatBalanceForToken(j.symbol),a=this.getCurrentFiatBalanceForToken(q.symbol),u=this.getCurrentFiatBalanceForToken(z.symbol),m=_((C=this.referralRewards)==null?void 0:C.rewards),f=s.points.reduce((l,r)=>{const i=w.getEraCoefficient(r.version),S=_(r.bridge.incomingUSD)+_(r.bridge.outgoingUSD),L=_(r.fees.amountUSD),R=_(r.burned.amountUSD),T=_(r.kensetsu.amountUSD),O=_(r.orderBook.amountUSD),B=_(r.governance.amountUSD),V=_(r.staking.amountUSD);return l.depositVolumeBridges+=S*i,l.networkFeeSpent+=L*i,l.XORBurned+=R*i,l.kensetsuVolumeRepaid+=T*i,l.orderbookVolume+=O*i,l.governanceLockedXOR+=B*i,l.nativeXorStaking+=V*i,l},{depositVolumeBridges:0,networkFeeSpent:0,XORBurned:0,kensetsuVolumeRepaid:0,orderbookVolume:0,governanceLockedXOR:0,nativeXorStaking:0});return{firstTxAccount:e,liquidityProvision:o,XORHoldings:n,VXORHoldings:a,KUSDHoldings:u,referralRewards:m,...f}}async initData(){if(this.isLoggedIn){await this.getAccountReferralRewards();const s=this.account.address,e=await K(s);e&&(this.pointsForCards=w.calculateCategoryPoints(this.getPointsForCategories(e)))}}created(){this.withApi(async()=>{this.subscribeOnList(),this.subscribeOnUpdates(),await this.initData()})}};g([v.referrals.referralRewards],d.prototype,"referralRewards",2);g([v.wallet.account.accountAssets],d.prototype,"accountAssets",2);g([v.pool.accountLiquidity],d.prototype,"accountLiquidity",2);g([A.wallet.account.account],d.prototype,"account",2);g([A.assets.assetDataByAddress],d.prototype,"getAsset",2);g([F.referrals.getAccountReferralRewards],d.prototype,"getAccountReferralRewards",2);g([F.pool.subscribeOnAccountLiquidityList],d.prototype,"subscribeOnList",2);g([F.pool.subscribeOnAccountLiquidityUpdates],d.prototype,"subscribeOnUpdates",2);g([M("isLoggedIn")],d.prototype,"updateSubscriptions",1);d=g([W({components:{FormattedAmount:P.FormattedAmount,TokenLogo:P.TokenLogo,PointCard:b(y.PointCard),TaskCard:b(y.TaskCard),FirstTxCard:b(y.FirstTxCard),SettingsTabs:b(y.SettingsTabs)}})],d);var Q=function(){var e,o;var t=this,s=t._self._c;return t._self._setupProxy,s("div",{staticClass:"points__container"},[s("s-card",{class:["points",{"points-loading":t.loading}],attrs:{"border-radius":"small",shadow:"always",size:"medium",pressed:""},scopedSlots:t._u([{key:"header",fn:function(){return[s("div",{staticClass:"points__header"},[s("div",[s("h2",[t._v(t._s(t.t("points.title")))]),!t.loading&&t.isLoggedIn?s("h3",[t._v(t._s(t.totalPoints))]):t._e()]),s("p",[t._v(t._s(t.t("points.airdrop")))])])]},proxy:!0}])},[s("div",{staticClass:"points__main s-flex-row"},[t.isLoggedIn?s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],class:["points__cards","s-flex-column",{loading:t.loading}]},[s("s-tabs",{staticClass:"points__tabs",attrs:{type:"rounded"},model:{value:t.categoryPoints,callback:function(n){t.categoryPoints=n},expression:"categoryPoints"}},[s("s-tab",{attrs:{label:t.t("points.yourTasks").toUpperCase(),name:"tasks"}},[s("s-scrollbar",{staticClass:"points__cards-scrollbar",attrs:{"wrap-style":{padding:"0",margin:"0",overflowY:"auto"}}},[s("a",{staticClass:"points__soratopia s-flex",attrs:{rel:"nofollow noopener",target:"_blank",href:"https://t.me/soratopia_bot/app"}},[s("div",{staticClass:"points__soratopia-container s-flex"},[s("button",{staticClass:"points__soratopia-action"},[t._v(t._s(t.t("points.openTelegram")))]),s("span",{staticClass:"points__soratopia-text"},[t._v(t._s(t.t("points.toEarnPoints")))])])]),s("a",{staticClass:"points__sora-card s-flex",attrs:{rel:"nofollow noopener",target:"_blank",href:"https://soracard.com"}},[s("div",{staticClass:"points__sora-card-container s-flex"},[s("button",{staticClass:"points__sora-card-action"},[t._v(t._s(t.t("points.soraCard")))]),s("span",{staticClass:"points__sora-card-text"},[t._v(t._s(t.t("points.toEarnPoints")))])])]),t._l(t.pointsForCards,function(n,a){return s("task-card",{key:a,staticClass:"points__card-task",attrs:{"points-for-category":n,"category-name":a}})})],2)],1),s("s-tab",{attrs:{label:t.t("points.progress").toUpperCase(),name:"progress"}},[s("s-scrollbar",{staticClass:"points__cards-scrollbar",attrs:{"wrap-style":{padding:"0",margin:"0",overflowY:"auto"}}},[s("div",{staticClass:"points__cards"},[t._l(Object.entries(t.pointsForCards??{}).slice(0,-1),function([n,a]){return s("point-card",{key:n,staticClass:"points__card",attrs:{"points-for-category":a,"category-name":n}})}),s("first-tx-card",{staticClass:"points__first-tx-card",attrs:{date:((o=(e=t.pointsForCards)==null?void 0:e.firstTxAccount)==null?void 0:o.currentProgress)??0}})],2)])],1)],1)],1):s("div",{staticClass:"points__connect s-flex-column"},[s("span",{staticClass:"points__connect-title d2"},[t._v(t._s(t.t("points.loginText")))]),s("s-button",{staticClass:"points__connect-action s-typography-button--medium",attrs:{type:"primary"},on:{click:t.connectSoraWallet}},[t._v(" "+t._s(t.t("connectWalletText"))+" ")])],1)])])],1)},Z=[],tt=$(d,Q,Z,!1,null,"e0f41d69");const ct=tt.exports;export{ct as default};
