var B=Object.defineProperty;var _=(u,t,e)=>t in u?B(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var a=(u,t,e)=>_(u,typeof t!="symbol"?t+"":t,e);import{m as y,T as S,$ as b,ae as g,af as N,b as i,Z as F,g as k,h as d,i as P,k as O,W as p,C,l as w,j as T,n as x}from"./index-BHqySXo4.js";var A=Object.defineProperty,E=Object.getOwnPropertyDescriptor,l=(u,t,e,s)=>{for(var r=s>1?void 0:s?E(t,e):t,o=u.length-1,c;o>=0;o--)(c=u[o])&&(r=(s?c(t,e,r):c(r))||r);return s&&r&&A(t,e,r),r};let n=class extends y(S,b.LoadingMixin,b.FormattedAmountMixin){constructor(){super(...arguments);a(this,"limitOrderType");a(this,"asks");a(this,"bids");a(this,"quoteAsset");a(this,"orderBookLastDeal");a(this,"currentOrderBook");a(this,"orderBookId");a(this,"nodeIsConnected");a(this,"exchangeRate");a(this,"currencySymbol");a(this,"setQuoteValue");a(this,"setSide");a(this,"subscribeToBidsAndAsks");a(this,"PriceVariant",g.PriceVariant);a(this,"maxRowsNumber",11);a(this,"selectedStep","");a(this,"scalerOpen",!1)}setSteps(){var e;this.selectedStep=(e=this.currentOrderBook)==null?void 0:e.tickSize.toString()}async updateSubscription(){await this.withLoading(async()=>{await this.withParentLoading(async()=>{await this.subscribeToBidsAndAsks()})})}handleSelectStep(e){this.selectedStep=e}fillPrice(e,s){this.isMarketOrder||(this.setSide(s),this.setQuoteValue(Number(e).toString()))}get isMarketOrder(){return this.limitOrderType===N.market}get averagePrice(){var e,s,r;return(r=((e=this.asks)==null?void 0:e[0])??((s=this.bids)==null?void 0:s[0]))==null?void 0:r[0]}get averagePricePrecision(){if(!this.averagePrice)return;const e=this.averagePrice;let s=e,r=i.FPNumber.ONE;if(e.isLessThan(i.FPNumber.ONE)){const o=new i.FPNumber(.1);for(r=o;s.isLessThan(i.FPNumber.ONE)&&(s=e.div(r),!s.isGreaterThanOrEqualTo(i.FPNumber.ONE));)r=r.mul(o)}else if(e.isGreaterThan(i.FPNumber.TEN)){const o=i.FPNumber.TEN;for(r=o;s.isGreaterThan(i.FPNumber.ONE)&&(s=e.div(r),!s.isLessThan(i.FPNumber.TEN));)r=r.mul(o)}return r.toNumber()}get steps(){var o;const e=[],s=(o=this.currentOrderBook)==null?void 0:o.tickSize;if(!(this.averagePricePrecision&&s))return e;const r=new i.FPNumber(this.averagePricePrecision??1);for(let c=r;c.isGreaterThanOrEqualTo(s);)e.push(c.toString()),c=c.div(i.FPNumber.TEN);return e.slice(-6)}get showAggregationOptions(){var e,s;return!!((e=this.asks)!=null&&e.length&&((s=this.bids)!=null&&s.length))}get lastDealTrendsUp(){var e;return((e=this.orderBookLastDeal)==null?void 0:e.side)===g.PriceVariant.Buy}get iconTrend(){return this.lastDealTrendsUp?"arrows-arrow-bold-top-24":"arrows-arrow-bold-bottom-24"}get lastDealPrice(){var e;return((e=this.orderBookLastDeal)==null?void 0:e.price)??i.FPNumber.ZERO}get lastPriceFormatted(){return this.lastDealPrice.toLocaleString()}get fiatValue(){if(!this.quoteAsset)return F;const e=this.getFiatAmount(this.lastDealPrice.toString(),this.quoteAsset)||"0",s=new i.FPNumber(e).mul(this.exchangeRate).toLocaleString();return s?`${this.currencySymbol}${s}`:""}getComputedClassTrend(){const e=["stock-book-delimiter"];return this.lastDealTrendsUp?e.push("stock-book-delimiter--up"):e.push("stock-book-delimiter--down"),e.join(" ")}get asksFormatted(){return this.formatPriceVolumes(this.asks)}get bidsFormatted(){return this.formatPriceVolumes(this.bids)}get sellOrders(){return this.asksFormatted.slice(-this.maxRowsNumber)}get buyOrders(){return this.bidsFormatted.slice(0,this.maxRowsNumber)}getHeight(){return`height: ${24*(this.asksFormatted.length<this.maxRowsNumber?this.maxRowsNumber-this.asksFormatted.length:0)}px`}getStyles(e){return`width: ${e}%`}isBookPrecisionEqual(e){var s,r;return e===((r=(s=this.currentOrderBook)==null?void 0:s.tickSize)==null?void 0:r.toString())}recalcFilledValue(e){if(!e.length)return[];const s=e.map(o=>new i.FPNumber(o.amount)),r=i.FPNumber.max(...s);return e.map(o=>({...o,filled:this.getAmountProportion(new i.FPNumber(o.amount),r)}))}calculateStepsDistribution(e,s=10){return e}get bookPrecision(){var e,s,r,o;return((o=(r=(s=(e=this.currentOrderBook)==null?void 0:e.tickSize)==null?void 0:s.toLocaleString())==null?void 0:r.split(i.FPNumber.DELIMITERS_CONFIG.decimal)[1])==null?void 0:o.length)||0}get amountPrecision(){var e,s,r,o;return((o=(r=(s=(e=this.currentOrderBook)==null?void 0:e.stepLotSize)==null?void 0:s.toLocaleString())==null?void 0:r.split(i.FPNumber.DELIMITERS_CONFIG.decimal)[1])==null?void 0:o.length)||0}getAmountProportion(e,s){return e.div(s).mul(i.FPNumber.HUNDRED).toNumber()}toBookPrecision(e){return e.toNumber().toFixed(this.bookPrecision)}toAmountPrecision(e){return e.toNumber().toFixed(this.amountPrecision)}formatPriceVolumes(e){if(!this.selectedStep)return[];const s=this.calculateStepsDistribution(e,Number(this.selectedStep)),r=i.FPNumber.max(...s.map(c=>c[1])),o=[];return s.forEach(c=>{const[h,m,f]=c;if(m.isZero())return;const v=this.isBookPrecisionEqual(this.selectedStep)?h.mul(m):f;o.push({price:this.toBookPrecision(h),amount:this.toAmountPrecision(m),total:this.toBookPrecision(v),filled:this.getAmountProportion(m,r)})}),o}};l([k.orderBook.limitOrderType],n.prototype,"limitOrderType",2);l([k.orderBook.asks],n.prototype,"asks",2);l([k.orderBook.bids],n.prototype,"bids",2);l([d.orderBook.quoteAsset],n.prototype,"quoteAsset",2);l([d.orderBook.orderBookLastDeal],n.prototype,"orderBookLastDeal",2);l([d.orderBook.currentOrderBook],n.prototype,"currentOrderBook",2);l([d.orderBook.orderBookId],n.prototype,"orderBookId",2);l([d.settings.nodeIsConnected],n.prototype,"nodeIsConnected",2);l([d.wallet.settings.exchangeRate],n.prototype,"exchangeRate",2);l([d.wallet.settings.currencySymbol],n.prototype,"currencySymbol",2);l([P.orderBook.setQuoteValue],n.prototype,"setQuoteValue",2);l([P.orderBook.setSide],n.prototype,"setSide",2);l([O.orderBook.subscribeToBidsAndAsks],n.prototype,"subscribeToBidsAndAsks",2);l([p("currentOrderBook",{immediate:!0})],n.prototype,"setSteps",1);l([p("orderBookId",{immediate:!0}),p("nodeIsConnected")],n.prototype,"updateSubscription",1);n=l([C({components:{BaseWidget:w(T.BaseWidget)}})],n);var D=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("base-widget",t._b({directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"stock-book book",attrs:{extensive:"",title:t.t("orderBook.orderBook"),tooltip:t.t("orderBook.tooltip.bookWidget")},scopedSlots:t._u([{key:"filters",fn:function(){return[t._e()]},proxy:!0}])},"base-widget",t.$attrs,!1),[e("div",{staticClass:"book-columns"},[e("div",[t._v(t._s(t.t("priceText")))]),e("div",[t._v(t._s(t.t("orderBook.amount")))]),e("div",[t._v(t._s(t.t("orderBook.total")))])]),t.asksFormatted.length?e("div",{staticClass:"stock-book-sell",class:{unclickable:t.isMarketOrder}},[e("div",{staticClass:"margin",style:t.getHeight()}),t._l(t.sellOrders,function(s){return e("div",{key:s.price,staticClass:"row",on:{click:function(r){return t.fillPrice(s.price,t.PriceVariant.Sell)}}},[e("span",{staticClass:"order-info total"},[t._v(t._s(s.total))]),e("span",{staticClass:"order-info amount"},[t._v(t._s(s.amount))]),e("span",{staticClass:"order-info price"},[t._v(t._s(s.price))]),e("div",{staticClass:"bar",style:t.getStyles(s.filled)})])})],2):e("div",{staticClass:"stock-book-sell--no-asks"},[t._v(t._s(t.t("orderBook.book.noAsks")))]),e("div",{class:t.getComputedClassTrend()},[e("div",[e("span",{staticClass:"mark-price"},[t._v(t._s(t.lastPriceFormatted))]),e("s-icon",{staticClass:"trend-icon",attrs:{name:t.iconTrend,size:"18"}}),e("span",{staticClass:"last-traded-price"},[t._v(t._s(t.fiatValue))])],1)]),t.bidsFormatted.length?e("div",{staticClass:"stock-book-buy",class:{unclickable:t.isMarketOrder}},t._l(t.buyOrders,function(s){return e("div",{key:s.price,staticClass:"row",on:{click:function(r){return t.fillPrice(s.price,t.PriceVariant.Buy)}}},[e("span",{staticClass:"order-info total"},[t._v(t._s(s.total))]),e("span",{staticClass:"order-info amount"},[t._v(t._s(s.amount))]),e("span",{staticClass:"order-info price"},[t._v(t._s(s.price))]),e("div",{staticClass:"bar",style:t.getStyles(s.filled)})])}),0):e("div",{staticClass:"stock-book-buy--no-bids"},[t._v(t._s(t.t("orderBook.book.noBids")))])])},L=[],V=x(n,D,L,!1,null,null);const q=V.exports;export{q as default};
