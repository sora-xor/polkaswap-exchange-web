var p=Object.defineProperty;var u=(l,s,e)=>s in l?p(l,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[s]=e;var o=(l,s,e)=>u(l,typeof s!="symbol"?s+"":s,e);import{m as g,T as f,$ as c,ae as O,h3 as b,g as h,h as T,k as I,i as m,W as S,C as B,_ as C,R as y,n as P}from"./index-BHqySXo4.js";import _ from"./OrderTable-0VvzHYYp.js";import"./ScrollableTableMixin-C9crfC47.js";import"./orderBook-BNMMkkrL.js";var L=Object.defineProperty,w=Object.getOwnPropertyDescriptor,d=(l,s,e,r)=>{for(var t=r>1?void 0:r?w(s,e):s,i=l.length-1,n;i>=0;i--)(n=l[i])&&(t=(r?n(s,e,t):n(t))||t);return r&&t&&L(s,e,t),t};let a=class extends g(f,c.LoadingMixin,c.FormattedAmountMixin){constructor(){super(...arguments);o(this,"userLimitOrders");o(this,"currentOrderBook");o(this,"subscribeOnLimitOrders");o(this,"resetLimitOrdersSubscription");o(this,"ordersToBeCancelled");o(this,"setOrdersToBeCancelled");o(this,"orderTable");o(this,"currentPage",1);o(this,"tableItems",[]);o(this,"selectedPageItemIds",[]);o(this,"needToUpdateSelection",!1);o(this,"syncTableItemsRefreshing",!1)}get ordersToBeCancelledIds(){return this.ordersToBeCancelled.map(({id:e})=>e)}get loadingState(){return this.parentLoading||this.loading}get isSelectionAllowed(){return!!this.currentOrderBook&&this.currentOrderBook.status!==O.OrderBookStatus.Stop}get sortedUserLimitOrders(){return[...this.userLimitOrders].sort((e,r)=>r.time-e.time)}async updatePagedOrdersSubscription(e,r){if(!(!(e!=null&&e.length)||e.length===(r==null?void 0:r.length))){if(this.syncTableItemsRefreshing=!0,await b(()=>!this.syncTableItemsRefreshing),this.ordersToBeCancelledIds.length){const t=this.tableItems.filter(({id:i})=>this.ordersToBeCancelledIds.includes(i));this.setOrdersToBeCancelled(t)}this.handlePagination(this.currentPage)}}async handlePagination(e,r){await this.withLoading(async()=>{const t=r??this.tableItems;this.currentPage=e,this.resetLimitOrdersSubscription(),t.length&&await this.subscribeOnLimitOrders(t.map(({id:i})=>i))})}restoreSelectedData(){const e=this.tableItems.filter(({id:r})=>this.ordersToBeCancelledIds.includes(r));e.forEach(r=>{var t,i,n;(n=(i=(t=this.orderTable)==null?void 0:t.tableComponent)==null?void 0:i.toggleRowSelection)==null||n.call(i,r,!0)}),this.selectedPageItemIds=e.map(({id:r})=>r)}handleSelect(e){this.needToUpdateSelection=!0}handleSelectRow(e){var r,t,i;this.isSelectionAllowed&&(this.needToUpdateSelection=!0,(i=(t=(r=this.orderTable)==null?void 0:r.tableComponent)==null?void 0:t.toggleRowSelection)==null||i.call(t,e))}handleSelectionChange(e){if(!(this.isSelectionAllowed&&this.needToUpdateSelection))return;const r=this.selectedPageItemIds.length-e.length;if(r===1){const t=e.map(({id:n})=>n),i=this.selectedPageItemIds.find(n=>!t.includes(n));i&&this.setOrdersToBeCancelled(this.ordersToBeCancelled.filter(({id:n})=>n!==i))}else if(r===-1){const t=e.find(({id:i})=>!this.selectedPageItemIds.includes(i));t&&this.setOrdersToBeCancelled([...this.ordersToBeCancelled,t])}this.selectedPageItemIds=e.map(({id:t})=>t),this.needToUpdateSelection=!1}syncTableItems(e){this.tableItems=e,this.syncTableItemsRefreshing=!1,this.restoreSelectedData()}beforeDestroy(){this.isSelectionAllowed&&this.setOrdersToBeCancelled([]),this.resetLimitOrdersSubscription()}};d([h.orderBook.userLimitOrders],a.prototype,"userLimitOrders",2);d([T.orderBook.currentOrderBook],a.prototype,"currentOrderBook",2);d([I.orderBook.subscribeOnLimitOrders],a.prototype,"subscribeOnLimitOrders",2);d([m.orderBook.resetPagedUserLimitOrdersSubscription],a.prototype,"resetLimitOrdersSubscription",2);d([h.orderBook.ordersToBeCancelled],a.prototype,"ordersToBeCancelled",2);d([m.orderBook.setOrdersToBeCancelled],a.prototype,"setOrdersToBeCancelled",2);d([y("orderTable")],a.prototype,"orderTable",2);d([S("sortedUserLimitOrders",{deep:!0,immediate:!0})],a.prototype,"updatePagedOrdersSubscription",1);a=d([B({components:{OrderTable:_,HistoryPagination:C.HistoryPagination}})],a);var R=function(){var s=this,e=s._self._c;return s._self._setupProxy,e("order-table",{ref:"orderTable",attrs:{"is-open-orders":"",orders:s.sortedUserLimitOrders,selectable:s.isSelectionAllowed,"parent-loading":s.loadingState},on:{"cell-click":s.handleSelectRow,"selection-change":s.handleSelectionChange,select:s.handleSelect,"page-updated":s.handlePagination,sync:s.syncTableItems}})},k=[],v=P(a,R,k,!1,null,null);const j=v.exports;export{j as default};
