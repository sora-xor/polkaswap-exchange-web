var N=Object.defineProperty;var _=(r,e,s)=>e in r?N(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var o=(r,e,s)=>_(r,typeof e!="symbol"?e+"":e,s);import{b as u,m as F,$ as E,T as Z,aJ as b,C as v,F as g,g as P,h as C,P as R}from"./index-BHqySXo4.js";var y=Object.defineProperty,M=Object.getOwnPropertyDescriptor,T=(r,e,s,t)=>{for(var i=t>1?void 0:t?M(e,s):e,a=r.length-1,l;a>=0;a--)(l=r[a])&&(i=(t?l(e,s,i):l(i))||i);return t&&i&&y(e,s,i),i};const x=new u.FPNumber(5256e3);let m=class extends F(E.FormattedAmountMixin,Z){getEmission(r,e){const s=!!(r!=null&&r.isFarm),t=new u.FPNumber((s?e==null?void 0:e.farmsTotalMultiplier:e==null?void 0:e.stakingTotalMultiplier)??0);if(t.isZero())return u.FPNumber.ZERO;const a=new u.FPNumber((r==null?void 0:r.multiplier)??0).div(t),l=(s?e==null?void 0:e.farmsAllocation:e==null?void 0:e.stakingAllocation)??u.FPNumber.ZERO,A=(e==null?void 0:e.tokenPerBlock)??u.FPNumber.ZERO;return l.mul(A).mul(a)}getApr(r,e,s){return e.isZero()?u.FPNumber.ZERO:r.mul(x).mul(s).div(e).mul(u.FPNumber.HUNDRED)}getTvl(r,e,s){return r?r.isFarm?s?u.FPNumber.fromCodecValue(s.secondBalance).div(u.FPNumber.fromCodecValue(s.balance)).mul(r.totalTokensInPool).mul(e).mul(new u.FPNumber(2)):u.FPNumber.ZERO:r.totalTokensInPool.mul(e):u.FPNumber.ZERO}formatApr(r){return r.isZero()?this.t("calculatingText"):b(r,!0)}};m=T([v],m);var B=Object.defineProperty,$=Object.getOwnPropertyDescriptor,n=(r,e,s,t)=>{for(var i=t>1?void 0:t?$(e,s):e,a=r.length-1,l;a>=0;a--)(l=r[a])&&(i=(t?l(e,s,i):l(i))||i);return t&&i&&B(e,s,i),i};const p=(r,e=!0)=>r.reduce((s,t)=>(t.isFarm!==e||(s[t.baseAsset]||(s[t.baseAsset]={}),s[t.baseAsset][t.poolAsset]||(s[t.baseAsset][t.poolAsset]=[]),s[t.baseAsset][t.poolAsset].push(t)),s),{});let c=class extends F(m){constructor(){super(...arguments);o(this,"isFarmingPage");o(this,"tokens");o(this,"demeterPools");o(this,"demeterAccountPools");o(this,"getAsset");o(this,"showCalculatorDialog",!1);o(this,"baseAsset",null);o(this,"poolAsset",null);o(this,"rewardAsset",null);o(this,"liquidity",null)}get tokenInfos(){return this.tokens.reduce((e,s)=>({...e,[s.assetId]:s}),{})}get uniqueAssets(){const e=this.demeterPools.reduce((s,t)=>(s.push(t.baseAsset,t.poolAsset,t.rewardAsset),s),[]);return[...new Set(e)]}get demeterAssetsData(){return this.uniqueAssets.reduce((e,s)=>{const t=this.getAsset(s),i=t?g.fromCodecValue(this.getAssetFiatPrice(t)??0):g.ZERO;return e[s]={...t,price:i},e},{})}get pools(){return p(this.demeterPools,this.isFarmingPage)}get accountPools(){return p(this.demeterAccountPools,this.isFarmingPage)}get selectedPool(){var s;if(!(this.baseAsset&&this.poolAsset&&this.rewardAsset))return null;const e=(s=this.pools[this.baseAsset])==null?void 0:s[this.poolAsset];return e?e.find(t=>t.rewardAsset===this.rewardAsset):null}get selectedAccountPool(){return this.selectedPool?this.getAccountPool(this.selectedPool):null}getDerivedPools(e){return Array.isArray(e)?e.reduce((s,t)=>{const i=!t.isRemoved,a=this.getAccountPool(t),l=!!a&&this.isActiveAccountPool(a);return(i||l)&&s.push({pool:t,accountPool:a}),s},[]):[]}isActiveAccountPool(e){return!(e.pooledTokens.isZero()&&e.rewards.isZero())}prepareDerivedPoolData(e,s,t){const i=this.demeterAssetsData[e.baseAsset],a=this.demeterAssetsData[e.poolAsset],l=this.demeterAssetsData[e.rewardAsset],A=this.tokenInfos[e.rewardAsset],d=this.getEmission(e,A),h=this.getTvl(e,a.price,t),w=this.getApr(d,h,l.price),D=this.formatApr(w),O=`$${b(h)}`;return{pool:e,accountPool:s,tokenInfo:A,baseAsset:i,poolAsset:a,rewardAsset:l,emission:d,tvl:O,apr:D}}getAccountPool(e){var s,t;return(t=(s=this.accountPools[e.baseAsset])==null?void 0:s[e.poolAsset])==null?void 0:t.find(i=>i.rewardAsset===e.rewardAsset)}showPoolCalculator(e){this.setDialogParams(e),this.showCalculatorDialog=!0}setDialogParams(e){this.baseAsset=e.baseAsset,this.poolAsset=e.poolAsset,this.rewardAsset=e.rewardAsset,this.liquidity=e.liquidity}};n([R({default:!0,type:Boolean})],c.prototype,"isFarmingPage",2);n([P.demeterFarming.tokens],c.prototype,"tokens",2);n([P.demeterFarming.pools],c.prototype,"demeterPools",2);n([P.demeterFarming.accountPools],c.prototype,"demeterAccountPools",2);n([C.assets.assetDataByAddress],c.prototype,"getAsset",2);c=n([v],c);export{c as B};
