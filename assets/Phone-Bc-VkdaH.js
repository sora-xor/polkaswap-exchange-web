var b=Object.defineProperty;var _=(r,t,e)=>t in r?b(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var s=(r,t,e)=>_(r,typeof t!="symbol"?t+"":t,e);import{m as S,T as v,$ as m,aF as c,aD as p,g as u,h as g,i as y,k as l,W as P,C as D,l as x,j as N,R as A,n as T}from"./index-BHqySXo4.js";var w=Object.defineProperty,I=Object.getOwnPropertyDescriptor,a=(r,t,e,i)=>{for(var o=i>1?void 0:i?I(t,e):t,d=r.length-1,h;d>=0;d--)(h=r[d])&&(o=(i?h(t,e,o):h(o))||o);return i&&o&&w(t,e,o),o};const O=8,C=6,f=59;let n=class extends S(v,m.LoadingMixin,m.NotificationMixin){constructor(){super(...arguments);s(this,"authLogin");s(this,"userInfo");s(this,"attemptCounter");s(this,"wantsToPassKycAgain");s(this,"currentStatus");s(this,"isEuroBalanceEnough");s(this,"setWillToPassKycAgain");s(this,"setReferenceNumber");s(this,"getUserStatus");s(this,"getUserIban");s(this,"initPayWingsAuthSdk");s(this,"getUserKycAttempt");s(this,"inputOtp");s(this,"smsCountDown","");s(this,"smsResendCount",f);s(this,"verificationCode","");s(this,"smsSent",!1);s(this,"sendOtpBtnLoading",!1);s(this,"notFoundPhoneWhenApplied",!1);s(this,"showSelectCountryDialog",!1);s(this,"selectedCountry",null);s(this,"phoneNumber","")}handleSmsCountChange(e){const i=e.toString().length>1?"":"0";this.smsCountDown=`0:${i}${e}`}get hasFreeAttempts(){return this.attemptCounter.hasFreeAttempts}verifyCode(){this.authLogin.PayWingsOtpCredentialVerification(this.verificationCode).catch(e=>{this.sendOtpBtnLoading=!1,this.verificationCode="",this.showAppNotification(this.t("card.infoMessageWrongOtp"),"error"),console.error("[SoraCard]: Auth",e)}),this.sendOtpBtnLoading=!0}sendSms(){var e;this.phoneNumber[0]==="0"&&(this.phoneNumber=this.phoneNumber.slice(1)),this.authLogin.PayWingsSendOtp(`${(e=this.selectedCountry)==null?void 0:e.dialCode}${this.phoneNumber}`,"Your verification code is: @Otp").catch(i=>{console.error("[SoraCard]: Auth",i)}),this.startSmsCountDown()}openSelectCountryDialog(){this.showSelectCountryDialog=!0}handleSelectCountry(e){this.selectedCountry=e}get buttonDisabled(){return this.verificationCode.length!==C}get otpInputDisabled(){return!this.smsSent||!this.isPhoneNumberValid}get buttonText(){return this.verificationCode.length!==C?this.t("card.enterCodeBtn"):this.t("card.confirmCodeBtn")}set buttonText(e){this.buttonText=e}get sendSmsButtonText(){return this.smsSent?this.t("card.resendInBtn",{value:this.smsCountDown}):this.t("card.sendCodeBtn")}get isPhoneNumberValid(){var i;const e=(i=this.selectedCountry)==null?void 0:i.dialCode;return!!(e&&this.phoneNumber&&`${e}${this.phoneNumber}`.length>=O)}get sendSmsDisabled(){return!this.isPhoneNumberValid||this.smsSent}get phoneInputDisabled(){return this.smsSent}get phoneInputDescription(){return this.smsSent?this.t("card.phoneInputAfterSendDesc"):this.t("card.noSpamText")}startSmsCountDown(){const e=setInterval(()=>{this.smsResendCount--,this.smsResendCount<0&&(this.smsSent=!1,this.verificationCode="",this.smsResendCount=f,clearInterval(e))},1e3)}async mounted(){await this.$nextTick(),localStorage.removeItem("PW-Email"),await this.initPayWingsAuthSdk(),this.authLogin&&this.authLogin.on("SendOtp-Success",()=>{this.smsSent=!0,this.$nextTick(()=>{this.inputOtp.focus()})}).on("MinimalRegistrationReq",()=>{this.setReferenceNumber(null),this.sendOtpBtnLoading=!1,this.$emit("confirm",c.Email),this.sendOtpBtnLoading=!1}).on("Otp-Verification-Success",async()=>{if(await this.getUserStatus(),this.currentStatus===p.Rejected){if(await this.getUserKycAttempt(),this.wantsToPassKycAgain&&this.hasFreeAttempts){this.$emit("confirm",c.Kyc),this.setWillToPassKycAgain(!1);return}this.$emit("confirm",c.KycResult);return}if(this.currentStatus===p.Accepted&&(await this.getUserIban(),this.userInfo.iban?this.$emit("confirm",c.Dashboard):this.$emit("confirm",c.KycResult)),this.currentStatus===p.Pending){this.$emit("confirm",c.KycResult);return}this.currentStatus||(this.isEuroBalanceEnough?this.$emit("confirm",c.Kyc):this.$emit("confirm",c.Payment))}).on("Verification-Email-Sent-Success",()=>{this.sendOtpBtnLoading=!1,this.$emit("confirm",c.Email),this.sendOtpBtnLoading=!1})}};a([u.soraCard.authLogin],n.prototype,"authLogin",2);a([u.soraCard.userInfo],n.prototype,"userInfo",2);a([u.soraCard.attemptCounter],n.prototype,"attemptCounter",2);a([u.soraCard.wantsToPassKycAgain],n.prototype,"wantsToPassKycAgain",2);a([g.soraCard.currentStatus],n.prototype,"currentStatus",2);a([g.soraCard.isEuroBalanceEnough],n.prototype,"isEuroBalanceEnough",2);a([y.soraCard.setWillToPassKycAgain],n.prototype,"setWillToPassKycAgain",2);a([y.soraCard.setReferenceNumber],n.prototype,"setReferenceNumber",2);a([l.soraCard.getUserStatus],n.prototype,"getUserStatus",2);a([l.soraCard.getUserIban],n.prototype,"getUserIban",2);a([l.soraCard.initPayWingsAuthSdk],n.prototype,"initPayWingsAuthSdk",2);a([l.soraCard.getUserKycAttempt],n.prototype,"getUserKycAttempt",2);a([A("otp")],n.prototype,"inputOtp",2);a([P("smsResendCount",{immediate:!0})],n.prototype,"handleSmsCountChange",1);n=a([D({components:{SelectCountryDialog:x(N.SelectCountryDialog)}})],n);var E=function(){var i;var t=this,e=t._self._c;return t._self._setupProxy,e("div",[e("p",{staticClass:"sora-card__number-input-desc"},[t._v(t._s(t.t("card.verificationCodeText")))]),e("s-button",{staticClass:"country-container",attrs:{autofocus:"",type:"tertiary",size:"big",disabled:t.phoneInputDisabled},on:{click:t.openSelectCountryDialog}},[e("span",{staticClass:"country-container__label s-flex"},[e("span",{staticClass:"country-container__text s-flex"},[t.selectedCountry?[e("span",{staticClass:"country-container__flag"},[t._v(t._s(t.selectedCountry.flag))]),e("span",[t._v(t._s(t.selectedCountry.translatedName))])]:[e("div",{staticClass:"country-container__flag country-container__flag--empty"}),e("span",[t._v(t._s(t.t("card.selectCountryText")))])]],2),e("s-icon",{staticClass:"country-container__icon",attrs:{name:"arrows-circle-chevron-bottom-24",size:"18"}})],1)]),e("div",{staticClass:"sora-card__number-input"},[e("div",{staticClass:"phone-container s-flex"},[e("s-input",{staticClass:"phone-code",attrs:{disabled:"",placeholder:t.t("card.code"),value:((i=t.selectedCountry)==null?void 0:i.dialCode)||""}}),e("s-input",{directives:[{name:"maska",rawName:"v-maska",value:"############",expression:"'############'"}],staticClass:"phone-number",attrs:{placeholder:t.t("card.phonePlaceholder"),disabled:t.phoneInputDisabled},model:{value:t.phoneNumber,callback:function(o){t.phoneNumber=o},expression:"phoneNumber"}})],1),e("s-button",{staticClass:"sora-card__send-sms-btn s-typography-button--large",attrs:{type:"secondary",disabled:t.sendSmsDisabled},on:{click:t.sendSms}},[t._v(" "+t._s(t.sendSmsButtonText)+" ")])],1),e("div",[e("p",{staticClass:"sora-card__number-input-desc"},[t._v(t._s(t.phoneInputDescription))]),t.smsSent?e("s-icon",{staticClass:"sora-card__icon",attrs:{name:"basic-check-mark-24",size:"14px"}}):t._e()],1),e("s-input",{directives:[{name:"maska",rawName:"v-maska",value:"######",expression:"'######'"}],ref:"otp",attrs:{placeholder:t.t("card.otpPlaceholder"),disabled:t.otpInputDisabled},model:{value:t.verificationCode,callback:function(o){t.verificationCode=o},expression:"verificationCode"}}),e("s-button",{staticClass:"sora-card__btn s-typography-button--large",attrs:{disabled:t.buttonDisabled,type:"primary",loading:t.sendOtpBtnLoading},on:{click:t.verifyCode}},[e("span",{staticClass:"text"},[t._v(" "+t._s(t.buttonText))])]),e("select-country-dialog",{attrs:{visible:t.showSelectCountryDialog},on:{"update:visible":function(o){t.showSelectCountryDialog=o},select:t.handleSelectCountry}})],1)},R=[],$=T(n,E,R,!1,null,"3ca994b6");const W=$.exports;export{W as default};
