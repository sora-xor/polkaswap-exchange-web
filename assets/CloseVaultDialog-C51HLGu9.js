var p=Object.defineProperty;var g=(i,t,e)=>t in i?p(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>g(i,typeof t!="symbol"?t+"":t,e);import{m as _,$ as d,X as v,Z as a,b as m,ai as y,P as f,O as h,g as k,h as A,C as F,_ as b,l as S,j as C,n as w}from"./index-BHqySXo4.js";var D=Object.defineProperty,B=Object.getOwnPropertyDescriptor,n=(i,t,e,s)=>{for(var l=s>1?void 0:s?B(t,e):t,u=i.length-1,c;u>=0;u--)(c=i[u])&&(l=(s?c(t,e,l):c(l))||l);return s&&l&&D(t,e,l),l};let r=class extends _(d.TransactionMixin,d.DialogMixin,d.FormattedAmountMixin){constructor(){super(...arguments);o(this,"xorSymbol",v.symbol);o(this,"swapLink","/#/swap/XOR/KUSD");o(this,"vault");o(this,"lockedAsset");o(this,"debtAsset");o(this,"networkFees");o(this,"accountXor")}get xorBalance(){var e,s;return this.getFPNumberFromCodec(((s=(e=this.accountXor)==null?void 0:e.balance)==null?void 0:s.transferable)??a)}get title(){return this.t("kensetsu.closeVault")}get networkFee(){return this.networkFees[m.Operation.CloseVault]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get debtSymbol(){var e;return((e=this.debtAsset)==null?void 0:e.symbol)??""}get lockedSymbol(){var e;return((e=this.lockedAsset)==null?void 0:e.symbol)??""}get vaultTitle(){return this.debtSymbol&&this.lockedSymbol?`${this.debtSymbol} / ${this.lockedSymbol}`:""}get formattedLockedAmount(){var e;return((e=this.vault)==null?void 0:e.lockedAmount.toLocaleString())??a}get fiatLockedAmount(){return this.vault&&this.lockedAsset?this.getFiatAmountByFPNumber(this.vault.lockedAmount,this.lockedAsset)??a:a}get debt(){var e;return((e=this.vault)==null?void 0:e.debt)??this.Zero}get formattedDebtAmount(){return this.debt.toLocaleString()??a}get fiatDebt(){return this.debtAsset?this.getFiatAmountByFPNumber(this.debt,this.debtAsset)??a:a}get debtAssetBalanceFp(){var e;return this.getFPNumberFromCodec(y(this.debtAsset)??0,(e=this.debtAsset)==null?void 0:e.decimals)}get formattedDebtAssetBalance(){return this.debtAssetBalanceFp.toLocaleString()}get fiatDebtAssetBalance(){return this.debtAsset?this.getFiatAmountByFPNumber(this.debtAssetBalanceFp,this.debtAsset)??a:a}get isInsufficientBalance(){return this.debt.gt(this.debtAssetBalanceFp)}get diff(){return this.debt.sub(this.debtAssetBalanceFp)}get formattedDiff(){return this.isInsufficientBalance?this.diff.toLocaleString():""}get diffWithSlippage(){return this.diff.mul(1.02)}get formattedDiffWithSlippage(){return this.isInsufficientBalance?this.diffWithSlippage.toLocaleString():""}get fiatDiffWithSlippage(){return this.debtAsset?this.getFiatAmountByFPNumber(this.diffWithSlippage,this.debtAsset)??a:a}get disabled(){return this.loading||this.isInsufficientXorForFee||this.isInsufficientBalance}get errorMessage(){let e="";return this.isInsufficientXorForFee?e=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isInsufficientBalance&&(e=this.t("insufficientBalanceText",{tokenSymbol:this.debtSymbol})),e}openSwap(){window.open(this.swapLink,"_blank")}async handleCloseVault(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{await this.withNotifications(async()=>{if(!(this.vault&&this.lockedAsset&&this.debtAsset))throw new Error("[api.kensetsu.closeVault]: vault or asset is null");await m.api.kensetsu.closeVault(this.vault,this.lockedAsset,this.debtAsset)})}catch(e){console.error(e)}this.isVisible=!1,this.$emit("confirm")}};n([f({type:Object,default:h})],r.prototype,"vault",2);n([f({type:Object,default:h})],r.prototype,"lockedAsset",2);n([f({type:Object,default:h})],r.prototype,"debtAsset",2);n([k.wallet.settings.networkFees],r.prototype,"networkFees",2);n([A.assets.xor],r.prototype,"accountXor",2);r=n([F({components:{DialogBase:b.DialogBase,InfoLine:b.InfoLine,ExternalLink:b.ExternalLink,PairTokenLogo:S(C.PairTokenLogo)}})],r);var x=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("dialog-base",{attrs:{title:t.title,visible:t.isVisible,tooltip:t.t("kensetsu.closeVaultDescription")},on:{"update:visible":function(s){t.isVisible=s}}},[e("div",{staticClass:"vault-close"},[e("div",{staticClass:"vault-close__title s-flex"},[e("pair-token-logo",{staticClass:"vault-close__icon",attrs:{size:"medium","first-token":t.debtAsset,"second-token":t.lockedAsset}}),e("h3",[t._v(t._s(t.vaultTitle))])],1),e("info-line",{staticClass:"vault-close__collateral",attrs:{label:t.t("kensetsu.yourCollateral"),"label-tooltip":t.t("kensetsu.yourCollateralDescription"),value:t.formattedLockedAmount,"asset-symbol":t.lockedSymbol,"fiat-value":t.fiatLockedAmount,"is-formatted":""}}),e("info-line",{staticClass:"vault-close__debt",attrs:{label:t.t("kensetsu.yourDebt"),"label-tooltip":t.t("kensetsu.yourDebtDescription"),value:t.formattedDebtAmount,"asset-symbol":t.debtSymbol,"fiat-value":t.fiatDebt,"is-formatted":""}}),e("info-line",{staticClass:"vault-close__balance",attrs:{label:t.t("kensetsu.yourDebtTokenBalance",{tokenSymbol:t.debtSymbol}),value:t.formattedDebtAssetBalance,"asset-symbol":t.debtSymbol,"fiat-value":t.fiatDebtAssetBalance,"is-formatted":""}}),t.isInsufficientBalance?e("s-card",{staticClass:"vault-close__error",attrs:{"border-radius":"small",shadow:"always",size:"medium",pressed:""}},[e("div",{staticClass:"vault-close__error-card-header s-flex",attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"vault-close__error-header s-flex-column"},[e("p",{staticClass:"vault-close__error-title p3"},[t._v(t._s(t.t("kensetsu.requiredAmountWithSlippage")))]),e("h3",{staticClass:"vault-close__error-value"},[t._v(t._s(t.formattedDiffWithSlippage))])]),e("div",{staticClass:"vault-close__error-badge"},[e("s-icon",{staticClass:"vault-close__error-icon",attrs:{name:"notifications-alert-triangle-24",size:"24"}})],1)]),e("p",{staticClass:"vault-close__error-message p3"},[t._v(" "+t._s(t.t("kensetsu.requiredAmountWithSlippageDescription",{tokenSymbol:t.debtSymbol,amount:t.formattedDiff}))+" ")]),e("s-button",{staticClass:"s-typography-button--large vault-close__button",attrs:{type:"primary"},on:{click:function(s){return s.preventDefault(),t.openSwap.apply(null,arguments)}}},[e("external-link",{staticClass:"vault-close__error-link s-typography-button--large",attrs:{tabindex:"-1",title:t.t("kensetsu.openSwap"),href:t.swapLink}})],1)],1):t._e(),e("s-button",{staticClass:"s-typography-button--large action-button vault-close__button",attrs:{type:"primary",disabled:t.disabled},on:{click:t.handleCloseVault}},[t.disabled?[t._v(t._s(t.errorMessage))]:[t._v(t._s(t.title))]],2),e("info-line",{attrs:{label:t.t("networkFeeText"),"label-tooltip":t.t("networkFeeTooltipText"),value:t.networkFeeFormatted,"asset-symbol":t.xorSymbol,"fiat-value":t.getFiatAmountByCodecString(t.networkFee),"is-formatted":""}})],1)])},L=[],P=w(r,x,L,!1,null,"812bf87e");const T=P.exports;export{T as default};
