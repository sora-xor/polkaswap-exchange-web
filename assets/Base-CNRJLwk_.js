var g=Object.defineProperty;var m=(a,e,t)=>e in a?g(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>m(a,typeof e!="symbol"?e+"":e,t);import{V as b,gA as v,p as y,gB as w,P as r,R as u,C as _,n as z}from"./index-BHqySXo4.js";var O=Object.defineProperty,C=Object.getOwnPropertyDescriptor,s=(a,e,t,l)=>{for(var o=l>1?void 0:l?C(e,t):e,d=a.length-1,p;d>=0;d--)(p=a[d])&&(o=(l?p(e,t,o):p(o))||o);return l&&o&&O(e,t,o),o};let n=class extends b{constructor(){super(...arguments);i(this,"id");i(this,"primaryTitle");i(this,"title");i(this,"tooltip");i(this,"full");i(this,"delimeter");i(this,"extensive");i(this,"flat");i(this,"loading");i(this,"pipDisabled");i(this,"onResize");i(this,"container");i(this,"content");i(this,"contentObserver",null);i(this,"mutationObserver",null);i(this,"handleContentResize",v(this.onContentResize,300,{leading:!1}));i(this,"size",{width:0,height:0});i(this,"pipWindow",null);i(this,"pipOpened",!1);i(this,"capitalize",y)}get hasHeader(){return!!this.title||!!this.$slots.title}get hasContent(){return!!this.$slots.default}get shadow(){return this.flat?"never":"always"}get isPipAvailable(){return this.pipDisabled?!1:"documentPictureInPicture"in window&&!this.pipOpened}async openPip(){if(this.isPipAvailable)try{const e=await window.documentPictureInPicture.requestWindow({width:this.$el.clientWidth,height:this.$el.clientHeight});this.pipOpened=!0,this.pipWindow=e;const t=this.$el,l=t.parentNode,o=Array.from(document.styleSheets).map(c=>Array.from(c.cssRules).map(f=>f.cssText).join(`
`)).join(`
`),d=e.document.createElement("style");d.innerHTML=o,e.document.head.appendChild(d);const p=e.document.documentElement,h=document.documentElement;for(const c of h.attributes)p.setAttribute(c.nodeName,c.nodeValue);e.document.body.appendChild(t),this.createMutationObserver(),e.addEventListener("pagehide",()=>{this.$nextTick(()=>{this.closePip(),l.appendChild(t)})})}catch(e){console.error("Error during PiP handling:",e)}}mounted(){this.createContentObserver(),this.updateSize(this.getWidgetSize())}beforeDestroy(){this.destroyContentObserver(),this.closePip()}closePip(){this.pipOpened&&this.pipWindow&&(this.destroyMutationObserver(),this.pipWindow.close(),this.pipOpened=!1,this.pipWindow=null)}createContentObserver(){this.hasContent&&(this.contentObserver=new ResizeObserver(this.handleContentResize),this.contentObserver.observe(this.content))}destroyContentObserver(){var e;(e=this.contentObserver)==null||e.disconnect(),this.contentObserver=null}createMutationObserver(){const e={childList:!0},t=l=>{const o=this.pipWindow;if(o)for(const d of l)Array.from(d.addedNodes).forEach(p=>{o.document.head.appendChild(p.cloneNode(!0))})};this.mutationObserver=new MutationObserver(t),this.mutationObserver.observe(document.head,e)}destroyMutationObserver(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}getWidgetSize(){return this.getElementSize(this.container.$el)}getWidgetContentSize(){return this.getElementSize(this.content)}getElementSize(e){const{width:t,height:l}=e.getBoundingClientRect();return{width:Math.floor(t),height:Math.floor(l)}}updateSize(e){this.size=e}onContentResize(){const e=this.getWidgetContentSize();w(e)(this.size)||(this.onResize(this.id,this.getWidgetSize()),this.updateSize(this.getWidgetContentSize()))}};s([r({default:"",type:String})],n.prototype,"id",2);s([r({default:!1,type:Boolean})],n.prototype,"primaryTitle",2);s([r({default:"",type:String})],n.prototype,"title",2);s([r({default:"",type:String})],n.prototype,"tooltip",2);s([r({default:!1,type:Boolean})],n.prototype,"full",2);s([r({default:!1,type:Boolean})],n.prototype,"delimeter",2);s([r({default:!1,type:Boolean})],n.prototype,"extensive",2);s([r({default:!1,type:Boolean})],n.prototype,"flat",2);s([r({default:!1,type:Boolean})],n.prototype,"loading",2);s([r({default:!1,type:Boolean})],n.prototype,"pipDisabled",2);s([r({default:()=>{},type:Function})],n.prototype,"onResize",2);s([u("container")],n.prototype,"container",2);s([u("content")],n.prototype,"content",2);n=s([_],n);var P=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("s-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"container",class:["base-widget",{delimeter:e.delimeter,full:e.full,flat:e.flat,pip:e.pipOpened}],attrs:{size:"big",primary:"",shadow:e.shadow},scopedSlots:e._u([e.hasHeader?{key:"header",fn:function(){return[t("div",{class:["base-widget-block","base-widget-header",{"with-content":e.hasContent}]},[t("div",{class:["base-widget-block","base-widget-title",{primary:e.primaryTitle}]},[e._t("title",function(){return[e.title?t("span",[e._v(e._s(e.capitalize(e.title)))]):e._e(),e.tooltip?t("s-tooltip",{attrs:{"border-radius":"mini",content:e.tooltip}},[t("s-icon",{attrs:{name:"info-16",size:"14px"}})],1):e._e()]})],2),e.$slots.filters?t("div",{staticClass:"base-widget-block base-widget-filters"},[e._t("filters")],2):e._e(),e.$slots.types?t("div",{staticClass:"base-widget-block base-widget-types"},[e._t("types")],2):e._e(),e.isPipAvailable?t("div",{staticClass:"base-widget-block base-widget-pip"},[t("s-button",{attrs:{type:"action",size:"small",alternative:"",tooltip:"Open in top window"},on:{click:e.openPip}},[t("s-icon",{attrs:{name:"finance-receive-24",size:"24"}})],1)],1):e._e()])]},proxy:!0}:null],null,!0)},[e.hasContent?t("div",{ref:"content",class:["base-widget-content",{extensive:e.extensive}]},[e._t("default")],2):e._e()])},S=[],W=z(n,P,S,!1,null,"4d84120c");const R=W.exports;export{R as default};
