var k=Object.defineProperty;var P=(r,e,t)=>e in r?k(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>P(r,typeof e!="symbol"?e+"":e,t);import{m as S,T as A,$ as v,gX as b,h5 as N,aF as g,h6 as m,f as R,g as y,i as T,h7 as x,P as I,C as K,n as L}from"./index-BHqySXo4.js";var f,D=new Uint8Array(16);function U(){if(!f&&(f=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!f))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(D)}const V=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function W(r){return typeof r=="string"&&V.test(r)}var a=[];for(var p=0;p<256;++p)a.push((p+256).toString(16).substr(1));function E(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(a[r[e+0]]+a[r[e+1]]+a[r[e+2]]+a[r[e+3]]+"-"+a[r[e+4]]+a[r[e+5]]+"-"+a[r[e+6]]+a[r[e+7]]+"-"+a[r[e+8]]+a[r[e+9]]+"-"+a[r[e+10]]+a[r[e+11]]+a[r[e+12]]+a[r[e+13]]+a[r[e+14]]+a[r[e+15]]).toLowerCase();if(!W(t))throw TypeError("Stringified UUID is invalid");return t}function _(r,e,t){r=r||{};var s=r.random||(r.rng||U)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,E(s)}var B=Object.defineProperty,M=Object.getOwnPropertyDescriptor,l=(r,e,t,s)=>{for(var i=s>1?void 0:s?M(e,t):e,o=r.length-1,n;o>=0;o--)(n=r[o])&&(i=(s?n(e,t,i):n(i))||i);return s&&i&&B(e,t,i),i};let d=class extends S(A,v.NotificationMixin,v.CameraPermissionMixin){constructor(){super(...arguments);c(this,"soraNetwork");c(this,"source");c(this,"referenceNumber");c(this,"setReferenceNumber");c(this,"accessToken");c(this,"loadingKycView",!0);c(this,"btnLoading",!1);c(this,"cameraPermission",null)}async getReferenceNumber(t){const s=this.soraNetwork??await b(),{kycService:i}=N(s),o=localStorage.getItem("PW-token");try{return(await(await fetch(t,{method:"POST",body:JSON.stringify({ReferenceID:_(),MobileNumber:"",Email:"",AddressChanged:!1,DocumentChanged:!1,IbanTypeID:null,CardTypeID:null,AdditionalData:""}),headers:{Authorization:`Bearer ${o}`}})).json()).ReferenceNumber}catch(n){console.error("[SoraCard]: Error while getting reference number",n),this.showAppNotification(this.t("card.infoMessageTryAgain")),this.$emit("confirm",g.Start),m.unload(i.sdkURL,!1)}}async updateJwtPairByInterval(){const t=async()=>{const s=localStorage.getItem("PW-refresh-token");s&&await x(s)};t(),setInterval(t,6e4*19.85)}async requestCameraAccess(){this.btnLoading=!0;try{if(!await this.checkMediaDevicesAllowance("SoraCard"))return;this.cameraPermission="granted"}catch(t){console.error("[SoraCard]: Camera error.",t)}finally{this.btnLoading=!1}this.initKyc()}get hasCameraAccess(){return this.cameraPermission==="granted"}get ISOLanguageName(){return this.language==="zh-CN"?"zh":this.language}get forbiddenByBrowser(){return this.cameraPermission==="denied"}get btnCameraText(){return this.forbiddenByBrowser?this.t("browserPermission.btnGoToSettings"):this.hasCameraAccess?this.t("continueText"):this.t("browserPermission.btnAllow")}async initKyc(){const t=this.soraNetwork??await b();this.updateJwtPairByInterval();const{kycService:s,soraProxy:i}=N(t),o=this.referenceNumber?this.referenceNumber:await this.getReferenceNumber(i.referenceNumberEndpoint);o&&this.setReferenceNumber(o),await m.unload(s.sdkURL,!1).catch(()=>{}),m.load(s.sdkURL).then(()=>{Paywings.WebKyc.create({KycCredentials:{Username:s.username,Password:s.pass,Domain:"soracard.com",env:s.env,UnifiedLoginApiKey:s.unifiedApiKey},KycSettings:{AppReferenceID:_(),Language:this.ISOLanguageName||"en",ReferenceNumber:o,ElementId:"#kyc",Logo:"",WelcomeHidden:!1,WelcomeTitle:"",DocumentCheckWindowHeight:"50vh",DocumentCheckWindowWidth:"100%",HideLoader:!0},KycUserData:{FirstName:"",MiddleName:"",LastName:"",Email:"",MobileNumber:"",Address1:"",Address2:"",Address3:"",ZipCode:"",City:"",State:"",CountryCode:""},UserCredentials:{AccessToken:localStorage.getItem("PW-token"),RefreshToken:localStorage.getItem("PW-refresh-token")}}).on("Error",n=>{console.error("[SoraCard]: Error while initiating KYC",n),this.showAppNotification(this.t("card.infoMessageTryAgain")),this.$emit("confirm",g.Start),m.unload(s.sdkURL)}).on("Success",async n=>{var w,u,C;const h=localStorage.getItem("PW-refresh-token");this.source===R.AppWallet.FearlessWallet&&h&&await((C=(u=(w=window.injectedWeb3)==null?void 0:w["fearless-wallet"])==null?void 0:u.saveSoraCardToken)==null?void 0:C.call(u,h)),this.$emit("confirm",g.KycResult),m.unload(s.sdkURL)})}).catch(n=>{console.error("[SoraCard]: Error while fetching script",n)}),setTimeout(()=>{this.loadingKycView=!1},5e3)}async mounted(){try{const{state:t}=await navigator.permissions.query({name:"camera"});if(this.cameraPermission=t,!this.hasCameraAccess)return}catch(t){console.error("[SoraCard]: Camera error.",t);return}this.initKyc()}};l([y.wallet.settings.soraNetwork],d.prototype,"soraNetwork",2);l([y.wallet.account.source],d.prototype,"source",2);l([y.soraCard.referenceNumber],d.prototype,"referenceNumber",2);l([T.soraCard.setReferenceNumber],d.prototype,"setReferenceNumber",2);l([I({default:"",type:String})],d.prototype,"accessToken",2);d=l([K],d);var O=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"sora-card sora-card-kyc-wrapper"},[e.hasCameraAccess?t("div",[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingKycView,expression:"loadingKycView"}],staticClass:"sora-card-kyc-view"},[t("s-scrollbar",[t("div",{attrs:{id:"kyc"}}),t("div",{staticStyle:{display:"none"},attrs:{id:"finish"}},[t("div",{staticClass:"alert alert-success"},[e._v("Kyc was successfull, sample integrator response displayed here")])])])],1)]):t("div",{staticClass:"camera-permission"},[t("s-icon",{staticClass:"camera-permission-icon",attrs:{name:"camera-16",size:"48"}}),t("h4",{staticClass:"camera-permission-title"},[e._v(e._s(e.t("browserPermission.title")))]),t("p",{staticClass:"camera-permission-desc"},[e._v(" "+e._s(e.t("browserPermission.desc"))+" ")]),t("div",{staticClass:"camera-permission-disclaimer"},[t("div",{staticClass:"tos__disclaimer"},[t("p",{staticClass:"tos__disclaimer-paragraph"},[e._v(" "+e._s(e.t("browserPermission.disclaimer"))+" ")]),t("div",{staticClass:"tos__disclaimer-warning icon"},[t("s-icon",{attrs:{name:"notifications-alert-triangle-24",size:"28px"}})],1)])]),t("s-button",{staticClass:"camera-permission-btn",attrs:{type:"primary",disabled:e.forbiddenByBrowser,loading:e.btnLoading},on:{click:e.requestCameraAccess}},[e._v(" "+e._s(e.btnCameraText)+" ")])],1)])},$=[],z=L(d,O,$,!1,null,null);const H=z.exports;export{H as default};
