var q=Object.defineProperty;var $=(n,e,t)=>e in n?q(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>$(n,typeof e!="symbol"?e+"":e,t);import{m as N,a5 as j,$ as L,i0 as r,i4 as k,ho as w,f as g,b as R,hD as T,Z as y,i1 as E,a4 as M,av as Z,h as W,g as p,k as z,W as B,C as H,_ as v,i2 as b,i3 as _,l as f,j as C,n as Q}from"./index-BHqySXo4.js";import{g as S}from"./util-CUc0-gKA.js";var G=Object.defineProperty,K=Object.getOwnPropertyDescriptor,o=(n,e,t,s)=>{for(var i=s>1?void 0:s?K(e,t):e,d=n.length-1,c;d>=0;d--)(c=n[d])&&(i=(s?c(e,t,i):c(i))||i);return s&&i&&G(e,t,i),i};let l=class extends N(j,L.FormattedAmountMixin,L.PaginationSearchMixin){constructor(){super(...arguments);a(this,"link","https://medium.com/@shibarimoto/kensetsu-ken-356077ebee78");a(this,"getLtvStatus",S);a(this,"getAsset");a(this,"getTax");a(this,"closedAccountVaults");a(this,"openedVaults");a(this,"collaterals");a(this,"averageCollateralPrices");a(this,"screenBreakpointClass");a(this,"windowWidth");a(this,"selectCollateral");a(this,"selectDebt");a(this,"showCreateVaultDialog",!1);a(this,"selectedTab",r.Opened);a(this,"pageAmount",6);a(this,"exploreQuery","")}onWindowWidthChange(){let t;this.windowWidth<=k.sm?t=2:this.windowWidth<=k.lg?t=4:this.windowWidth<=k.xl?t=6:t=8,t!==this.pageAmount&&(this.pageAmount=t,this.resetPage())}onTotalChange(){this.resetPage()}get showDropdown(){return[w.Mobile,w.LargeMobile].includes(this.screenBreakpointClass)}get tabs(){return Object.values(r).map(t=>({name:t,label:this.t(`kensetsu.status.${t}`)+` (${this.getVaultsLength(t)})`}))}isOpenedVault(t){return t.lockedAmount!==void 0}isClosedVault(t){return t.lockedAmount===void 0}getVaultsLength(t){switch(t){case r.Closed:return this.closedVaultsLength;case r.Liquidated:return this.liquidatedVaultsLength;case r.Opened:return this.openedVaultsLength;default:return 0}}handleTabChange(t){this.selectedTab=t,this.resetPage()}updateSearch(t){this.exploreQuery=t}handlePaginationClick(t){let s=1;switch(t){case g.PaginationButton.Prev:s=this.currentPage-1;break;case g.PaginationButton.Next:s=this.currentPage+1,s===this.lastPage&&(this.isLtrDirection=!1);break;case g.PaginationButton.First:this.isLtrDirection=!0;break;case g.PaginationButton.Last:s=this.lastPage,this.isLtrDirection=!1}this.currentPage=s}get closedVaultsData(){return this.closedAccountVaults.map(t=>{const s=this.getAsset(t.lockedAssetId),i=this.getAsset(t.debtAssetId);return{...t,lockedAsset:s,debtAsset:i}})}get closedVaults(){return this.closedVaultsData.filter(t=>t.status===r.Closed)}get liquidatedVaults(){return this.closedVaultsData.filter(t=>t.status===r.Liquidated)}get closedVaultsLength(){return this.closedVaults.length}get liquidatedVaultsLength(){return this.liquidatedVaults.length}get openedVaultsLength(){return this.openedVaults.length}get hasVaults(){return this.isLoggedIn&&!!(this.openedVaultsLength+this.closedAccountVaults.length)}get openedVaultsData(){return this.openedVaults.map(t=>{const s=this.getAsset(t.lockedAssetId),i=this.getAsset(t.debtAssetId),d=this.getTax(t.debtAssetId),c=R.api.kensetsu.serializeKey(t.lockedAssetId,t.debtAssetId),u=this.collaterals[c],F=(this.averageCollateralPrices[c]??this.Zero).mul(t.lockedAmount),A=(u==null?void 0:u.riskParams.liquidationRatioReversed)??0,x=F.mul(A).div(T),I=x.sub(x.mul(d)),V=t.debt.div(x),D=V.isFinity()?V.mul(T):null,O=D?V.mul(A):null,P=I.sub(t.debt);let m=(u==null?void 0:u.riskParams.hardCap.sub(u.debtSupply))??this.Zero;m=m.sub(m.mul(d));let h=m.lt(P)?m:P;return h=!h.isFinity()||h.isLteZero()?this.Zero:h.dp(2),{...t,lockedAsset:s,debtAsset:i,ltv:D,adjustedLtv:O,available:h}})}get vaultsData(){switch(this.selectedTab){case r.Opened:return this.openedVaultsData;case r.Closed:return this.closedVaults;case r.Liquidated:return this.liquidatedVaults;default:return this.openedVaultsData}}get filteredVaultsData(){return this.getPageItems(this.vaultsData)}get total(){return this.vaultsData.length}getVaultTitle(t,s){return s&&t?`${s.symbol} / ${t.symbol}`:""}getLockedSymbol(t){return(t==null?void 0:t.symbol)??""}getDebtSymbol(t){return(t==null?void 0:t.symbol)??""}format(t){return(t==null?void 0:t.toLocaleString(2))??y}formatFiat(t,s){return t&&s?this.getFiatAmountByFPNumber(t,s)??y:y}toCodec(t){return t.codec}getLtvText(t){return E[S(t.toNumber())]}toNumber(t){return(t==null?void 0:t.toNumber())??0}handleCreateVault(){this.showCreateVaultDialog=!0}async handleCreateSelectedVault(t,s){await this.selectCollateral(t.address),await this.selectDebt(s.address),this.showCreateVaultDialog=!0}handleOpenVaultDetails(t){M.push({name:Z.VaultDetails,params:{vault:`${t.id}`}})}};o([W.assets.assetDataByAddress],l.prototype,"getAsset",2);o([W.vault.getBorrowTax],l.prototype,"getTax",2);o([p.vault.closedAccountVaults],l.prototype,"closedAccountVaults",2);o([p.vault.accountVaults],l.prototype,"openedVaults",2);o([p.vault.collaterals],l.prototype,"collaterals",2);o([p.vault.averageCollateralPrices],l.prototype,"averageCollateralPrices",2);o([p.settings.screenBreakpointClass],l.prototype,"screenBreakpointClass",2);o([p.settings.windowWidth],l.prototype,"windowWidth",2);o([z.vault.setCollateralTokenAddress],l.prototype,"selectCollateral",2);o([z.vault.setDebtTokenAddress],l.prototype,"selectDebt",2);o([B("windowWidth")],l.prototype,"onWindowWidthChange",1);o([B("total")],l.prototype,"onTotalChange",1);l=o([H({components:{TokenLogo:v.TokenLogo,FormattedAmount:v.FormattedAmount,ExternalLink:v.ExternalLink,HistoryPagination:v.HistoryPagination,CreateVaultDialog:b(_.CreateVaultDialog),GenericPageHeader:f(C.GenericPageHeader),PairTokenLogo:f(C.PairTokenLogo),ValueStatus:f(C.ValueStatusWrapper),ResponsiveTabs:f(C.ResponsiveTabs),ExploreOverallStats:b(_.ExploreOverallStats),ExploreCollaterals:b(_.ExploreCollaterals),PositionStatus:b(_.PositionStatus)}})],l);var J=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"vaults-container"},[t("s-row",{staticClass:"vaults-header"},[t("s-col",{attrs:{xs:12,sm:6,md:6,lg:6}},[t("h2",{staticClass:"vaults-header__title s-flex"},[e._v(" Kensetsu "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.introDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{staticClass:"vaults-header__title-icon",attrs:{name:"info-16",size:"16px"}})],1)],1)]),t("s-col",{staticClass:"s-flex vaults-header__action-container",attrs:{xs:12,sm:6,md:6,lg:6}},[e.isLoggedIn?t("s-button",{staticClass:"vaults-header__action s-typography-button--large",attrs:{icon:"various-atom-24",type:"primary"},on:{click:e.handleCreateVault}},[e._v(" "+e._s(e.t("kensetsu.createVaultAction"))+" ")]):t("s-button",{staticClass:"vaults-header__action s-typography-button--large",attrs:{type:"primary"},on:{click:e.connectSoraWallet}},[e._v(" "+e._s(e.t("connectWalletText"))+" ")])],1),e.hasVaults?t("s-col",{attrs:{xs:12,sm:12,md:12,lg:12}},[t("responsive-tabs",{staticClass:"vaults-header__tabs",attrs:{"is-mobile":e.showDropdown,tabs:e.tabs,value:e.selectedTab},on:{input:e.handleTabChange}})],1):e._e()],1),e.hasVaults?[t("s-row",{staticClass:"vaults-content",attrs:{gutter:24}},e._l(e.filteredVaultsData,function(s){return t("s-col",{key:"vault_"+s.id,attrs:{xs:12,sm:6,md:6,lg:4,xl:3}},[t("s-card",{staticClass:"vault",attrs:{"border-radius":"mini",size:"medium",primary:"",clickable:""},on:{click:function(i){return e.handleOpenVaultDetails(s)}}},[t("div",{staticClass:"vault-title s-flex"},[t("pair-token-logo",{staticClass:"vault-title__icon",attrs:{"first-token":s.debtAsset,"second-token":s.lockedAsset,size:"medium"}}),t("div",{staticClass:"vault-title__container s-flex-column"},[t("h4",{staticClass:"vault-title__name"},[e._v(e._s(e.getVaultTitle(s.lockedAsset,s.debtAsset)))]),t("position-status",{attrs:{status:e.selectedTab}})],1),t("s-button",{attrs:{type:"action",size:"small",alternative:"",tooltip:e.t("assets.details")}},[t("s-icon",{attrs:{name:"arrows-chevron-right-rounded-24",size:"24"}})],1)],1),t("s-divider",{staticClass:"vault-title__divider"}),e.isOpenedVault(s)?[t("div",{staticClass:"vault-details s-flex"},[t("div",{staticClass:"vault-details__item s-flex-column"},[t("p",{staticClass:"p4 vault__label"},[e._v(" "+e._s(e.t("kensetsu.yourCollateral"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.yourCollateralDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"11px"}})],1)],1),s.lockedAsset?[t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.format(s.lockedAmount),"asset-symbol":e.getLockedSymbol(s.lockedAsset)}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.formatFiat(s.lockedAmount,s.lockedAsset)}})]:e._e()],2),t("div",{staticClass:"vault-details__item s-flex-column"},[t("p",{staticClass:"p4 vault__label"},[e._v(" "+e._s(e.t("kensetsu.yourDebt"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.yourDebtDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"11px"}})],1)],1),s.debtAsset?[t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.format(s.debt),"asset-symbol":e.getDebtSymbol(s.debtAsset)}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.formatFiat(s.debt,s.debtAsset)}})]:e._e()],2),t("div",{staticClass:"vault-details__item s-flex-column"},[t("p",{staticClass:"p4 vault__label"},[e._v(" "+e._s(e.t("kensetsu.availableToBorrow"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.availableToBorrowDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"11px"}})],1)],1),s.debtAsset?[t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.format(s.available),"asset-symbol":e.getDebtSymbol(s.debtAsset)}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.formatFiat(s.available,s.debtAsset)}})]:e._e()],2)]),t("s-divider",{staticClass:"vault__divider"}),t("div",{staticClass:"vault__ltv s-flex"},[t("p",{staticClass:"p4 vault__label"},[e._v(" "+e._s(e.TranslationConsts.LTV)+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.ltvDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"11px"}})],1)],1),t("span",{staticClass:"vault__ltv-value s-flex"},[s.ltv&&s.adjustedLtv?[e._v(" "+e._s(e.format(s.adjustedLtv))+"% "),t("value-status",{staticClass:"vault__ltv-badge",attrs:{badge:"",value:e.toNumber(s.ltv),"get-status":e.getLtvStatus}},[e._v(" "+e._s(e.getLtvText(s.ltv))+" ")])]:[e._v("n/a")]],2)])]:t("div",{staticClass:"vault-details s-flex"},[t("div",{staticClass:"vault-details__item centered s-flex-column"},[t("p",{staticClass:"p4 vault__label"},[e._v(" "+e._s(e.t("kensetsu.totalCollateralReturned"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.totalCollateralReturnedDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"11px"}})],1)],1),s.lockedAsset&&s.debtAsset?[t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.format(s.returned),"asset-symbol":e.getLockedSymbol(s.lockedAsset)}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.formatFiat(s.returned,s.lockedAsset)}}),t("s-button",{staticClass:"vault-details__action",attrs:{size:"small"},on:{click:function(i){return i.stopPropagation(),e.handleCreateSelectedVault(s.lockedAsset,s.debtAsset)}}},[e._v(" "+e._s(e.t("kensetsu.reopen"))+" ")])]:e._e()],2)])],2)],1)}),1),t("history-pagination",{staticClass:"vaults-pagination",attrs:{"current-page":e.currentPage,"page-amount":e.pageAmount,loading:e.loading,total:e.total,"last-page":e.lastPage},on:{"pagination-click":e.handlePaginationClick}}),t("s-divider",{staticClass:"vaults-divider"})]:e._e(),t("explore-overall-stats"),t("explore-collaterals",{staticClass:"vaults-stats",attrs:{"explore-query":e.exploreQuery},on:{"update-search":e.updateSearch,open:e.handleCreateSelectedVault}}),t("div",{staticClass:"vaults-disclaimer s-flex"},[t("div",{staticClass:"disclaimer s-flex-column"},[t("div",{staticClass:"disclaimer__title s-flex"},[t("div",{staticClass:"disclaimer__badge"},[t("s-icon",{staticClass:"disclaimer__icon",attrs:{name:"notifications-alert-triangle-24",size:"14"}})],1),t("h4",[e._v(e._s(e.t("disclaimerTitle")))])]),t("p",{staticClass:"disclaimer__description p4"},[e._v(e._s(e.t("kensetsu.disclaimerDescription")))]),t("external-link",{staticClass:"disclaimer__link p4",attrs:{title:e.t("kensetsu.readMore"),href:e.link}})],1)]),t("create-vault-dialog",{attrs:{visible:e.showCreateVaultDialog},on:{"update:visible":function(s){e.showCreateVaultDialog=s}}})],2)},U=[],X=Q(l,J,U,!1,null,"f1428727");const lt=X.exports;export{lt as default};
