var x=Object.defineProperty;var F=(n,t,e)=>t in n?x(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var l=(n,t,e)=>F(n,typeof t!="symbol"?t+"":t,e);import{m as V,$ as g,X as v,b as f,hD as i,Z as h,Y as C,ak as B,ai as y,i1 as S,g as p,h as c,k as T,W as P,C as D,_ as k,l as d,j as b,R as _,n as A}from"./index-BHqySXo4.js";import{g as w}from"./util-CUc0-gKA.js";var I=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,s=(n,t,e,a)=>{for(var o=a>1?void 0:a?Z(t,e):t,u=n.length-1,m;u>=0;u--)(m=n[u])&&(o=(a?m(t,e,o):m(o))||o);return a&&o&&I(t,e,o),o};let r=class extends V(g.TransactionMixin,g.DialogMixin,g.FormattedAmountMixin){constructor(){super(...arguments);l(this,"xorSymbol",v.symbol);l(this,"getLtvStatus",w);l(this,"collateralInput");l(this,"percentFormat");l(this,"networkFees");l(this,"slippageTolerance");l(this,"collaterals");l(this,"getTax");l(this,"averageCollateralPrice");l(this,"accountXor");l(this,"isLoggedIn");l(this,"debtToken");l(this,"collateralToken");l(this,"setCollateralAddress");l(this,"setDebtAddress");l(this,"collateralValue","");l(this,"borrowValue","");l(this,"showSelectTokenDialog",!1);l(this,"isCollateralSelected",!0)}async handleDialogVisibility(e){var a;await this.$nextTick(),this.collateralValue="",this.borrowValue="",e||this.setCollateralAddress(),this.showSelectTokenDialog=!1,(a=this.collateralInput)==null||a.focus()}get collateralId(){return this.collateralToken&&this.debtToken?f.api.kensetsu.serializeKey(this.collateralToken.address,this.debtToken.address):""}get collateral(){return this.collateralId?this.collaterals[this.collateralId]:null}get maxLtv(){return this.collateral?this.collateral.riskParams.liquidationRatioReversed:i}get xorBalance(){var e,a;return this.getFPNumberFromCodec(((a=(e=this.accountXor)==null?void 0:e.balance)==null?void 0:a.transferable)??h)}get networkFee(){return this.networkFees[f.Operation.CreateVault]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isLtvGtHundred(){var e;return((e=this.ltv)==null?void 0:e.gt(this.Hundred))??!1}get minDeposit(){var e;return((e=this.collateral)==null?void 0:e.riskParams.minDeposit)??this.Zero}get isCollateralZero(){return C(this.collateralValue)}get isBorrowZero(){return C(this.borrowValue)}get collateralValueFp(){var e;return this.isCollateralZero?this.Zero:this.getFPNumber(this.collateralValue,(e=this.collateralToken)==null?void 0:e.decimals)}get borrowValueFp(){var e;return this.isBorrowZero?this.Zero:this.getFPNumber(this.borrowValue,(e=this.debtToken)==null?void 0:e.decimals)}get isInsufficientBalance(){return this.collateralToken?B(this.collateralToken,this.collateralValue,this.networkFee):!0}get isLessThanMinDeposit(){return this.collateralValue?this.collateralValueFp.lt(this.minDeposit):!0}get isIncorrectCollateral(){return this.collateralToken&&this.debtToken?!this.collateral:!1}get disabled(){return this.loading||this.isIncorrectCollateral||this.isInsufficientXorForFee||this.isLessThanMinDeposit||this.isInsufficientBalance||!this.ltv||this.isBorrowZero||this.ltv.gt(this.Hundred)}get collateralAssetBalance(){return y(this.collateralToken)}get availableCollateralBalanceFp(){var a;let e=this.getFPNumberFromCodec(this.collateralAssetBalance);return((a=this.collateralToken)==null?void 0:a.address)===v.address&&(e=e.sub(this.fpNetworkFee),e.isLtZero()&&(e=this.Zero)),e}get isMaxCollateralAvailable(){return this.shouldBalanceBeHidden?!0:this.availableCollateralBalanceFp.isLteZero()?!1:this.isCollateralZero?!0:!this.collateralValueFp.isEqualTo(this.availableCollateralBalanceFp)}get collateralValuePercent(){if(!this.collateralValue)return 0;const e=this.collateralValueFp.div(this.availableCollateralBalanceFp).mul(i).toNumber(0);return e>i?i:e}get selectTokenFilter(){const e=Object.values(this.collaterals).map(a=>this.isCollateralSelected?a.lockedAssetId:a.debtAssetId);return a=>e.includes(a==null?void 0:a.address)}get isMaxBorrowAvailable(){return this.isCollateralZero||this.availableCollateralBalanceFp.lt(this.minDeposit)?!1:this.shouldBalanceBeHidden||this.isBorrowZero?!0:!this.maxBorrowPerCollateralValueOrAvailable.isFinity()||this.maxBorrowPerCollateralValueOrAvailable.isLteZero()?!1:!this.borrowValueFp.isEqualTo(this.maxBorrowPerCollateralValueOrAvailable)}get isBorrowSliderAvailable(){return this.availableCollateralBalanceFp.gte(this.minDeposit)}get debtSymbol(){var e;return((e=this.debtToken)==null?void 0:e.symbol)??""}get collateralSymbol(){var e;return((e=this.collateralToken)==null?void 0:e.symbol)??""}get maxBorrowPerMaxCollateralNumber(){return this.maxBorrowPerMaxCollateralFp.toNumber()}get borrowTax(){return this.debtToken?this.getTax(this.debtToken.address):0}get kusdAvailable(){var o;const e=((o=this.collateral)==null?void 0:o.riskParams.hardCap.sub(this.collateral.debtSupply))??this.Zero,a=e.sub(e.mul(this.borrowTax??0));return a.isLtZero()?this.Zero:a}get maxBorrowPerMaxCollateralFp(){var u;if(!this.averageCollateralPrice||!this.availableCollateralBalanceFp.isFinity()||this.availableCollateralBalanceFp.isZero())return this.Zero;const a=this.averageCollateralPrice.mul(this.availableCollateralBalanceFp).mul(((u=this.collateral)==null?void 0:u.riskParams.liquidationRatioReversed)??0).div(i),o=a.sub(a.mul(this.borrowTax));return o.gt(this.kusdAvailable)?this.kusdAvailable:o}get formattedMinDeposit(){return this.minDeposit.toLocaleString()??h}get minDepositFiat(){return this.collateralToken?this.getFiatAmountByFPNumber(this.minDeposit,this.collateralToken):null}get borrowTaxPercent(){var e,a;return((a=(e=this.percentFormat)==null?void 0:e.format)==null?void 0:a.call(e,this.borrowTax))??`${this.borrowTax*i}%`}get formattedBorrowTax(){return this.borrowValueFp.mul(this.borrowTax??0).toLocaleString()}get maxBorrowCodec(){return this.availableCollateralBalanceFp.lt(this.minDeposit)?h:this.maxBorrowPerMaxCollateralFp.toCodecString()}get maxBorrowPerCollateralValue(){var o;if(!this.averageCollateralPrice||this.isCollateralZero)return this.Zero;const a=this.averageCollateralPrice.mul(this.collateralValue).mul(((o=this.collateral)==null?void 0:o.riskParams.liquidationRatioReversed)??0).div(i);return a.sub(a.mul(this.borrowTax))}get maxBorrowPerCollateralValueOrAvailable(){return this.maxBorrowPerCollateralValue.gt(this.kusdAvailable)?this.kusdAvailable:this.maxBorrowPerCollateralValue}get ltvCoeff(){return this.isCollateralZero?null:this.isBorrowZero?this.Zero:this.borrowValueFp.div(this.maxBorrowPerCollateralValue)}get ltv(){var e;return(e=this.ltvCoeff)!=null&&e.isFinity()?this.ltvCoeff.mul(i):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):h}get ltvText(){return S[w(this.ltvNumber)]}get formattedStabilityFee(){var e;return(((e=this.collateral)==null?void 0:e.riskParams.stabilityFeeAnnual)??this.Zero).toLocaleString()}get borrowValuePercent(){if(!this.borrowValue)return 0;const e=this.borrowValueFp.div(this.maxBorrowPerCollateralValueOrAvailable).mul(i).toNumber(0);return e>i?i:e}handleCollateralPercentChange(e){this.collateralValue=this.availableCollateralBalanceFp.mul(e/i).toString()}handleMaxCollateralValue(){this.collateralValue=this.availableCollateralBalanceFp.toString()}handleMaxBorrowValue(){this.borrowValue=this.maxBorrowPerCollateralValueOrAvailable.toString()}handleBorrowPercentChange(e){this.borrowValue=this.maxBorrowPerCollateralValueOrAvailable.mul(e/i).toString()}openSelectTokenDialog(e=!0){this.isCollateralSelected=e,this.showSelectTokenDialog=!0}handleSelectToken(e){this.isCollateralSelected?this.setCollateralAddress(e==null?void 0:e.address):this.setDebtAddress(e==null?void 0:e.address),this.collateralValue="",this.borrowValue=""}get errorMessage(){let e="";return this.isInsufficientXorForFee?e=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isIncorrectCollateral?e=this.t("kensetsu.error.incorrectCollateral"):this.ltv?this.isBorrowZero?e=this.t("kensetsu.error.enterBorrow"):this.isLessThanMinDeposit?e=this.t("kensetsu.error.insufficientCollateral"):this.isInsufficientBalance?e=this.t("insufficientBalanceText",{tokenSymbol:this.collateralSymbol}):this.isLtvGtHundred&&(e=this.t("kensetsu.error.insufficientCollateral")):e=this.t("kensetsu.error.enterCollateral"),e}async handleCreate(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{const e=this.collateralToken,a=this.debtToken;if(!(e&&a))return;await this.withNotifications(async()=>{await f.api.kensetsu.createVault(e,a,this.collateralValue,this.borrowValue,this.slippageTolerance)})}catch(e){console.error(e)}this.isVisible=!1}};s([_("collateralInput")],r.prototype,"collateralInput",2);s([p.settings.percentFormat],r.prototype,"percentFormat",2);s([p.wallet.settings.networkFees],r.prototype,"networkFees",2);s([p.settings.slippageTolerance],r.prototype,"slippageTolerance",2);s([p.vault.collaterals],r.prototype,"collaterals",2);s([c.vault.getBorrowTax],r.prototype,"getTax",2);s([c.vault.averageCollateralPrice],r.prototype,"averageCollateralPrice",2);s([c.assets.xor],r.prototype,"accountXor",2);s([c.wallet.account.isLoggedIn],r.prototype,"isLoggedIn",2);s([c.vault.debtToken],r.prototype,"debtToken",2);s([c.vault.collateralToken],r.prototype,"collateralToken",2);s([T.vault.setCollateralTokenAddress],r.prototype,"setCollateralAddress",2);s([T.vault.setDebtTokenAddress],r.prototype,"setDebtAddress",2);s([P("visible")],r.prototype,"handleDialogVisibility",1);r=s([D({components:{DialogBase:k.DialogBase,InfoLine:k.InfoLine,TokenInput:d(b.TokenInput),SelectToken:d(b.SelectToken),ValueStatus:d(b.ValueStatusWrapper),SlippageTolerance:d(b.SlippageTolerance)}})],r);var L=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",[e("dialog-base",{attrs:{title:t.t("kensetsu.createVault"),visible:t.isVisible,tooltip:t.t("kensetsu.createVaultDescription")},on:{"update:visible":function(a){t.isVisible=a}}},[e("div",{staticClass:"vault-create"},[e("token-input",{ref:"collateralInput",staticClass:"vault-create__collateral-input vault-create__token-input",attrs:{"with-slider":"","is-fiat-editable":"","is-select-available":"",title:t.t("kensetsu.depositCollateral"),"is-max-available":t.isMaxCollateralAvailable,token:t.collateralToken,balance:t.collateralAssetBalance,"slider-value":t.collateralValuePercent,disabled:t.loading},on:{max:t.handleMaxCollateralValue,slide:t.handleCollateralPercentChange,select:function(a){return t.openSelectTokenDialog(!0)}},model:{value:t.collateralValue,callback:function(a){t.collateralValue=a},expression:"collateralValue"}}),e("token-input",{ref:"debtInput",staticClass:"vault-create__debt-input vault-create__token-input",attrs:{"is-fiat-editable":"","is-select-available":"","with-slider":t.isBorrowSliderAvailable,title:t.t("kensetsu.borrowDebt"),"balance-text":t.t("kensetsu.available"),balance:t.maxBorrowCodec,"is-max-available":t.isMaxBorrowAvailable,token:t.debtToken,"slider-value":t.borrowValuePercent,disabled:t.loading,max:t.maxBorrowPerMaxCollateralNumber},on:{max:t.handleMaxBorrowValue,slide:t.handleBorrowPercentChange,select:function(a){return t.openSelectTokenDialog(!1)}},model:{value:t.borrowValue,callback:function(a){t.borrowValue=a},expression:"borrowValue"}}),e("slippage-tolerance",{staticClass:"slippage-tolerance-settings vault-create__slippage"}),e("info-line",{attrs:{label:t.t("kensetsu.ltv"),"label-tooltip":t.t("kensetsu.ltvDescription"),value:t.formattedLtv,"asset-symbol":"%","is-formatted":""}},[t.ltv?e("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:t.ltvNumber,"get-status":t.getLtvStatus}},[t._v(" "+t._s(t.ltvText)+" ")]):t._e()],1),e("s-button",{staticClass:"s-typography-button--large action-button vault-create__button",attrs:{type:"primary",disabled:t.disabled},on:{click:t.handleCreate}},[t.disabled?[t._v(t._s(t.errorMessage))]:[t._v(t._s(t.t("kensetsu.createVaultAction")))]],2),e("info-line",{attrs:{label:t.t("kensetsu.minDepositCollateral"),"label-tooltip":t.t("kensetsu.minDepositCollateralDescription"),value:t.formattedMinDeposit,"asset-symbol":t.collateralSymbol,"fiat-value":t.minDepositFiat,"is-formatted":""}}),e("info-line",{attrs:{label:t.t("kensetsu.interest"),"label-tooltip":t.t("kensetsu.interestDescription"),value:t.formattedStabilityFee,"asset-symbol":"%","is-formatted":""}}),e("info-line",{attrs:{label:t.t("kensetsu.borrowTax"),"label-tooltip":t.t("kensetsu.borrowTaxDescription",{value:t.borrowTaxPercent}),value:t.formattedBorrowTax,"asset-symbol":t.debtSymbol,"is-formatted":""}}),e("info-line",{attrs:{label:t.t("networkFeeText"),"label-tooltip":t.t("networkFeeTooltipText"),value:t.networkFeeFormatted,"asset-symbol":t.xorSymbol,"fiat-value":t.getFiatAmountByCodecString(t.networkFee),"is-formatted":""}})],1)]),e("select-token",{attrs:{"disabled-custom":"",visible:t.showSelectTokenDialog,connected:t.isLoggedIn,filter:t.selectTokenFilter,asset:t.collateralToken},on:{"update:visible":function(a){t.showSelectTokenDialog=a},select:t.handleSelectToken}})],1)},M=[],N=A(r,L,M,!1,null,"1e50af5d");const H=N.exports;export{H as default};
