var C=Object.defineProperty;var T=(i,t,e)=>t in i?C(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var s=(i,t,e)=>T(i,typeof t!="symbol"?t+"":t,e);import{m as I,$ as x,f as m,a9 as A,a8 as P,aa as u,g as v,h as _,k as w,C as k,_ as h,l as g,j as f,n as M}from"./index-BHqySXo4.js";import{M as V}from"./BridgeInitMixin-Btb4O7ue.js";import B from"./Moonpay-D571D53h.js";import"./BridgeHistoryMixin-G3tlRVUy.js";import"./WalletConnectMixin-CatA0t7p.js";import"./consts-Bf-kzBRE.js";var H=Object.defineProperty,N=Object.getOwnPropertyDescriptor,c=(i,t,e,a)=>{for(var r=a>1?void 0:a?N(t,e):t,l=i.length-1,d;l>=0;l--)(d=i[l])&&(r=(a?d(t,e,r):d(r))||r);return a&&r&&H(t,e,r),r};const y="history",S="details";let n=class extends I(x.PaginationSearchMixin,V){constructor(){super(...arguments);s(this,"FontSizeRate",m.FontSizeRate);s(this,"transactions");s(this,"currencies");s(this,"isValidNetwork");s(this,"libraryTheme");s(this,"getTransactions");s(this,"getCurrencies");s(this,"pageAmount",5);s(this,"currentView",y);s(this,"selectedItem",{})}created(){this.withApi(async()=>{this.initMoonpayApi(),await this.prepareEvmNetwork(),await Promise.all([this.getTransactions(),this.getCurrencies()])})}get currenciesById(){return this.currencies.reduce((e,a)=>({...e,[a.id]:a}),{})}get emptyHistory(){return!this.transactions.length}get total(){return this.transactions.length}get historyItems(){return this.getPageItems(this.transactions)}get formattedItems(){const{currenciesById:e,historyItems:a,formatDate:r}=this,l=o=>{var p;return(((p=e[o])==null?void 0:p.code)??"").toUpperCase()},d=o=>Number.isFinite(o)?String(o):o,b=o=>o===u.Completed?"basic-check-mark-24":o===u.Failed?"basic-clear-X-24":"basic-more-horizontal-24";return a.map(o=>({...o,formatted:{fiat:l(o.baseCurrencyId),fiatAmount:d(o.baseCurrencyAmount),crypto:l(o.currencyId),cryptoAmount:d(o.quoteCurrencyAmount),date:r(new Date(o.updatedAt).getTime()),icon:b(o.status)}}))}get detailsWidgetUrl(){if(!this.selectedItem.id)return"";const e=A({colorCode:P("--s-color-theme-accent"),language:this.language,transactionId:this.selectedItem.id});return`${this.selectedItem.returnUrl}?${e}`}get bridgeTxToSora(){if(this.selectedItem.id)return this.getBridgeHistoryItemByMoonpayId(this.selectedItem.id)}get isCompletedTransaction(){var e;return((e=this.selectedItem)==null?void 0:e.status)===u.Completed}get externalAccountIsMoonpayRecipient(){var e,a,r;return((r=(a=(e=this.selectedItem)==null?void 0:e.walletAddress)==null?void 0:a.toLowerCase)==null?void 0:r.call(a))===this.evmAddress.toLowerCase()}get actionButtonType(){return this.bridgeTxToSora?"secondary":"primary"}get actionButtonDisabled(){return!this.externalAccountIsMoonpayRecipient}get actionButtonText(){return this.evmAddress?this.bridgeTxToSora?this.t("moonpay.buttons.view"):this.externalAccountIsMoonpayRecipient?this.isValidNetwork?this.t("moonpay.buttons.transfer"):this.t("changeNetworkText"):this.t("changeAccountText"):this.t("connectWalletText")}get isHistoryView(){return this.currentView===y}changeView(e){this.currentView=e}async handlePaginationClick(e){let a=1;switch(e){case m.PaginationButton.Prev:a=this.currentPage-1;break;case m.PaginationButton.Next:a=this.currentPage+1;break;case m.PaginationButton.Last:a=this.lastPage;break}this.currentPage=a}handleBack(){this.loading=!1,this.changeView(y)}async navigateToDetails(e){try{this.selectedItem=e,this.changeView(S)}catch(a){console.error(a)}}async handleTransaction(){var e;this.selectedItem.id&&(this.isValidNetwork?(e=this.bridgeTxToSora)!=null&&e.id?(await this.prepareEvmNetwork(),await this.showHistory(this.bridgeTxToSora.id)):await this.prepareMoonpayTxForBridgeTransfer(this.selectedItem):this.changeEvmNetworkProvided())}};c([v.moonpay.transactions],n.prototype,"transactions",2);c([v.moonpay.currencies],n.prototype,"currencies",2);c([_.web3.isValidNetwork],n.prototype,"isValidNetwork",2);c([_.libraryTheme],n.prototype,"libraryTheme",2);c([w.moonpay.getTransactions],n.prototype,"getTransactions",2);c([w.moonpay.getCurrencies],n.prototype,"getCurrencies",2);n=c([k({components:{MoonpayLogo:B,FormattedAmount:h.FormattedAmount,GenericPageHeader:g(f.GenericPageHeader),IFrameWidget:g(f.IFrameWidget),HistoryPagination:h.HistoryPagination}})],n);var F=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"moonpay-history"},[e("moonpay-logo",{attrs:{theme:t.libraryTheme}}),t.isHistoryView?[e("div",{staticClass:"moonpay-history-title"},[t._v(t._s(t.t("moonpay.history.title")))]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],class:["moonpay-history-list",{empty:t.emptyHistory}]},[t._l(t.formattedItems,function(a){return e("div",{directives:[{name:"button",rawName:"v-button"}],key:a.id,staticClass:"moonpay-history-item",attrs:{tabindex:"0"},on:{click:function(r){return t.navigateToDetails(a)}}},[e("div",{staticClass:"moonpay-history-item-data"},[e("div",{staticClass:"moonpay-history-item__date"},[t._v(t._s(a.formatted.date))]),e("div",{staticClass:"moonpay-history-item__amount"},[a.formatted.cryptoAmount?[e("formatted-amount",{staticClass:"moonpay-history-item-amount",attrs:{"value-can-be-hidden":"",value:a.formatted.cryptoAmount,"font-size-rate":t.FontSizeRate.MEDIUM,"asset-symbol":a.formatted.crypto}}),e("i",{staticClass:"network-icon network-icon--ethereum"}),t._v("  "),e("span",[t._v(t._s(t.t("forText")))]),t._v("   ")]:t._e(),e("formatted-amount",{staticClass:"moonpay-history-item-amount",attrs:{"value-can-be-hidden":"",value:a.formatted.fiatAmount,"font-size-rate":t.FontSizeRate.MEDIUM,"asset-symbol":a.formatted.fiat}})],2),e("div",{staticClass:"moonpay-history-item__wallet-address"},[t._v(" "+t._s(a.walletAddress)+" ")])]),e("s-icon",{class:["moonpay-history-item-icon",a.status],attrs:{name:a.formatted.icon,size:"14"}})],1)}),t.emptyHistory?e("span",[t._v(t._s(t.t("moonpay.history.empty")))]):t._e()],2),t.emptyHistory?t._e():e("history-pagination",{staticClass:"moonpay-history-pagination",attrs:{"current-page":t.currentPage,"page-amount":t.pageAmount,total:t.total,loading:t.loading,"last-page":t.lastPage},on:{"pagination-click":t.handlePaginationClick}})]:[e("i-frame-widget",{attrs:{src:t.detailsWidgetUrl}}),t.isCompletedTransaction?e("s-button",{staticClass:"moonpay-details-button s-typography-button--big",attrs:{type:t.actionButtonType,disabled:t.actionButtonDisabled,loading:t.loading},on:{click:t.handleTransaction}},[t._v(" "+t._s(t.actionButtonText)+" ")]):t._e()]],2)},D=[],z=M(n,F,D,!1,null,"4cf6c645");const q=z.exports;export{q as default};
