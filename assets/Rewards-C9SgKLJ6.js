var x=Object.defineProperty;var f=(l,e,t)=>e in l?x(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var n=(l,e,t)=>f(l,typeof e!="symbol"?e+"":e,t);import{m as y,$ as g,hu as R,hv as A,gs as C,gw as p,b as v,aj as _,Q as S,g as d,h as c,i as I,k as m,W as T,C as E,l as h,j as u,_ as b,n as F}from"./index-BHqySXo4.js";import{S as P}from"./SubscriptionsMixin-D6BOGEEX.js";import{W as k}from"./WalletConnectMixin-CatA0t7p.js";var M=Object.defineProperty,L=Object.getOwnPropertyDescriptor,a=(l,e,t,s)=>{for(var i=s>1?void 0:s?L(e,t):e,o=l.length-1,w;o>=0;o--)(w=l[o])&&(i=(s?w(e,t,i):w(i))||i);return s&&i&&M(e,t,i),i};let r=class extends y(P,g.FormattedAmountMixin,k,g.TransactionMixin,g.NotificationMixin){constructor(){super(...arguments);n(this,"feeFetching");n(this,"rewardsFetching");n(this,"rewardsClaiming");n(this,"transactionError");n(this,"transactionStep");n(this,"receivedRewards");n(this,"fee");n(this,"vestedRewards");n(this,"crowdloanRewards");n(this,"internalRewards");n(this,"externalRewards");n(this,"selectedVestedRewards");n(this,"selectedInternalRewards");n(this,"selectedExternalRewards");n(this,"selectedCrowdloanRewards");n(this,"xor");n(this,"externalRewardsAvailable");n(this,"rewardsAvailable");n(this,"internalRewardsAvailable");n(this,"vestedRewardsAvailable");n(this,"rewardsByAssetsList");n(this,"externalRewardsSelected");n(this,"libraryTheme");n(this,"reset");n(this,"setSelectedRewards");n(this,"getExternalRewards");n(this,"claimRewards");n(this,"subscribeOnRewards");n(this,"unsubscribeFromRewards")}checkRewardsAfterAccountChange(){this.checkExternalRewards()}async created(){this.setStartSubscriptions([this.subscribeOnRewards]),this.setResetSubscriptions([this.unsubscribeFromRewards])}mounted(){this.withApi(async()=>{await this.checkExternalRewards()})}beforeDestroy(){this.disconnectExternalNetwork()}destroyed(){this.reset()}get transactionStepsCount(){return this.externalRewardsSelected?2:1}get rewardsReceived(){return this.receivedRewards.length!==0}get rewardsAmountHeaderItems(){return this.rewardsReceived?this.receivedRewards:this.rewardsByAssetsList}get rewardTokens(){return this.rewardsAmountHeaderItems.map(t=>t.asset)}get rewardTokenSymbols(){return this.rewardTokens.map(t=>t.symbol)}get gradientSymbol(){return this.rewardTokenSymbols.length===1?this.rewardTokenSymbols[0]:""}get externalRewardsGroupItems(){return[{type:[R.External,this.t("rewards.groups.external")],limit:A(this.externalRewards),rewards:this.externalRewards}]}get vestedRewadsGroupItems(){var i,o,w;const t=((i=this.vestedRewards)==null?void 0:i.rewards)??[],s=C.get(p.PSWAP);return[{type:[R.Strategic,this.t("rewards.groups.strategic")],title:this.t("rewards.claimableAmountDoneVesting"),limit:[{amount:v.FPNumber.fromCodecValue(((o=this.vestedRewards)==null?void 0:o.limit)??0,s.decimals).toCodecString(),asset:s}],total:{amount:v.FPNumber.fromCodecValue(((w=this.vestedRewards)==null?void 0:w.total)??0,s.decimals).toLocaleString(),asset:s},rewards:t}]}get crowdloanRewardsGroupItems(){return Object.entries(this.crowdloanRewards).map(([t,s])=>({type:[R.Crowdloan,t],title:t,limit:s.map(i=>({...i,total:{amount:v.FPNumber.fromCodecValue(i.total??0,i.asset.decimals).toLocaleString(),asset:i.asset}}))}))}get selectedInternalRewardsModel(){return this.internalRewardsAvailable&&this.selectedInternalRewards!==null}set selectedInternalRewardsModel(t){const s=t?this.internalRewards:null;this.setSelectedRewards({selectedInternal:s})}get selectedExternalRewardsModel(){return this.selectedExternalRewards.length!==0}set selectedExternalRewardsModel(t){const s=t?this.externalRewards:[];this.setSelectedRewards({selectedExternal:s})}get selectedVestedRewardsModel(){return this.vestedRewardsAvailable&&this.selectedVestedRewards!==null}set selectedVestedRewardsModel(t){const s=t?this.vestedRewards:null;this.setSelectedRewards({selectedVested:s})}get selectedCrowdloanRewardsModel(){return Object.keys(this.selectedCrowdloanRewards)}set selectedCrowdloanRewardsModel(t){const s=t.reduce((i,o)=>(i[o]=this.crowdloanRewards[o],i),{});this.setSelectedRewards({selectedCrowdloan:s})}get isInsufficientBalance(){return _(this.xor,this.fee)}get feeInfo(){return{label:this.t("networkFeeText"),labelTooltip:this.t("networkFeeTooltipText"),value:this.formatCodecNumber(this.fee),assetSymbol:p.XOR}}get claimingInProgressOrFinished(){return this.rewardsClaiming||this.transactionError||this.rewardsReceived}get claimingStatusMessage(){return this.rewardsReceived?this.t("rewards.claiming.success"):this.t("rewards.claiming.pending")}get transactionStatusMessage(){if(this.rewardsReceived)return this.t("rewards.transactions.success");const t=this.tOrdinal(this.transactionStep),s=this.transactionError?"rewards.transactions.failed":"rewards.transactions.confimation";return this.t(s,{order:t,total:this.transactionStepsCount})}get hintText(){if(!this.isLoggedIn)return this.t("rewards.hint.connectAccounts");if(this.rewardsAvailable){const t=this.rewardTokenSymbols.join(` ${this.t("rewards.andText")} `),s=this.tc("transactionText",this.transactionStepsCount),i=this.transactionStepsCount>1?this.transactionStepsCount:"",o=this.transactionStepsCount>1?this.t("rewards.signing.accounts"):this.t("rewards.signing.extension");return this.t("rewards.hint.howToClaimRewards",{symbols:t,transactions:s,count:i,destination:o})}return""}get externalRewardsHintText(){return this.evmAddress?this.externalRewardsAvailable?"":this.t("rewards.hint.connectAnotherAccount"):this.t("rewards.hint.connectExternalAccount")}get actionButtonText(){return this.actionButtonLoading?"":this.isLoggedIn?this.transactionError?this.t("retryText"):this.isInsufficientBalance?this.t("insufficientBalanceText",{tokenSymbol:p.XOR}):this.rewardsClaiming?this.externalRewardsAvailable&&this.transactionStep===1?this.t("rewards.action.pendingExternal"):!this.externalRewardsAvailable||this.transactionStep===2?this.t("rewards.action.pendingInternal"):"":this.t("rewards.action.signAndClaim"):this.t("connectWalletText")}get actionButtonLoading(){return this.rewardsFetching||this.feeFetching}get actionButtonDisabled(){return this.rewardsClaiming||this.isLoggedIn&&(!this.rewardsAvailable||this.isInsufficientBalance)}get changeWalletEvm(){return!!this.evmProvider}async handleAction(){if(!this.isLoggedIn)return this.connectSoraWallet();if(this.rewardsAvailable)return await this.claimRewardsProcess()}async checkExternalRewards(t=!1){this.isLoggedIn&&await this.getRewardsProcess(t)}async getRewardsProcess(t=!1){await this.getExternalRewards(this.evmAddress),!this.rewardsAvailable&&t&&this.showAppNotification(this.t("rewards.notification.empty"))}async claimRewardsProcess(){const t=this.soraAddress,s=this.evmAddress;t&&(s&&this.externalRewardsSelected&&!await S.checkAccountIsConnected(s)||await this.withNotifications(async()=>{await this.claimRewards({internalAddress:t,externalAddress:s})}))}};a([d.rewards.feeFetching],r.prototype,"feeFetching",2);a([d.rewards.rewardsFetching],r.prototype,"rewardsFetching",2);a([d.rewards.rewardsClaiming],r.prototype,"rewardsClaiming",2);a([d.rewards.transactionError],r.prototype,"transactionError",2);a([d.rewards.transactionStep],r.prototype,"transactionStep",2);a([d.rewards.receivedRewards],r.prototype,"receivedRewards",2);a([d.rewards.fee],r.prototype,"fee",2);a([d.rewards.vestedRewards],r.prototype,"vestedRewards",2);a([d.rewards.crowdloanRewards],r.prototype,"crowdloanRewards",2);a([d.rewards.internalRewards],r.prototype,"internalRewards",2);a([d.rewards.externalRewards],r.prototype,"externalRewards",2);a([d.rewards.selectedVested],r.prototype,"selectedVestedRewards",2);a([d.rewards.selectedInternal],r.prototype,"selectedInternalRewards",2);a([d.rewards.selectedExternal],r.prototype,"selectedExternalRewards",2);a([d.rewards.selectedCrowdloan],r.prototype,"selectedCrowdloanRewards",2);a([c.assets.xor],r.prototype,"xor",2);a([c.rewards.externalRewardsAvailable],r.prototype,"externalRewardsAvailable",2);a([c.rewards.rewardsAvailable],r.prototype,"rewardsAvailable",2);a([c.rewards.internalRewardsAvailable],r.prototype,"internalRewardsAvailable",2);a([c.rewards.vestedRewardsAvailable],r.prototype,"vestedRewardsAvailable",2);a([c.rewards.rewardsByAssetsList],r.prototype,"rewardsByAssetsList",2);a([c.rewards.externalRewardsSelected],r.prototype,"externalRewardsSelected",2);a([c.libraryTheme],r.prototype,"libraryTheme",2);a([I.rewards.reset],r.prototype,"reset",2);a([m.rewards.setSelectedRewards],r.prototype,"setSelectedRewards",2);a([m.rewards.getExternalRewards],r.prototype,"getExternalRewards",2);a([m.rewards.claimRewards],r.prototype,"claimRewards",2);a([m.rewards.subscribeOnRewards],r.prototype,"subscribeOnRewards",2);a([m.rewards.unsubscribeFromRewards],r.prototype,"unsubscribeFromRewards",2);a([T("evmAddress")],r.prototype,"checkRewardsAfterAccountChange",1);r=a([E({components:{RewardsGradientBox:h(u.RewardsGradientBox),RewardsAmountHeader:h(u.RewardsAmountHeader),RewardsAmountTable:h(u.RewardsAmountTable),GenericPageHeader:h(u.GenericPageHeader),TokensRow:h(u.TokensRow),SelectProviderDialog:h(u.SelectProviderDialog),InfoLine:b.InfoLine,FormattedAddress:b.FormattedAddress}})],r);var O=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"rewards"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.parentLoading||e.loading,expression:"parentLoading || loading"}],staticClass:"rewards-content"},[t("rewards-gradient-box",{staticClass:"rewards-block",attrs:{symbol:e.gradientSymbol}},[t("div",{class:["rewards-box",e.libraryTheme]},[t("tokens-row",{attrs:{assets:e.rewardTokens}}),e.claimingInProgressOrFinished?t("div",{staticClass:"rewards-claiming-text"},[e._v(" "+e._s(e.claimingStatusMessage)+" ")]):e._e(),e.isLoggedIn?t("div",{staticClass:"rewards-amount"},[t("rewards-amount-header",{attrs:{items:e.rewardsAmountHeaderItems}}),e.claimingInProgressOrFinished?e._e():[e.internalRewards?t("rewards-amount-table",{staticClass:"rewards-table",attrs:{title:e.t("rewards.events.LiquidityProvision"),items:[e.internalRewards],theme:e.libraryTheme,"is-codec-string":""},model:{value:e.selectedInternalRewardsModel,callback:function(s){e.selectedInternalRewardsModel=s},expression:"selectedInternalRewardsModel"}}):e._e(),t("rewards-amount-table",{staticClass:"rewards-table",attrs:{title:e.t("rewards.groups.strategic"),items:e.vestedRewadsGroupItems,theme:e.libraryTheme,"is-codec-string":""},model:{value:e.selectedVestedRewardsModel,callback:function(s){e.selectedVestedRewardsModel=s},expression:"selectedVestedRewardsModel"}}),Object.keys(e.crowdloanRewards).length?t("rewards-amount-table",{staticClass:"rewards-table",attrs:{title:e.t("rewards.groups.crowdloan"),items:e.crowdloanRewardsGroupItems,theme:e.libraryTheme,"is-codec-string":""},model:{value:e.selectedCrowdloanRewardsModel,callback:function(s){e.selectedCrowdloanRewardsModel=s},expression:"selectedCrowdloanRewardsModel"}}):e._e(),t("rewards-amount-table",{staticClass:"rewards-table",attrs:{title:e.t("rewards.groups.external"),items:e.externalRewardsGroupItems,"show-table":!!e.externalRewards.length,theme:e.libraryTheme,"simple-group":""},model:{value:e.selectedExternalRewardsModel,callback:function(s){e.selectedExternalRewardsModel=s},expression:"selectedExternalRewardsModel"}},[t("div",{staticClass:"rewards-footer"},[t("s-divider"),e.evmAddress?t("div",{staticClass:"rewards-account"},[t("div",{staticClass:"rewards-account-group"},[e.evmProvider?t("img",{staticClass:"rewards-account-logo",attrs:{src:e.getEvmProviderIcon(e.evmProvider),alt:e.evmProvider}}):e._e(),t("formatted-address",{attrs:{value:e.evmAddress,symbols:8}})],1),t("div",{staticClass:"rewards-account-group"},[e.changeWalletEvm?t("span",{directives:[{name:"button",rawName:"v-button"}],staticClass:"rewards-account-btn",on:{click:e.connectEvmWallet}},[e._v(" "+e._s(e.t("changeAccountText"))+" ")]):t("span",[e._v(e._s(e.t("connectedText")))]),e.changeWalletEvm?t("span",{directives:[{name:"button",rawName:"v-button"}],staticClass:"rewards-account-btn disconnect",on:{click:e.disconnectEvmWallet}},[e._v(" "+e._s(e.t("disconnectWalletText"))+" ")]):e._e()])]):t("s-button",{staticClass:"rewards-connect-button",attrs:{type:"tertiary"},on:{click:e.connectEvmWallet}},[e._v(" "+e._s(e.t("rewards.action.connectExternalWallet"))+" ")]),e.externalRewardsHintText?t("div",{staticClass:"rewards-footer-hint"},[e._v(e._s(e.externalRewardsHintText))]):e._e()],1)]),e.fee&&e.isLoggedIn&&e.rewardsAvailable&&!e.claimingInProgressOrFinished?t("info-line",e._b({class:["rewards-fee",e.libraryTheme],attrs:{"fiat-value":e.getFiatAmountByCodecString(e.fee),"is-formatted":""}},"info-line",e.feeInfo,!1)):e._e()]],2):e._e(),e.claimingInProgressOrFinished?t("div",{staticClass:"rewards-claiming-text--transaction"},[e._v(" "+e._s(e.transactionStatusMessage)+" ")]):e._e()],1)]),!e.claimingInProgressOrFinished&&e.hintText?t("div",{staticClass:"rewards-block rewards-hint"},[e._v(" "+e._s(e.hintText)+" ")]):e._e(),e.rewardsReceived||e.loading?e._e():t("s-button",{staticClass:"rewards-block rewards-action-button s-typography-button--large",attrs:{"data-test-name":"LoginAndGet",type:"primary",loading:e.actionButtonLoading,disabled:e.actionButtonDisabled},on:{click:e.handleAction}},[e._v(" "+e._s(e.actionButtonText)+" ")])],1),t("select-provider-dialog")],1)},B=[],W=F(r,O,B,!1,null,"d40ac6b0");const D=W.exports;export{D as default};
