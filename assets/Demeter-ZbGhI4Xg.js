var M=Object.defineProperty;var V=(l,e,t)=>e in l?M(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var v=(l,e,t)=>V(l,typeof e!="symbol"?e+"":e,t);import{m as W,b as r,aJ as y,aI as H,hw as K,W as X,C as U,hz as R,hA as E,l as _,j as x,_ as C,n as J}from"./index-BHqySXo4.js";import{E as Y}from"./ExplorePageMixin-CkKfV7ro.js";import{B as $}from"./BasePageMixin-Co7yDbqF.js";import"./ScrollableTableMixin-C9crfC47.js";var G=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,I=(l,e,t,s)=>{for(var a=s>1?void 0:s?Q(e,t):e,o=l.length-1,i;o>=0;o--)(i=l[o])&&(a=(s?i(e,t,a):i(a))||a);return s&&a&&G(e,t,a),a};const O=(l,e)=>[l,e].join(";");let f=class extends W($,Y){constructor(){super(...arguments);v(this,"property","apr");v(this,"poolsData",{})}async updatePoolsData(){await this.updateExploreData()}get list(){return Object.values(this.pools).map(e=>Object.values(e)).flat(2).filter(e=>!e.isRemoved)}get selectedDerivedPool(){return this.selectedPool?this.prepareDerivedPoolData(this.selectedPool,this.selectedAccountPool,this.liquidity):null}get items(){return[...this.list.map(s=>{var D,N;const a=this.demeterAssetsData[s.baseAsset],o=this.demeterAssetsData[s.poolAsset],i=this.demeterAssetsData[s.rewardAsset],m=(i==null?void 0:i.symbol)??"",u=r.FPNumber.fromCodecValue(this.getAssetFiatPrice({address:s.rewardAsset})??0),b=this.tokenInfos[s.rewardAsset],c=this.getAccountPool(s),P=!!c&&this.isActiveAccountPool(c),n=this.poolsData[O(s.baseAsset,s.poolAsset)],T=(n==null?void 0:n.priceCoefficient)??r.FPNumber.ZERO,z=r.FPNumber.fromCodecValue(this.getAssetFiatPrice(o)??0).mul(T),A=((D=n==null?void 0:n.reserves)==null?void 0:D[0])??r.FPNumber.ZERO,k=((N=n==null?void 0:n.reserves)==null?void 0:N[1])??r.FPNumber.ZERO,p=(n==null?void 0:n.supply)??r.FPNumber.ZERO,g=(c==null?void 0:c.pooledTokens)??r.FPNumber.ZERO,Z=s.isFarm?{address:(n==null?void 0:n.address)??"",balance:p.toCodecString(),firstAddress:a.address??"",firstBalance:A.toCodecString(),secondAddress:(o==null?void 0:o.address)??"",secondBalance:k.toCodecString(),poolShare:"1",reserveA:"1",reserveB:"1",totalSupply:"1"}:null,F=s.isFarm?[a,o]:[o],L=F.map(d=>(d==null?void 0:d.symbol)??"").join("-"),B=s.isFarm?"":(o==null?void 0:o.name)??"",S=new r.FPNumber(s.depositFee??0).mul(r.FPNumber.HUNDRED),h=z.mul(s.totalTokensInPool),j=this.getEmission(s,b),w=this.getApr(j,h,u),q=(s.isFarm?[{asset:a,balance:p.isZero()?r.FPNumber.ZERO:A.mul(g).div(p)},{asset:o,balance:p.isZero()?r.FPNumber.ZERO:k.mul(g).div(p)}]:[{asset:o,balance:g}]).map(d=>({...d,balance:y(d.balance)}));return{assets:F,name:L,description:B,baseAsset:a,poolAsset:o,rewardAsset:i,rewardAssetSymbol:m,depositFee:S.toNumber(),depositFeeFormatted:y(S,!0),tvl:h.toNumber(),tvlFormatted:H(h),apr:w.toNumber(),aprFormatted:y(w,!0),isAccountItem:P,accountTokens:q,liquidity:Z}})].sort((s,a)=>K({baseAsset:s.poolAsset,poolAsset:s.rewardAsset},{baseAsset:a.poolAsset,poolAsset:a.rewardAsset}))}get prefilteredItems(){return this.isAccountItemsOnly?this.items.filter(e=>e.isAccountItem):this.items}get hasAprColumnData(){return this.items.some(e=>e.apr!==0)}async updateExploreData(){this.loading||await this.withLoading(async()=>{await this.withParentLoading(async()=>{const e={},t=this.isFarmingPage,s=this.list.map(o=>O(o.baseAsset,o.poolAsset)),a=[...new Set(s)];await Promise.allSettled(a.map(async o=>{if(!e[o]){const i=await this.getPoolData(o,t);i&&(e[o]=i)}})),this.poolsData=Object.freeze(e)})})}async getPoolData(e,t){const[s,a]=e.split(";");if(t){const o=r.api.poolXyk.getInfo(s,a);if(!o)return null;const i=o.address,m=await r.api.api.query.poolXYK.totalIssuances(o.address),u=m.isEmpty?r.FPNumber.ZERO:new r.FPNumber(m),b=(await r.api.poolXyk.getReserves(s,a)).map(n=>r.FPNumber.fromCodecValue(n)),c=b[1];return{priceCoefficient:u.isZero()?r.FPNumber.ZERO:c.mul(new r.FPNumber(2)).div(u),supply:u,reserves:b,address:i}}else return{priceCoefficient:r.FPNumber.ONE}}};I([X("pools",{deep:!0})],f.prototype,"updatePoolsData",1);f=I([U({components:{CalculatorButton:R(E.CalculatorButton),CalculatorDialog:R(E.CalculatorDialog),PairTokenLogo:_(x.PairTokenLogo),SortButton:_(x.SortButton),DataRowSkeleton:_(x.DataRowSkeleton),TokenLogo:C.TokenLogo,FormattedAmount:C.FormattedAmount,HistoryPagination:C.HistoryPagination}})],f);var ee=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",[t("s-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingState,expression:"loadingState"}],ref:"table",staticClass:"explore-table",attrs:{data:e.tableItems,"highlight-current-row":!1,size:"small"}},[t("s-table-column",{attrs:{"min-width":"240",label:"#"},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"explore-table-item-index"},[t("span",{directives:[{name:"button",rawName:"v-button"}],class:["explore-table-item-index--head",{active:e.isDefaultSort}],on:{click:e.handleResetSort}},[e._v(" # ")])]),t("div",{staticClass:"explore-table-item-logo"},[t("s-icon",{staticClass:"explore-table-item-logo--head",attrs:{name:"various-bone-24",size:"14px"}})],1),t("div",{staticClass:"explore-table-item-info explore-table-item-info--head"},[t("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.t("nameText")))])])]},proxy:!0},{key:"default",fn:function({$index:s,row:a}){return[t("span",{staticClass:"explore-table-item-index explore-table-item-index--body"},[e._v(e._s(s+e.startIndex+1))]),a.assets.length===1?t("token-logo",{key:"token",staticClass:"explore-table-item-logo",attrs:{token:a.assets[0]}}):t("pair-token-logo",{key:"pair",staticClass:"explore-table-item-logo",attrs:{"first-token":a.assets[0],"second-token":a.assets[1],size:"small"}}),t("div",{staticClass:"explore-table-item-info explore-table-item-info--body"},[t("div",{staticClass:"explore-table-item-name"},[e._v(e._s(a.name))]),a.description?t("div",{key:"description",staticClass:"explore-table__secondary"},[e._v(e._s(a.description))]):e._e()])]}}])}),t("s-table-column",{attrs:{"min-width":"120","header-align":"left",align:"left"},scopedSlots:e._u([{key:"header",fn:function(){return[t("sort-button",{attrs:{name:"rewardAssetSymbol",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[t("span",{staticClass:"explore-table__primary"},[e._v("Reward")])])]},proxy:!0},{key:"default",fn:function({row:s}){return[t("div",{staticClass:"explore-table-cell"},[t("token-logo",{staticClass:"explore-table-item-logo explore-table-item-logo--plain",attrs:{size:"small","token-symbol":s.rewardAsset.symbol}}),t("div",{staticClass:"explore-table-item-name"},[e._v(e._s(s.rewardAsset.symbol))])],1)]}}])}),t("s-table-column",{attrs:{"min-width":"140","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("sort-button",{attrs:{name:"apr",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[t("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.TranslationConsts.APR))])])]},proxy:!0},{key:"default",fn:function({row:s}){return[t("data-row-skeleton",{attrs:{loading:!e.hasAprColumnData,rect:"",circle:""}},[t("span",{staticClass:"explore-table__accent"},[e._v(e._s(s.aprFormatted))]),t("calculator-button",{nativeOn:{click:function(a){return e.showPoolCalculator({baseAsset:s.baseAsset.address,poolAsset:s.poolAsset.address,rewardAsset:s.rewardAsset.address,liquidity:s.liquidity})}}})],1)]}}])}),t("s-table-column",{attrs:{"min-width":"80","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("sort-button",{attrs:{name:"depositFee",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[t("span",{staticClass:"explore-table__primary"},[e._v("Fee")])])]},proxy:!0},{key:"default",fn:function({row:s}){return[e._v(" "+e._s(s.depositFeeFormatted)+" ")]}}])}),e.isLoggedIn?t("s-table-column",{key:"logged",attrs:{"min-width":"140","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.t("balanceText")))])]},proxy:!0},{key:"default",fn:function({row:s}){return[t("div",{staticClass:"explore-table-item-tokens"},e._l(s.accountTokens,function({asset:a,balance:o},i){return t("div",{key:i,staticClass:"explore-table-cell"},[t("formatted-amount",{staticClass:"explore-table-item-token",attrs:{"value-can-be-hidden":"","font-size-rate":e.FontSizeRate.SMALL,value:o}}),t("token-logo",{staticClass:"explore-table-item-logo explore-table-item-logo--plain",attrs:{size:"small",token:a}})],1)}),0)]}}],null,!1,2195178740)}):e._e(),t("s-table-column",{attrs:{"min-width":"104","header-align":"right",align:"right"},scopedSlots:e._u([{key:"header",fn:function(){return[t("sort-button",{attrs:{name:"tvl",sort:{order:e.order,property:e.property}},on:{"change-sort":e.changeSort}},[t("span",{staticClass:"explore-table__primary"},[e._v(e._s(e.TranslationConsts.TVL))]),t("s-tooltip",{attrs:{"border-radius":"mini",content:e.t("tooltips.tvl")}},[t("s-icon",{attrs:{name:"info-16",size:"14px"}})],1)],1)]},proxy:!0},{key:"default",fn:function({row:s}){return[t("data-row-skeleton",{attrs:{loading:!e.pricesAvailable,rect:""}},[t("formatted-amount",{staticClass:"explore-table-item-price explore-table-item-amount",attrs:{"is-fiat-value":"","font-weight-rate":e.FontWeightRate.MEDIUM,value:s.tvlFormatted.amount}},[e._v(" "+e._s(s.tvlFormatted.suffix)+" ")])],1)]}}])})],1),t("history-pagination",{staticClass:"explore-table-pagination",attrs:{"current-page":e.currentPage,"page-amount":e.pageAmount,total:e.total,"last-page":e.lastPage,loading:e.loadingState},on:{"pagination-click":e.handlePaginationClick}}),t("calculator-dialog",e._b({attrs:{visible:e.showCalculatorDialog,liquidity:e.liquidity},on:{"update:visible":function(s){e.showCalculatorDialog=s}}},"calculator-dialog",e.selectedDerivedPool,!1))],1)},te=[],se=J(f,ee,te,!1,null,null);const ce=se.exports;export{ce as default};
