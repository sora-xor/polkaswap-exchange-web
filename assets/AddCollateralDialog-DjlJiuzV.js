var k=Object.defineProperty;var F=(i,e,t)=>e in i?k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var a=(i,e,t)=>F(i,typeof e!="symbol"?e+"":e,t);import{m as A,$ as p,X as m,Z as h,b as v,Y as V,ak as _,ai as P,hD as c,i1 as w,P as u,O as b,g as S,h as L,W as B,C as N,_ as g,l as C,j as x,i2 as D,i3 as I,R as Z,n as O}from"./index-BHqySXo4.js";import{g as y}from"./util-CUc0-gKA.js";var T=Object.defineProperty,j=Object.getOwnPropertyDescriptor,s=(i,e,t,l)=>{for(var o=l>1?void 0:l?j(e,t):e,n=i.length-1,d;n>=0;n--)(d=i[n])&&(o=(l?d(e,t,o):d(o))||o);return l&&o&&T(e,t,o),o};let r=class extends A(p.TransactionMixin,p.DialogMixin,p.FormattedAmountMixin){constructor(){super(...arguments);a(this,"xorSymbol",m.symbol);a(this,"getLtvStatus",y);a(this,"collateralInput");a(this,"collateral");a(this,"vault");a(this,"lockedAsset");a(this,"debtAsset");a(this,"prevLtv");a(this,"prevAvailable");a(this,"averageCollateralPrice");a(this,"maxLtv");a(this,"borrowTax");a(this,"networkFees");a(this,"accountXor");a(this,"collateralValue","")}async handleDialogVisibility(t){var l;await this.$nextTick(),this.collateralValue="",(l=this.collateralInput)==null||l.focus()}get xorBalance(){var t,l;return this.getFPNumberFromCodec(((l=(t=this.accountXor)==null?void 0:t.balance)==null?void 0:l.transferable)??h)}get title(){return this.t("kensetsu.addCollateral")}get networkFee(){return this.networkFees[v.Operation.DepositCollateral]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isCollateralZero(){return V(this.collateralValue)}get collateralFp(){var t;return this.isCollateralZero?this.Zero:this.getFPNumber(this.collateralValue,(t=this.lockedAsset)==null?void 0:t.decimals)}get isInsufficientBalance(){return this.lockedAsset?_(this.lockedAsset,this.collateralValue,this.networkFee):!0}get disabled(){return this.loading||this.isInsufficientXorForFee||this.isCollateralZero||this.isInsufficientBalance}get collateralAssetBalance(){return P(this.lockedAsset)}get availableCollateralBalanceFp(){var l;let t=this.getFPNumberFromCodec(this.collateralAssetBalance);return((l=this.lockedAsset)==null?void 0:l.address)===m.address&&(t=t.sub(this.fpNetworkFee),t.isLtZero()&&(t=this.Zero)),t}get isMaxCollateralAvailable(){return this.shouldBalanceBeHidden||this.isCollateralZero?!0:this.availableCollateralBalanceFp.isLteZero()?!1:!this.collateralFp.isEqualTo(this.availableCollateralBalanceFp)}get collateralValuePercent(){if(!this.collateralValue)return 0;const t=this.collateralFp.div(this.availableCollateralBalanceFp).mul(c).toNumber(0);return t>c?c:t}get debtSymbol(){var t;return((t=this.debtAsset)==null?void 0:t.symbol)??""}get lockedSymbol(){var t;return((t=this.lockedAsset)==null?void 0:t.symbol)??""}get totalCollateralValue(){return this.vault?this.vault.lockedAmount.add(this.collateralValue||0):null}get formattedPrevDeposit(){return this.vault?this.vault.lockedAmount.toLocaleString():h}get formattedNextDeposit(){var t;return((t=this.totalCollateralValue)==null?void 0:t.toLocaleString())??h}get formattedPrevLtv(){var t;return((t=this.prevLtv)==null?void 0:t.toLocaleString(2))??h}get maxBorrowPerCollateralValue(){var d,f;if(this.isCollateralZero)return this.Zero;const l=this.averageCollateralPrice.mul(this.collateralValue).mul(((d=this.collateral)==null?void 0:d.riskParams.liquidationRatioReversed)??0).div(c);let o=l.sub(l.mul(this.borrowTax)),n=((f=this.collateral)==null?void 0:f.riskParams.hardCap.sub(this.collateral.debtSupply))??this.Zero;return n=n.sub(n.mul(this.borrowTax)),o=o.gt(n)?n:o,!o.isFinity()||o.isLteZero()?this.Zero:o}get formattedPrevAvailable(){return this.prevAvailable.toLocaleString()}get nextAvailable(){return this.prevAvailable.add(this.maxBorrowPerCollateralValue)}get formattedNextAvailable(){return this.nextAvailable.toLocaleString()}get maxSafeDebt(){var l;return this.totalCollateralValue?this.averageCollateralPrice.mul(this.totalCollateralValue).mul(((l=this.collateral)==null?void 0:l.riskParams.liquidationRatioReversed)??0).div(c):null}get ltvCoeff(){return this.maxSafeDebt&&this.vault?this.vault.debt.div(this.maxSafeDebt):null}get ltv(){var t;return(t=this.ltvCoeff)!=null&&t.isFinity()?this.ltvCoeff.mul(c):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):h}get ltvText(){return w[y(this.ltvNumber)]}handleCollateralPercentChange(t){this.collateralValue=this.availableCollateralBalanceFp.mul(t/c).toString()}handleMaxCollateralValue(){this.collateralValue=this.availableCollateralBalanceFp.toString()}get errorMessage(){let t="";return this.isInsufficientXorForFee?t=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isCollateralZero?t=this.t("kensetsu.error.enterCollateral"):this.isInsufficientBalance&&(t=this.t("insufficientBalanceText",{tokenSymbol:this.lockedSymbol})),t}async handleAddCollateral(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{await this.withNotifications(async()=>{if(!(this.vault&&this.lockedAsset))throw new Error("[api.kensetsu.depositCollateral]: vault or asset is null");await v.api.kensetsu.depositCollateral(this.vault,this.collateralValue,this.lockedAsset)}),this.$emit("confirm")}catch(t){console.error(t)}this.isVisible=!1}};s([Z("collateralInput")],r.prototype,"collateralInput",2);s([u({type:Object,default:b})],r.prototype,"collateral",2);s([u({type:Object,default:b})],r.prototype,"vault",2);s([u({type:Object,default:b})],r.prototype,"lockedAsset",2);s([u({type:Object,default:b})],r.prototype,"debtAsset",2);s([u({type:Object,default:()=>v.FPNumber.ZERO})],r.prototype,"prevLtv",2);s([u({type:Object,default:()=>v.FPNumber.ZERO})],r.prototype,"prevAvailable",2);s([u({type:Object,default:()=>v.FPNumber.ZERO})],r.prototype,"averageCollateralPrice",2);s([u({type:Number,default:c})],r.prototype,"maxLtv",2);s([u({type:Number,default:0})],r.prototype,"borrowTax",2);s([S.wallet.settings.networkFees],r.prototype,"networkFees",2);s([L.assets.xor],r.prototype,"accountXor",2);s([B("visible")],r.prototype,"handleDialogVisibility",1);r=s([N({components:{DialogBase:g.DialogBase,InfoLine:g.InfoLine,TokenInput:C(x.TokenInput),ValueStatus:C(x.ValueStatusWrapper),PrevNextInfoLine:D(I.PrevNextInfoLine)}})],r);var M=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("dialog-base",{attrs:{title:e.title,visible:e.isVisible,tooltip:e.t("kensetsu.addCollateralDescription")},on:{"update:visible":function(l){e.isVisible=l}}},[t("div",{staticClass:"add-collateral"},[t("token-input",{ref:"collateralInput",staticClass:"add-collateral__collateral-input add-collateral__token-input",attrs:{"with-slider":"",title:e.t("kensetsu.depositCollateral"),"is-fiat-editable":"","is-max-available":e.isMaxCollateralAvailable,token:e.lockedAsset,balance:e.collateralAssetBalance,"slider-value":e.collateralValuePercent,disabled:e.loading},on:{max:e.handleMaxCollateralValue,slide:e.handleCollateralPercentChange},model:{value:e.collateralValue,callback:function(l){e.collateralValue=l},expression:"collateralValue"}}),t("prev-next-info-line",{attrs:{label:e.t("kensetsu.totalCollateral"),tooltip:e.t("kensetsu.totalCollateralDescription"),symbol:e.lockedSymbol,prev:e.formattedPrevDeposit,next:e.formattedNextDeposit}}),t("prev-next-info-line",{attrs:{label:e.t("kensetsu.debtAvailable"),tooltip:e.t("kensetsu.debtAvailableDescription"),symbol:e.debtSymbol,prev:e.formattedPrevAvailable,next:e.formattedNextAvailable}}),t("prev-next-info-line",{attrs:{label:e.t("kensetsu.ltv"),tooltip:e.t("kensetsu.ltvDescription"),symbol:"%",prev:e.formattedPrevLtv,next:e.formattedLtv}},[e.ltv?t("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:e.ltvNumber,"get-status":e.getLtvStatus}},[e._v(" "+e._s(e.ltvText)+" ")]):e._e()],1),t("s-button",{staticClass:"s-typography-button--large action-button add-collateral__button",attrs:{type:"primary",disabled:e.disabled},on:{click:e.handleAddCollateral}},[e.disabled?[e._v(e._s(e.errorMessage))]:[e._v(e._s(e.title))]],2),t("info-line",{attrs:{label:e.t("networkFeeText"),"label-tooltip":e.t("networkFeeTooltipText"),value:e.networkFeeFormatted,"asset-symbol":e.xorSymbol,"fiat-value":e.getFiatAmountByCodecString(e.networkFee),"is-formatted":""}})],1)])},R=[],X=O(r,M,R,!1,null,"64e0fcec");const W=X.exports;export{W as default};
