var D=Object.defineProperty;var x=(i,e,t)=>e in i?D(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var a=(i,e,t)=>x(i,typeof e!="symbol"?e+"":e,t);import{m as F,$ as f,X as _,Z as u,b as p,Y as w,ak as k,ai as R,hD as l,i1 as V,P as b,O as g,g as B,h as C,W as I,C as L,_ as y,l as c,j as v,i2 as S,i3 as P,R as A,n as N}from"./index-BHqySXo4.js";import{g as m}from"./util-CUc0-gKA.js";var T=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,o=(i,e,t,s)=>{for(var n=s>1?void 0:s?Z(e,t):e,h=i.length-1,d;h>=0;h--)(d=i[h])&&(n=(s?d(e,t,n):d(n))||n);return s&&n&&T(e,t,n),n};let r=class extends F(f.TransactionMixin,f.DialogMixin,f.FormattedAmountMixin){constructor(){super(...arguments);a(this,"xorSymbol",_.symbol);a(this,"getLtvStatus",m);a(this,"debtInput");a(this,"vault");a(this,"debtAsset");a(this,"prevLtv");a(this,"maxSafeDebt");a(this,"maxLtv");a(this,"networkFees");a(this,"accountXor");a(this,"repayDebtValue","")}async handleDialogVisibility(t){var s;await this.$nextTick(),this.repayDebtValue="",(s=this.debtInput)==null||s.focus()}get xorBalance(){var t,s;return this.getFPNumberFromCodec(((s=(t=this.accountXor)==null?void 0:t.balance)==null?void 0:s.transferable)??u)}get title(){return this.t("kensetsu.repayDebt")}get networkFee(){return this.networkFees[p.Operation.CreateVault]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isRepayDebtZero(){return w(this.repayDebtValue)}get repayDebtFp(){return this.isRepayDebtZero?this.Zero:this.getFPNumber(this.repayDebtValue)}get isRepayMoreThanDebt(){return this.debt.lt(this.repayDebtFp)}get isInsufficientBalance(){return this.debtAsset?k(this.debtAsset,this.repayDebtValue,this.networkFee):!0}get disabled(){return this.loading||this.isInsufficientXorForFee||this.isRepayDebtZero||this.isRepayMoreThanDebt||this.isInsufficientBalance}get debtAssetBalance(){return R(this.debtAsset)}get debtAssetBalanceFp(){var t;return this.getFPNumberFromCodec(this.debtAssetBalance,(t=this.debtAsset)==null?void 0:t.decimals)}get debt(){var t;return((t=this.vault)==null?void 0:t.debt)??this.Zero}get isMaxRepayAvailable(){return this.shouldBalanceBeHidden||this.isRepayDebtZero?!0:!this.debt.isFinity()||this.debt.isLteZero()?!1:!this.repayDebtFp.isEqualTo(this.debt)}get debtSymbol(){var t;return((t=this.debtAsset)==null?void 0:t.symbol)??""}get formattedPrevBorrow(){var t;return((t=this.vault)==null?void 0:t.debt.toLocaleString())??u}get nextBorrow(){var n;const t=(n=this.vault)==null?void 0:n.debt;if(this.isRepayDebtZero)return t;const s=t==null?void 0:t.sub(this.repayDebtValue);return s!=null&&s.isGteZero()?s:this.Zero}get formattedNextBorrow(){var t;return((t=this.nextBorrow)==null?void 0:t.toLocaleString())??u}get formattedPrevLtv(){var t;return((t=this.prevLtv)==null?void 0:t.toLocaleString(2))??u}get ltvCoeff(){return this.nextBorrow?this.nextBorrow.div(this.maxSafeDebt):null}get ltv(){var t;return(t=this.ltvCoeff)!=null&&t.isFinity()?this.ltvCoeff.mul(l):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):u}get ltvText(){return V[m(this.ltvNumber)]}get maxInputRepay(){return this.debt.gt(this.debtAssetBalanceFp)?this.debtAssetBalanceFp:this.debt}get repayDebtValuePercent(){if(!this.repayDebtValue)return 0;const t=this.repayDebtFp.div(this.maxInputRepay).mul(l).toNumber(0);return t>l?l:t}handleMaxRepayDebtValue(){this.repayDebtValue=this.maxInputRepay.toString()}handleRepayPercentChange(t){this.repayDebtValue=this.maxInputRepay.mul(t/l).toString()}get errorMessage(){let t="";return this.isInsufficientXorForFee?t=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isRepayDebtZero?t=this.t("kensetsu.error.enterRepayDebt"):this.isRepayMoreThanDebt?t=this.t("kensetsu.error.repayMoreThanDebt"):this.isInsufficientBalance&&(t=this.t("insufficientBalanceText",{tokenSymbol:this.debtSymbol})),t}async handleRepayDebt(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{await this.withNotifications(async()=>{if(!(this.vault&&this.debtAsset))throw new Error("[api.kensetsu.repayVaultDebt]: vault is null");await p.api.kensetsu.repayVaultDebt(this.vault,this.repayDebtValue,this.debtAsset)}),this.$emit("confirm")}catch(t){console.error(t)}this.isVisible=!1}};o([A("debtInput")],r.prototype,"debtInput",2);o([b({type:Object,default:g})],r.prototype,"vault",2);o([b({type:Object,default:g})],r.prototype,"debtAsset",2);o([b({type:Object,default:()=>p.FPNumber.ZERO})],r.prototype,"prevLtv",2);o([b({type:Object,default:()=>p.FPNumber.ZERO})],r.prototype,"maxSafeDebt",2);o([b({type:Number,default:l})],r.prototype,"maxLtv",2);o([B.wallet.settings.networkFees],r.prototype,"networkFees",2);o([C.assets.xor],r.prototype,"accountXor",2);o([I("visible")],r.prototype,"handleDialogVisibility",1);r=o([L({components:{DialogBase:y.DialogBase,InfoLine:y.InfoLine,TokenInput:c(v.TokenInput),ValueStatus:c(v.ValueStatusWrapper),PrevNextInfoLine:S(P.PrevNextInfoLine)}})],r);var M=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("dialog-base",{attrs:{title:e.title,visible:e.isVisible,tooltip:e.t("kensetsu.repayDebtDescription")},on:{"update:visible":function(s){e.isVisible=s}}},[t("div",{staticClass:"repay-debt"},[t("token-input",{ref:"debtInput",staticClass:"repay-debt__debt-input repay-debt__token-input",attrs:{"with-slider":"",title:e.title,"is-fiat-editable":"","is-max-available":e.isMaxRepayAvailable,token:e.debtAsset,balance:e.debtAssetBalance,"slider-value":e.repayDebtValuePercent,disabled:e.loading},on:{max:e.handleMaxRepayDebtValue,slide:e.handleRepayPercentChange},model:{value:e.repayDebtValue,callback:function(s){e.repayDebtValue=s},expression:"repayDebtValue"}}),t("prev-next-info-line",{attrs:{label:e.t("kensetsu.outstandingDebt"),tooltip:e.t("kensetsu.outstandingDebtDescription"),symbol:e.debtSymbol,prev:e.formattedPrevBorrow,next:e.formattedNextBorrow}}),t("prev-next-info-line",{attrs:{label:e.t("kensetsu.ltv"),tooltip:e.t("kensetsu.ltvDescription"),symbol:"%",prev:e.formattedPrevLtv,next:e.formattedLtv}},[e.ltv?t("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:e.ltvNumber,"get-status":e.getLtvStatus}},[e._v(" "+e._s(e.ltvText)+" ")]):e._e()],1),t("s-button",{staticClass:"s-typography-button--large action-button repay-debt__button",attrs:{type:"primary",disabled:e.disabled},on:{click:e.handleRepayDebt}},[e.disabled?[e._v(e._s(e.errorMessage))]:[e._v(e._s(e.title))]],2),t("info-line",{attrs:{label:e.t("networkFeeText"),"label-tooltip":e.t("networkFeeTooltipText"),value:e.networkFeeFormatted,"asset-symbol":e.xorSymbol,"fiat-value":e.getFiatAmountByCodecString(e.networkFee),"is-formatted":""}})],1)])},O=[],j=N(r,M,O,!1,null,"6cfbdff0");const W=j.exports;export{W as default};
