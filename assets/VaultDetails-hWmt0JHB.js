var A=Object.defineProperty;var k=(r,e,t)=>e in r?A(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>k(r,typeof e!="symbol"?e+"":e,t);import{m as D,T as w,$ as p,X as L,aB as T,h$ as V,i0 as h,b as P,hD as d,i1 as S,Z as i,Y as B,ai as F,F as g,a4 as _,av as I,h3 as z,h as f,g as m,C as R,_ as N,l as C,j as x,i2 as v,i3 as c,n as M}from"./index-BHqySXo4.js";import{g as y}from"./util-CUc0-gKA.js";var O=Object.defineProperty,q=Object.getOwnPropertyDescriptor,u=(r,e,t,s)=>{for(var a=s>1?void 0:s?q(e,t):e,n=r.length-1,b;n>=0;n--)(b=r[n])&&(a=(s?b(e,t,a):b(a))||a);return s&&a&&O(e,t,a),a};let o=class extends D(w,p.LoadingMixin,p.FormattedAmountMixin){constructor(){super(...arguments);l(this,"getLtvStatus",y);l(this,"isLoggedIn");l(this,"getAsset");l(this,"getTax");l(this,"accountVaults");l(this,"closedAccountVaults");l(this,"collaterals");l(this,"averageCollateralPrices");l(this,"liquidationPenalty");l(this,"percentFormat");l(this,"showCloseVaultDialog",!1);l(this,"showAddCollateralDialog",!1);l(this,"showBorrowMoreDialog",!1);l(this,"showRepayDebtDialog",!1);l(this,"vaultSkeleton",{id:0,lockedAssetId:L.address,debtAssetId:T.address,vaultType:V.V2,status:h.Closed,returned:this.Zero})}get foundVault(){const t=this.$route.params.vault;if(!t)return null;const s=this.accountVaults.find(({id:a})=>a===+t);return s||this.closedAccountVaults.find(({id:a})=>a===+t)}get vault(){return this.foundVault??this.vaultSkeleton}isOpened(t){return t.lockedAmount!==void 0}isClosed(t){return t.lockedAmount===void 0}get status(){return this.vault?this.isOpened(this.vault)?h.Opened:this.vault.status:h.Closed}get lockedAsset(){return this.vault?this.getAsset(this.vault.lockedAssetId):null}get debtAsset(){return this.vault?this.getAsset(this.vault.debtAssetId):null}get debtSymbol(){var t;return((t=this.debtAsset)==null?void 0:t.symbol)??""}get lockedSymbol(){var t;return((t=this.lockedAsset)==null?void 0:t.symbol)??""}get vaultTitle(){return this.debtSymbol&&this.lockedSymbol?`${this.debtSymbol} / ${this.lockedSymbol}`:""}get collateralId(){return this.vault?P.api.kensetsu.serializeKey(this.vault.lockedAssetId,this.vault.debtAssetId):""}get borrowTax(){return this.vault?this.getTax(this.vault.debtAssetId):0}get collateral(){return this.collateralId?this.collaterals[this.collateralId]:null}get averageCollateralPrice(){return this.collateralId?this.averageCollateralPrices[this.collateralId]??this.Zero:this.Zero}get maxSafeDebt(){var s;return this.vault&&this.isOpened(this.vault)?this.averageCollateralPrice.mul(this.vault.lockedAmount).mul(((s=this.collateral)==null?void 0:s.riskParams.liquidationRatioReversed)??0).div(d):null}get ltvCoeff(){return this.maxSafeDebt&&this.vault&&this.isOpened(this.vault)?this.vault.debt.div(this.maxSafeDebt):null}get maxLtv(){var t;return((t=this.collateral)==null?void 0:t.riskParams.liquidationRatioReversed)??d}get adjustedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv):null}get ltv(){var t;return(t=this.ltvCoeff)!=null&&t.isFinity()?this.ltvCoeff.mul(d):null}get ltvNumber(){var t;return((t=this.ltv)==null?void 0:t.toNumber())??0}get formattedLtv(){var s,a,n;const t=((s=this.adjustedLtv)==null?void 0:s.toNumber())??0;return((n=(a=this.percentFormat)==null?void 0:a.format)==null?void 0:n.call(a,t/d))??`${t}%`}get ltvText(){return S[y(this.ltvNumber)]}get formattedMaxLtv(){var t,s;return((s=(t=this.percentFormat)==null?void 0:t.format)==null?void 0:s.call(t,this.maxLtv/d))??`${this.maxLtv}%`}get availableToBorrow(){var a;if(!(this.maxSafeDebt&&this.vault&&this.isOpened(this.vault)))return null;let t=this.maxSafeDebt.sub(this.vault.debt);t=t.sub(t.mul(this.borrowTax));let s=((a=this.collateral)==null?void 0:a.riskParams.hardCap.sub(this.collateral.debtSupply))??this.Zero;return s=s.sub(s.mul(this.borrowTax)),t=s.lt(t)?s:t,!t.isFinity()||t.isLteZero()?this.Zero:t.dp(2)}get formattedAvailableToBorrow(){var t;return((t=this.availableToBorrow)==null?void 0:t.toLocaleString(2))??i}get fiatAvailableToBorrow(){return this.debtAsset&&this.availableToBorrow?this.getFiatAmountByFPNumber(this.availableToBorrow,this.debtAsset)??i:i}get isAddCollateralUnavailable(){return this.lockedAsset?B(F(this.lockedAsset)):!0}get isBorrowMoreUnavailable(){if(!(this.debtAsset&&this.availableToBorrow))return!0;const t=this.getFPNumberFiatAmountByFPNumber(this.availableToBorrow,this.debtAsset);return(t==null?void 0:t.isLessThan(g.ONE))??!1}get isRepayDebtUnavailable(){if(!this.vault||!this.debtAsset||this.isClosed(this.vault))return!0;const t=this.getFPNumberFiatAmountByFPNumber(this.vault.debt,this.debtAsset);return(t==null?void 0:t.isLessThan(g.ONE))??!1}get formattedLockedAmount(){return!this.vault||this.isClosed(this.vault)?i:this.vault.lockedAmount.toLocaleString(2)??i}get fiatLockedAmount(){return this.vault&&this.lockedAsset&&this.isOpened(this.vault)?this.getFiatAmountByFPNumber(this.vault.lockedAmount,this.lockedAsset)??i:i}get formattedDebtAmount(){return!this.vault||this.isClosed(this.vault)?i:this.vault.debt.toLocaleString(2)??i}get fiatDebt(){return this.debtAsset&&this.vault&&this.isOpened(this.vault)?this.getFiatAmountByFPNumber(this.vault.debt,this.debtAsset)??i:i}get formattedLiquidationPenalty(){var t,s;return((s=(t=this.percentFormat)==null?void 0:t.format)==null?void 0:s.call(t,this.liquidationPenalty/d))??`${this.liquidationPenalty}%`}get stabilityFee(){var t;return(t=this.collateral)==null?void 0:t.riskParams.stabilityFeeAnnual}get formattedStabilityFee(){var s,a,n;const t=((s=this.stabilityFee)==null?void 0:s.toNumber())??0;return((n=(a=this.percentFormat)==null?void 0:a.format)==null?void 0:n.call(a,t/d))??`${t}%`}get formattedReturnedAmount(){var t;return this.vault&&this.isClosed(this.vault)?((t=this.vault.returned)==null?void 0:t.toLocaleString(2))??i:i}get fiatReturnedAmount(){return this.vault&&this.lockedAsset&&this.isClosed(this.vault)?this.vault.returned?this.getFiatAmountByFPNumber(this.vault.returned,this.lockedAsset)??i:i:i}goToVaults(){_.push({name:I.Vaults})}mounted(){this.withApi(async()=>{if(!this.isLoggedIn){this.goToVaults();return}if(await z(()=>!this.parentLoading),!this.foundVault){this.goToVaults();return}this.vaultSkeleton.id=this.foundVault.id,this.vaultSkeleton.lockedAssetId=this.foundVault.lockedAssetId,this.vaultSkeleton.debtAssetId=this.foundVault.debtAssetId,this.vaultSkeleton.vaultType=this.foundVault.vaultType})}handleBack(){_.back()}closePosition(){this.showCloseVaultDialog=!0}addCollateral(){this.showAddCollateralDialog=!0}borrowMore(){this.showBorrowMoreDialog=!0}repayDebt(){this.showRepayDebtDialog=!0}};u([f.wallet.account.isLoggedIn],o.prototype,"isLoggedIn",2);u([f.assets.assetDataByAddress],o.prototype,"getAsset",2);u([f.vault.getBorrowTax],o.prototype,"getTax",2);u([m.vault.accountVaults],o.prototype,"accountVaults",2);u([m.vault.closedAccountVaults],o.prototype,"closedAccountVaults",2);u([m.vault.collaterals],o.prototype,"collaterals",2);u([m.vault.averageCollateralPrices],o.prototype,"averageCollateralPrices",2);u([m.vault.liquidationPenalty],o.prototype,"liquidationPenalty",2);u([m.settings.percentFormat],o.prototype,"percentFormat",2);o=u([R({components:{FormattedAmount:N.FormattedAmount,PairTokenLogo:C(x.PairTokenLogo),ValueStatus:C(x.ValueStatusWrapper),AddCollateralDialog:v(c.AddCollateralDialog),BorrowMoreDialog:v(c.BorrowMoreDialog),RepayDebtDialog:v(c.RepayDebtDialog),CloseVaultDialog:v(c.CloseVaultDialog),LtvProgressBar:v(c.LtvProgressBar),VaultDetailsHistory:v(c.VaultDetailsHistory),PositionStatus:v(c.PositionStatus)}})],o);var $=function(){var e=this,t=e._self._c;return e._self._setupProxy,e.vault?t("div",{staticClass:"vault-details-container"},[t("s-button",{staticClass:"vault-details-back",attrs:{type:"action",size:"small",alternative:"",tooltip:e.t("backText")},on:{click:e.handleBack}},[t("s-icon",{attrs:{name:"arrows-chevron-left-rounded-24",size:"24"}})],1),t("s-row",{staticClass:"vault-details-main",attrs:{gutter:20}},[t("s-col",{attrs:{xs:12,sm:12,md:6,lg:6}},[t("s-card",{staticClass:"vault details-card",attrs:{"border-radius":"small",size:"big",primary:""}},[t("div",{staticClass:"vault-title s-flex"},[t("pair-token-logo",{staticClass:"vault-icon",attrs:{size:"medium","first-token":e.debtAsset,"second-token":e.lockedAsset}}),t("div",{staticClass:"vault-title__container s-flex-column"},[t("h3",[e._v(e._s(e.vaultTitle))]),t("position-status",{attrs:{status:e.status}})],1)],1),t("s-divider"),e.ltv?[t("div",{staticClass:"vault-collateral s-flex-column"},[t("h4",[e._v(e._s(e.t("kensetsu.collateralDetails")))]),t("div",{staticClass:"vault-collateral__details s-flex"},[t("div",{staticClass:"vault-collateral__item s-flex-column"},[t("p",{staticClass:"vault-label p3"},[e._v(" "+e._s(e.t("kensetsu.yourCollateral"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.yourCollateralDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.formattedLockedAmount,"asset-symbol":e.lockedSymbol}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.fiatLockedAmount}})],1)]),t("div",{staticClass:"vault-collateral__actions s-flex"},[t("s-button",{staticClass:"s-typography-button--small",attrs:{size:"small",disabled:e.isAddCollateralUnavailable},on:{click:e.addCollateral}},[e._v(" "+e._s(e.t("kensetsu.addCollateral"))+" ")])],1)]),t("s-divider"),t("div",{staticClass:"vault-debt s-flex-column"},[t("h4",[e._v(e._s(e.t("kensetsu.debtDetails")))]),t("div",{staticClass:"vault-debt__details s-flex"},[t("div",{staticClass:"vault-debt__item s-flex-column"},[t("p",{staticClass:"vault-label p3"},[e._v(" "+e._s(e.t("kensetsu.yourDebt"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.yourDebtDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.formattedDebtAmount,"asset-symbol":e.debtSymbol}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.fiatDebt}})],1),t("div",{staticClass:"vault-debt__item s-flex-column"},[t("p",{staticClass:"vault-label p3"},[e._v(" "+e._s(e.t("kensetsu.availableToBorrow"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.availableToBorrowDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.formattedAvailableToBorrow,"asset-symbol":e.debtSymbol}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.fiatAvailableToBorrow}})],1)]),t("div",{staticClass:"vault-debt__actions s-flex"},[t("s-button",{staticClass:"s-typography-button--small",attrs:{size:"small",disabled:e.isRepayDebtUnavailable},on:{click:e.repayDebt}},[e._v(" "+e._s(e.t("kensetsu.repayDebt"))+" ")]),t("s-button",{staticClass:"s-typography-button--small",attrs:{type:"primary",size:"small",disabled:e.isBorrowMoreUnavailable},on:{click:e.borrowMore}},[e._v(" "+e._s(e.t("kensetsu.borrowMore"))+" ")])],1)])]:t("div",{staticClass:"vault-returned s-flex-column"},[t("p",{staticClass:"vault-label p3"},[e._v(" "+e._s(e.t("kensetsu.totalCollateralReturned"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.totalCollateralReturnedDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("formatted-amount",{attrs:{"value-can-be-hidden":"",value:e.formattedReturnedAmount,"asset-symbol":e.lockedSymbol}}),t("formatted-amount",{attrs:{"value-can-be-hidden":"","is-fiat-value":"",value:e.fiatReturnedAmount}})],1)],2),e.ltv?t("s-button",{staticClass:"close-vault-button",attrs:{type:"link"},on:{click:e.closePosition}},[e._v(" "+e._s(e.t("kensetsu.closeVault"))+" ")]):e._e()],1),t("s-col",{attrs:{xs:12,sm:12,md:6,lg:6}},[t("s-card",{staticClass:"details-card",attrs:{"border-radius":"small",size:"big",primary:""}},[t("div",{staticClass:"position-info s-flex-column"},[t("h4",[e._v(e._s(e.t("kensetsu.positionInfo")))]),t("div",{staticClass:"position-info__details s-flex"},[t("div",{staticClass:"position-info__item s-flex-column"},[t("p",{staticClass:"vault-label p3"},[e._v(" "+e._s(e.t("kensetsu.liquidationPenalty"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.liquidationPenaltyDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("p",{staticClass:"p3"},[e._v(e._s(e.formattedLiquidationPenalty))])]),t("div",{staticClass:"position-info__item s-flex-column"},[t("p",{staticClass:"vault-label p3"},[e._v(" "+e._s(e.t("kensetsu.interest"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.interestDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("p",{staticClass:"p3"},[e._v(e._s(e.formattedStabilityFee))])]),t("div",{staticClass:"position-info__item s-flex-column"},[t("p",{staticClass:"vault-label p3"},[e._v(" MAX LTV "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.ltvMaxTooltip"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("p",{staticClass:"p3"},[e._v(e._s(e.formattedMaxLtv))])])])]),e.ltv?[t("s-divider"),t("div",{staticClass:"ltv s-flex-column"},[t("h4",{staticClass:"ltv__title"},[e._v(" "+e._s(e.t("kensetsu.ltv"))+" "),t("s-tooltip",{attrs:{slot:"suffix","border-radius":"mini",content:e.t("kensetsu.ltvDescription"),placement:"top",tabindex:"-1"},slot:"suffix"},[t("s-icon",{attrs:{name:"info-16",size:"12px"}})],1)],1),t("div",{staticClass:"ltv__value s-flex"},[t("h2",[e._v(e._s(e.formattedLtv))]),t("value-status",{staticClass:"ltv__badge",attrs:{badge:"","error-icon-size":"15",value:e.ltvNumber,"get-status":e.getLtvStatus}},[e._v(" "+e._s(e.ltvText)+" ")])],1),t("ltv-progress-bar",{attrs:{percentage:e.ltvNumber}}),t("div",{staticClass:"ltv__legend s-flex"},[t("div",{staticClass:"ltv__legend-item"},[t("span",{staticClass:"ltv__legend-icon success"}),e._v(" "+e._s(e.t("kensetsu.positionSafe"))+" ")]),t("div",{staticClass:"ltv__legend-item"},[t("span",{staticClass:"ltv__legend-icon warning"}),e._v(" "+e._s(e.t("kensetsu.liquidationClose"))+" ")]),t("div",{staticClass:"ltv__legend-item"},[t("span",{staticClass:"ltv__legend-icon error"}),e._v(" "+e._s(e.t("kensetsu.highLiquidationRisk"))+" ")])])],1)]:e._e()],2),t("vault-details-history",{attrs:{id:e.vault.id,"locked-asset":e.lockedAsset,"debt-asset":e.debtAsset}})],1)],1),e.ltv?[t("add-collateral-dialog",{attrs:{visible:e.showAddCollateralDialog,vault:e.vault,"locked-asset":e.lockedAsset,"debt-asset":e.debtAsset,"prev-ltv":e.adjustedLtv,"prev-available":e.availableToBorrow,collateral:e.collateral,"max-ltv":e.maxLtv,"average-collateral-price":e.averageCollateralPrice,"borrow-tax":e.borrowTax},on:{"update:visible":function(s){e.showAddCollateralDialog=s}}}),t("borrow-more-dialog",{attrs:{visible:e.showBorrowMoreDialog,vault:e.vault,"debt-asset":e.debtAsset,"prev-ltv":e.adjustedLtv,available:e.availableToBorrow,collateral:e.collateral,"max-safe-debt":e.maxSafeDebt,"max-ltv":e.maxLtv,"borrow-tax":e.borrowTax},on:{"update:visible":function(s){e.showBorrowMoreDialog=s}}}),t("repay-debt-dialog",{attrs:{visible:e.showRepayDebtDialog,vault:e.vault,"debt-asset":e.debtAsset,"prev-ltv":e.adjustedLtv,"max-safe-debt":e.maxSafeDebt,"max-ltv":e.maxLtv},on:{"update:visible":function(s){e.showRepayDebtDialog=s}}}),t("close-vault-dialog",{attrs:{visible:e.showCloseVaultDialog,vault:e.vault,"locked-asset":e.lockedAsset,"debt-asset":e.debtAsset},on:{"update:visible":function(s){e.showCloseVaultDialog=s},confirm:e.goToVaults}})]:e._e()],2):t("div",{staticClass:"vault-details-container empty"})},Z=[],j=M(o,$,Z,!1,null,"729b663f");const K=j.exports;export{K as default};
